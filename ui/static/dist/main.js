const sl=(e,t)=>e===t,al=Symbol("solid-track"),Ze={equals:sl};let It=jt;const we=1,et=2,Pt={owned:null,cleanups:null,context:null,owner:null};var X=null;let at=null,ol=null,J=null,ie=null,$e=null,it=0;function Ye(e,t){const l=J,i=X,o=e.length===0,n=t===void 0?i:t,a=o?Pt:{owned:null,cleanups:null,context:n?n.context:null,owner:n},s=o?e:()=>e(()=>Te(()=>Fe(a)));X=a,J=null;try{return Ue(s,!0)}finally{J=l,X=i}}function y(e,t){t=t?Object.assign({},Ze,t):Ze;const l={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=o=>(typeof o=="function"&&(o=o(l.value)),Ot(l,o));return[Mt.bind(l),i]}function m(e,t,l){const i=dt(e,t,!1,we);Re(i)}function Z(e,t,l){It=ul;const i=dt(e,t,!1,we);i.user=!0,$e?$e.push(i):Re(i)}function We(e,t,l){l=l?Object.assign({},Ze,l):Ze;const i=dt(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=l.equals||void 0,Re(i),Mt.bind(i)}function Te(e){if(J===null)return e();const t=J;J=null;try{return e()}finally{J=t}}function Be(e){return X===null||(X.cleanups===null?X.cleanups=[e]:X.cleanups.push(e)),e}function Mt(){if(this.sources&&this.state)if(this.state===we)Re(this);else{const e=ie;ie=null,Ue(()=>lt(this),!1),ie=e}if(J){const e=this.observers?this.observers.length:0;J.sources?(J.sources.push(this),J.sourceSlots.push(e)):(J.sources=[this],J.sourceSlots=[e]),this.observers?(this.observers.push(J),this.observerSlots.push(J.sources.length-1)):(this.observers=[J],this.observerSlots=[J.sources.length-1])}return this.value}function Ot(e,t,l){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&Ue(()=>{for(let o=0;o<e.observers.length;o+=1){const n=e.observers[o],a=at&&at.running;a&&at.disposed.has(n),(a?!n.tState:!n.state)&&(n.pure?ie.push(n):$e.push(n),n.observers&&Wt(n)),a||(n.state=we)}if(ie.length>1e6)throw ie=[],new Error},!1)),t}function Re(e){if(!e.fn)return;Fe(e);const t=it;cl(e,e.value,t)}function cl(e,t,l){let i;const o=X,n=J;J=X=e;try{i=e.fn(t)}catch(a){return e.pure&&(e.state=we,e.owned&&e.owned.forEach(Fe),e.owned=null),e.updatedAt=l+1,Ft(a)}finally{J=n,X=o}(!e.updatedAt||e.updatedAt<=l)&&(e.updatedAt!=null&&"observers"in e?Ot(e,i):e.value=i,e.updatedAt=l)}function dt(e,t,l,i=we,o){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:X,context:X?X.context:null,pure:l};return X===null||X!==Pt&&(X.owned?X.owned.push(n):X.owned=[n]),n}function tt(e){if(e.state===0)return;if(e.state===et)return lt(e);if(e.suspense&&Te(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<it);)e.state&&t.push(e);for(let l=t.length-1;l>=0;l--)if(e=t[l],e.state===we)Re(e);else if(e.state===et){const i=ie;ie=null,Ue(()=>lt(e,t[0]),!1),ie=i}}function Ue(e,t){if(ie)return e();let l=!1;t||(ie=[]),$e?l=!0:$e=[],it++;try{const i=e();return dl(l),i}catch(i){l||($e=null),ie=null,Ft(i)}}function dl(e){if(ie&&(jt(ie),ie=null),e)return;const t=$e;$e=null,t.length&&Ue(()=>It(t),!1)}function jt(e){for(let t=0;t<e.length;t++)tt(e[t])}function ul(e){let t,l=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[l++]=i:tt(i)}for(t=0;t<l;t++)tt(e[t])}function lt(e,t){e.state=0;for(let l=0;l<e.sources.length;l+=1){const i=e.sources[l];if(i.sources){const o=i.state;o===we?i!==t&&(!i.updatedAt||i.updatedAt<it)&&tt(i):o===et&&lt(i,t)}}}function Wt(e){for(let t=0;t<e.observers.length;t+=1){const l=e.observers[t];l.state||(l.state=et,l.pure?ie.push(l):$e.push(l),l.observers&&Wt(l))}}function Fe(e){let t;if(e.sources)for(;e.sources.length;){const l=e.sources.pop(),i=e.sourceSlots.pop(),o=l.observers;if(o&&o.length){const n=o.pop(),a=l.observerSlots.pop();i<o.length&&(n.sourceSlots[a]=i,o[i]=n,l.observerSlots[i]=a)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Fe(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Fe(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function hl(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ft(e,t=X){throw hl(e)}const fl=Symbol("fallback");function Tt(e){for(let t=0;t<e.length;t++)e[t]()}function pl(e,t,l={}){let i=[],o=[],n=[],a=0,s=t.length>1?[]:null;return Be(()=>Tt(n)),()=>{let p=e()||[],u=p.length,c,d;return p[al],Te(()=>{let h,$,E,x,g,b,v,k,C;if(u===0)a!==0&&(Tt(n),n=[],i=[],o=[],a=0,s&&(s=[])),l.fallback&&(i=[fl],o[0]=Ye(w=>(n[0]=w,l.fallback())),a=1);else if(a===0){for(o=new Array(u),d=0;d<u;d++)i[d]=p[d],o[d]=Ye(S);a=u}else{for(E=new Array(u),x=new Array(u),s&&(g=new Array(u)),b=0,v=Math.min(a,u);b<v&&i[b]===p[b];b++);for(v=a-1,k=u-1;v>=b&&k>=b&&i[v]===p[k];v--,k--)E[k]=o[v],x[k]=n[v],s&&(g[k]=s[v]);for(h=new Map,$=new Array(k+1),d=k;d>=b;d--)C=p[d],c=h.get(C),$[d]=c===void 0?-1:c,h.set(C,d);for(c=b;c<=v;c++)C=i[c],d=h.get(C),d!==void 0&&d!==-1?(E[d]=o[c],x[d]=n[c],s&&(g[d]=s[c]),d=$[d],h.set(C,d)):n[c]();for(d=b;d<u;d++)d in E?(o[d]=E[d],n[d]=x[d],s&&(s[d]=g[d],s[d](d))):o[d]=Ye(S);o=o.slice(0,a=u),i=p.slice(0)}return o});function S(h){if(n[d]=h,s){const[$,E]=y(d);return s[d]=E,t(p[d],$)}return t(p[d])}}}function _(e,t){return Te(()=>e(t||{}))}const gl=e=>`Stale read from <${e}>.`;function Y(e){const t="fallback"in e&&{fallback:()=>e.fallback};return We(pl(()=>e.each,e.children,t||void 0))}function U(e){const t=e.keyed,l=We(()=>e.when,void 0,void 0),i=t?l:We(l,void 0,{equals:(o,n)=>!o==!n});return We(()=>{const o=i();if(o){const n=e.children;return typeof n=="function"&&n.length>0?Te(()=>n(t?o:()=>{if(!Te(i))throw gl("Show");return l()})):n}return e.fallback},void 0,void 0)}const j=e=>We(()=>e());function $l(e,t,l){let i=l.length,o=t.length,n=i,a=0,s=0,p=t[o-1].nextSibling,u=null;for(;a<o||s<n;){if(t[a]===l[s]){a++,s++;continue}for(;t[o-1]===l[n-1];)o--,n--;if(o===a){const c=n<i?s?l[s-1].nextSibling:l[n-s]:p;for(;s<n;)e.insertBefore(l[s++],c)}else if(n===s)for(;a<o;)(!u||!u.has(t[a]))&&t[a].remove(),a++;else if(t[a]===l[n-1]&&l[s]===t[o-1]){const c=t[--o].nextSibling;e.insertBefore(l[s++],t[a++].nextSibling),e.insertBefore(l[--n],c),t[o]=l[n]}else{if(!u){u=new Map;let d=s;for(;d<n;)u.set(l[d],d++)}const c=u.get(t[a]);if(c!=null)if(s<c&&c<n){let d=a,S=1,h;for(;++d<o&&d<n&&!((h=u.get(t[d]))==null||h!==c+S);)S++;if(S>c-s){const $=t[a];for(;s<c;)e.insertBefore(l[s++],$)}else e.replaceChild(l[s++],t[a++])}else a++;else t[a++].remove()}}}const At="_$DX_DELEGATE";function Bt(e,t,l,i={}){let o;return Ye(n=>{o=n,t===document?e():r(t,e(),t.firstChild?null:void 0,l)},i.owner),()=>{o(),t.textContent=""}}function f(e,t,l,i){let o;const n=()=>{const s=document.createElement("template");return s.innerHTML=e,s.content.firstChild},a=()=>(o||(o=n())).cloneNode(!0);return a.cloneNode=a,a}function le(e,t=window.document){const l=t[At]||(t[At]=new Set);for(let i=0,o=e.length;i<o;i++){const n=e[i];l.has(n)||(l.add(n),t.addEventListener(n,_l))}}function fe(e,t,l){l==null?e.removeAttribute(t):e.setAttribute(t,l)}function de(e,t){t==null?e.removeAttribute("class"):e.className=t}function vl(e,t,l){if(!t)return l?fe(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof l=="string"&&(i.cssText=l=void 0),l||(l={}),t||(t={});let o,n;for(n in l)t[n]==null&&i.removeProperty(n),delete l[n];for(n in t)o=t[n],o!==l[n]&&(i.setProperty(n,o),l[n]=o);return l}function bl(e,t,l){return Te(()=>e(t,l))}function r(e,t,l,i){if(l!==void 0&&!i&&(i=[]),typeof t!="function")return nt(e,t,i,l);m(o=>nt(e,t(),o,l),i)}function _l(e){let t=e.target;const l=`$$${e.type}`,i=e.target,o=e.currentTarget,n=p=>Object.defineProperty(e,"target",{configurable:!0,value:p}),a=()=>{const p=t[l];if(p&&!t.disabled){const u=t[`${l}Data`];if(u!==void 0?p.call(t,u,e):p.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},s=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const p=e.composedPath();n(p[0]);for(let u=0;u<p.length-2&&(t=p[u],!!a());u++){if(t._$host){t=t._$host,s();break}if(t.parentNode===o)break}}else s();n(i)}function nt(e,t,l,i,o){for(;typeof l=="function";)l=l();if(t===l)return l;const n=typeof t,a=i!==void 0;if(e=a&&l[0]&&l[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===l))return l;if(a){let s=l[0];s&&s.nodeType===3?s.data!==t&&(s.data=t):s=document.createTextNode(t),l=qe(e,l,i,s)}else l!==""&&typeof l=="string"?l=e.firstChild.data=t:l=e.textContent=t}else if(t==null||n==="boolean")l=qe(e,l,i);else{if(n==="function")return m(()=>{let s=t();for(;typeof s=="function";)s=s();l=nt(e,s,l,i)}),()=>l;if(Array.isArray(t)){const s=[],p=l&&Array.isArray(l);if(ct(s,t,l,o))return m(()=>l=nt(e,s,l,i,!0)),()=>l;if(s.length===0){if(l=qe(e,l,i),a)return l}else p?l.length===0?Dt(e,s,i):$l(e,l,s):(l&&qe(e),Dt(e,s));l=s}else if(t.nodeType){if(Array.isArray(l)){if(a)return l=qe(e,l,i,t);qe(e,l,null,t)}else l==null||l===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);l=t}}return l}function ct(e,t,l,i){let o=!1;for(let n=0,a=t.length;n<a;n++){let s=t[n],p=l&&l[e.length],u;if(!(s==null||s===!0||s===!1))if((u=typeof s)=="object"&&s.nodeType)e.push(s);else if(Array.isArray(s))o=ct(e,s,p)||o;else if(u==="function")if(i){for(;typeof s=="function";)s=s();o=ct(e,Array.isArray(s)?s:[s],Array.isArray(p)?p:[p])||o}else e.push(s),o=!0;else{const c=String(s);p&&p.nodeType===3&&p.data===c?e.push(p):e.push(document.createTextNode(c))}}return o}function Dt(e,t,l=null){for(let i=0,o=t.length;i<o;i++)e.insertBefore(t[i],l)}function qe(e,t,l,i){if(l===void 0)return e.textContent="";const o=i||document.createTextNode("");if(t.length){let n=!1;for(let a=t.length-1;a>=0;a--){const s=t[a];if(o!==s){const p=s.parentNode===e;!n&&!a?p?e.replaceChild(o,s):e.insertBefore(o,l):p&&s.remove()}else n=!0}}else e.insertBefore(o,l);return[o]}const[Rt,Ut]=y(window.location.pathname||"/"),[ml,Gt]=y(new URLSearchParams(window.location.search));if(typeof window<"u"){const e=()=>{Ut(window.location.pathname||"/"),Gt(new URLSearchParams(window.location.search))};window.addEventListener("popstate",e),Be(()=>window.removeEventListener("popstate",e))}function Kt(e,t={}){const l=Rt();e!==l&&(t.replace?window.history.replaceState({},"",e):window.history.pushState({},"",e),Ut(e),Gt(new URLSearchParams(window.location.search)),window.scrollTo({top:0,behavior:"smooth"}))}function xl(){return[Rt,Kt,ml]}function ye(e,t){return t==="/"?e==="/":String(e).startsWith(t)}const ut="gogw_jwt";function yl(){return localStorage.getItem(ut)||""}function ht(e={}){const t=yl();return t?{...e,Authorization:`Bearer ${t}`}:e}function wl(e){if(e.status===401)throw localStorage.removeItem(ut),window.location.href="/login",new Error("unauthorized")}async function Ge(e,t={}){const l=await fetch(e,{credentials:"same-origin",headers:ht(t.headers),...t});return wl(l),l}async function Ke(e){if(e.status===204)return null;const t=await e.text();if(!t)return null;try{const l=JSON.parse(t);if(l&&typeof l=="object"&&"success"in l){if(l.success)return l.data??null;const i=l.error||l.message||"request failed";throw new Error(i)}return l}catch{throw new Error("invalid json")}}function Sl(e){e&&localStorage.setItem(ut,e)}async function z(e,t={}){const l=await Ge(e,t);if(!l.ok)throw new Error(`${l.status} ${l.statusText}`);return Ke(l)}async function ae(e,t,l={}){const i=await Ge(e,{method:"POST",headers:ht({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ke(i)}async function He(e,t,l={}){const i=await Ge(e,{method:"PUT",headers:ht({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ke(i)}async function Ie(e){const t=await Ge(e,{method:"DELETE"});if(!t.ok&&t.status!==204)throw new Error(`${t.status} ${t.statusText}`);return t.status===204?null:Ke(t)}async function Cl(e,t,l={}){const i=await Ge(e,{method:"POST",body:t,...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ke(i)}var kl=f("<div class=dropdown-menu>"),El=f('<nav class=nav><div class="container nav-inner"><div class=nav-brand><svg class=nav-brand-icon viewBox="0 0 48 48"fill=none xmlns=http://www.w3.org/2000/svg><defs><linearGradient id=brandGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#3b82f6></stop><stop offset=100% style=stop-color:#8b5cf6></stop></linearGradient><linearGradient id=chipGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#06b6d4></stop><stop offset=100% style=stop-color:#22d3ee></stop></linearGradient></defs><rect x=4 y=4 width=40 height=40 rx=10 fill=url(#brandGradient) opacity=0.15></rect><rect x=4 y=4 width=40 height=40 rx=10 stroke=url(#brandGradient) stroke-width=2></rect><rect x=14 y=14 width=20 height=20 rx=4 fill=url(#chipGradient) opacity=0.9></rect><circle cx=18 cy=18 r=2 fill=white opacity=0.9></circle><circle cx=18 cy=30 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=18 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=30 r=2 fill=white opacity=0.9></circle><path d="M24 10V14M24 34V38M10 24H14M34 24H38"stroke=url(#brandGradient) stroke-width=2 stroke-linecap=round></path></svg><div class=nav-brand-text><div class=nav-title><span class=brand-hu>Hu</span><span class=brand-shu>Shu</span><span class=brand-gateway>智能网关</span></div><div class=nav-subtitle><span class=subtitle-icon>◆</span>工业物联网网关管理平台</div></div></div><div class=nav-links><div class=dropdown><button><span class=nav-btn-icon>⚙</span>设置<span class=dropdown-arrow>▾</span></button></div><a class="nav-btn nav-btn-danger"href=/logout><span class=nav-btn-icon>⏻</span>退出'),Ll=f("<a><span class=nav-btn-icon>"),Tl=f("<a><span class=dropdown-item-icon>");const Al=[{to:"/",label:"仪表盘",icon:"◉"},{to:"/alarms",label:"报警",icon:"⚠"},{to:"/realtime",label:"实时",icon:"◈"},{to:"/history",label:"历史",icon:"▤"}],Dl=[{to:"/gateway",label:"网关设置",icon:"⚙"},{to:"/resources",label:"资源",icon:"◐"},{to:"/devices",label:"设备",icon:"◑"},{to:"/drivers",label:"驱动",icon:"▣"},{to:"/northbound",label:"北向",icon:"◉"},{to:"/storage",label:"存储策略",icon:"◫"},{to:"/thresholds",label:"阈值",icon:"◐"}];function Nl(e){const[t,l]=y(!1);let i;const o=s=>{localStorage.removeItem("gogw_jwt")},n=()=>{l(!1)},a=s=>{i&&!i.contains(s.target)&&l(!1)};return(()=>{var s=El(),p=s.firstChild,u=p.firstChild,c=u.nextSibling,d=c.firstChild,S=d.firstChild,h=d.nextSibling;c.$$click=a,r(c,()=>Al.map(E=>(()=>{var x=Ll(),g=x.firstChild;return x.$$click=b=>{b.preventDefault(),e.onNav(E.to),n()},r(g,()=>E.icon),r(x,()=>E.label,null),m(b=>{var v=E.to,k=E.to,C=`nav-btn ${ye(e.path,E.to)?"active":""}`;return v!==b.e&&fe(x,"key",b.e=v),k!==b.t&&fe(x,"href",b.t=k),C!==b.a&&de(x,b.a=C),b},{e:void 0,t:void 0,a:void 0}),x})()),d);var $=i;return typeof $=="function"?bl($,d):i=d,S.$$click=()=>l(!t()),r(d,_(U,{get when(){return t()},get children(){var E=kl();return r(E,()=>Dl.map(x=>(()=>{var g=Tl(),b=g.firstChild;return g.$$click=v=>{v.preventDefault(),e.onNav(x.to),n()},r(b,()=>x.icon),r(g,()=>x.label,null),m(v=>{var k=x.to,C=x.to,w=`dropdown-item ${ye(e.path,x.to)?"active":""}`;return k!==v.e&&fe(g,"key",v.e=k),C!==v.t&&fe(g,"href",v.t=C),w!==v.a&&de(g,v.a=w),v},{e:void 0,t:void 0,a:void 0}),g})())),E}}),null),h.$$click=E=>{E.preventDefault(),o(),e.onNav("/login")},m(()=>de(S,`nav-btn dropdown-toggle ${ye(e.path,"/resources")||ye(e.path,"/devices")||ye(e.path,"/drivers")||ye(e.path,"/northbound")||ye(e.path,"/storage")||ye(e.path,"/thresholds")?"active":""}`)),s})()}le(["click"]);var ql=f("<div class=card><div class=card-body>"),Il=f("<div class=card-header>"),Pl=f("<h3 class=card-title>"),Ml=f("<div class=card-extra>");function re(e){return(()=>{var t=ql(),l=t.firstChild;return r(t,(()=>{var i=j(()=>!!(e.title||e.extra));return()=>i()&&(()=>{var o=Il();return r(o,(()=>{var n=j(()=>!!e.title);return()=>n()&&(()=>{var a=Pl();return r(a,()=>e.title),a})()})(),null),r(o,(()=>{var n=j(()=>!!e.extra);return()=>n()&&(()=>{var a=Ml();return r(a,()=>e.extra),a})()})(),null),o})()})(),l),r(l,()=>e.children),m(i=>vl(t,e.style||"",i)),t})()}le(["click"]);function oe(){return{show:(e,t)=>{typeof window<"u"&&window.toast&&window.toast.show(e,t)}}}le(["click"]);var Ol=f("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),jl=f("<button class=btn>刷新"),Wl=f("<tr><td></td><td></td><td></td><td>"),Fl=f("<tr><td colspan=4 style=text-align:center;padding:16px;color:var(--text-muted)>暂无数据");function Bl(){const e=oe(),[t,l]=y([]),[i,o]=y(new Map),n=()=>{z("/api/data").then(a=>{const s=a.data||a||[];s.sort((p,u)=>{const c=new Date(p.collected_at||p.CollectedAt||0).getTime();return new Date(u.collected_at||u.CollectedAt||0).getTime()-c}),l(s.slice(0,8))}).catch(()=>e.show("error","加载实时数据失败"))};return Z(()=>{z("/api/devices").then(s=>{const p=s.data||s||[],u=new Map;p.forEach(c=>u.set(String(c.id),c.name||c.id)),o(u)}).catch(()=>{}),n();const a=setInterval(n,4e3);Be(()=>clearInterval(a))}),_(re,{title:"最新采集",get extra(){return(()=>{var a=jl();return a.$$click=n,a})()},get children(){var a=Ol(),s=a.firstChild,p=s.firstChild,u=p.nextSibling;return r(u,_(Y,{get each(){return t()},children:c=>{const d=i().get(String(c.device_id))||c.device_name||c.DeviceName||c.device_id;return(()=>{var S=Wl(),h=S.firstChild,$=h.nextSibling,E=$.nextSibling,x=E.nextSibling;return r(h,()=>{var g;return((g=c.collected_at)==null?void 0:g.slice(5,19))||c.CollectedAt}),r($,d),r(E,()=>c.field_name||c.FieldName),r(x,()=>c.value||c.Value),m(()=>fe(S,"key",c.id||`${c.device_id}-${c.field_name}`)),S})()}}),null),r(u,_(Y,{get each(){return t().length===0?[1]:[]},children:()=>Fl()}),null),a}})}le(["click"]);var Rl=f("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th><th>阈值</th><th>级别</th><th></th></tr></thead><tbody>"),Ul=f("<button class=btn>刷新"),Gl=f('<button class="btn btn-primary"style="padding:6px 10px">确认'),Kl=f('<span class="text-muted text-xs">已确认'),Hl=f("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td>"),Vl=f("<tr><td colspan=7 style=text-align:center;padding:16px;color:var(--text-muted)>暂无告警");function Jl(){const e=oe(),[t,l]=y([]),i=()=>{z("/api/alarms").then(n=>l((n.data||n).slice(0,8))).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const o=n=>{ae(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return _(re,{title:"最近告警",get extra(){return(()=>{var n=Ul();return n.$$click=i,n})()},get children(){var n=Rl(),a=n.firstChild,s=a.firstChild,p=s.nextSibling;return r(p,_(Y,{get each(){return t()},children:u=>(()=>{var c=Hl(),d=c.firstChild,S=d.nextSibling,h=S.nextSibling,$=h.nextSibling,E=$.nextSibling,x=E.nextSibling,g=x.firstChild,b=x.nextSibling;return r(d,()=>{var v;return((v=u.triggered_at)==null?void 0:v.slice(5,19))||u.triggered_at}),r(S,()=>u.device_id),r(h,()=>u.field_name),r($,()=>u.actual_value),r(E,()=>`${u.operator} ${u.threshold_value}`),r(g,()=>u.severity||"warn"),r(b,_(U,{get when(){return u.acknowledged!==1},get children(){var v=Gl();return v.$$click=()=>o(u.id),v}}),null),r(b,_(U,{get when(){return u.acknowledged===1},get children(){return Kl()}}),null),m(()=>de(g,`badge ${u.severity==="critical"?"badge-critical":"badge-running"}`)),c})()}),null),r(p,_(Y,{get each(){return t().length===0?[1]:[]},children:()=>Vl()}),null),n}})}le(["click"]);var zl=f("<div class=flex style=gap:12px;flex-wrap:wrap><button>");function Ql(e){const t=oe(),[l,i]=y(!1),o=()=>{i(!0);const n=e.collectorRunning?"/api/collector/stop":"/api/collector/start";ae(n,{}).then(()=>{var a;t.show("success",e.collectorRunning?"已停止采集":"已启动采集"),(a=e.onRefresh)==null||a.call(e)}).catch(()=>t.show("error","操作失败")).finally(()=>i(!1))};return _(re,{title:"快捷操作",get children(){var n=zl(),a=n.firstChild;return a.$$click=o,r(a,()=>e.collectorRunning?"停止采集器":"启动采集器"),m(s=>{var p=`btn ${e.collectorRunning?"btn-danger":"btn-success"}`,u=l();return p!==s.e&&de(a,s.e=p),u!==s.t&&(a.disabled=s.t=u),s},{e:void 0,t:void 0}),n}})}le(["click"]);var Xl=f('<div><div class=grid style="grid-template-columns:2fr 1fr;gap:24px"><div class=grid style=grid-template-columns:1fr;gap:24px></div><div class=grid style=grid-template-columns:1fr;gap:24px>');function Nt(){const[e,t]=y(null),[l,i]=y(!0),o=()=>{z("/api/status").then(n=>t(n.data||n)).catch(()=>{}).finally(()=>i(!1))};return Z(()=>{o();const n=setInterval(o,5e3);Be(()=>clearInterval(n))}),(()=>{var n=Xl(),a=n.firstChild,s=a.firstChild,p=s.nextSibling;return r(n,_(re,{get data(){return e()},get loading(){return l()}}),a),r(s,_(Bl,{}),null),r(s,_(Jl,{}),null),r(p,_(Ql,{get collectorRunning(){var u;return(u=e())==null?void 0:u.collector_running},onRefresh:o})),n})()}var Yl=f('<div class=container style=max-width:420px;margin-top:48px><div class=card><div class=card-header><h3 class=card-title>登录</h3></div><form class=form><div class=form-group><label class=form-label>用户名</label><input class=form-input required></div><div class=form-group><label class=form-label>密码</label><input class=form-input type=password required></div><button class="btn btn-primary"type=submit style=width:100%;margin-top:8px>'),Zl=f('<div style="color:var(--accent-red);padding:8px 0">');function en(e){const[t,l]=y("admin"),[i,o]=y("123456"),[n,a]=y(""),[s,p]=y(!1),u=c=>{c.preventDefault(),p(!0),a(""),ae("/login",{username:t(),password:i()}).then(d=>{Sl(d.token),window.location.replace("/")}).catch(()=>a("用户名或密码错误")).finally(()=>p(!1))};return(()=>{var c=Yl(),d=c.firstChild,S=d.firstChild,h=S.nextSibling,$=h.firstChild,E=$.firstChild,x=E.nextSibling,g=$.nextSibling,b=g.firstChild,v=b.nextSibling,k=g.nextSibling;return h.addEventListener("submit",u),x.$$input=C=>l(C.target.value),v.$$input=C=>o(C.target.value),r(h,(()=>{var C=j(()=>!!n());return()=>C()&&(()=>{var w=Zl();return r(w,n),w})()})(),k),r(k,()=>s()?"登录中...":"登录"),m(()=>k.disabled=s()),m(()=>x.value=t()),m(()=>v.value=i()),c})()}le(["input"]);var tn=f("<div style=text-align:center;padding:40px;color:var(--text-muted)>加载中..."),ln=f('<div style="color:var(--accent-red);padding:4px 0">'),nn=f('<form class=form style=max-width:480px><div class=form-group><label class=form-label>网关名称</label><input class=form-input placeholder=网关名称></div><div class=form-group><label class=form-label>ProductKey <span style=color:var(--text-muted);font-weight:normal>(产品标识)</span></label><input class=form-input placeholder=请输入产品密钥><div class=form-hint>用于北向平台身份认证</div></div><div class=form-group><label class=form-label>DeviceKey <span style=color:var(--text-muted);font-weight:normal>(设备标识)</span></label><input class=form-input placeholder=请输入设备密钥><div class=form-hint>用于北向平台设备认证</div></div><div class=flex style=gap:8px;marginTop:16px><button type=submit class="btn btn-primary">'),rn=f("<div style=color:var(--text-secondary);font-size:0.875rem;line-height:1.8><p><strong>ProductKey</strong>：网关产品的唯一标识符，用于区分不同型号的网关产品。</p><p><strong>DeviceKey</strong>：网关设备的唯一标识符，用于在同一产品下区分不同设备。</p><p>这两个密钥将在数据上报到北向平台时使用，用于设备认证和数据路由。"),sn=f("<div>");function an(){const e=oe(),[t,l]=y({product_key:"",device_key:"",gateway_name:"HuShu智能网关"}),[i,o]=y(!0),[n,a]=y(!1),[s,p]=y(""),u=()=>{o(!0),z("/api/gateway/config").then(d=>{l({product_key:d.product_key||"",device_key:d.device_key||"",gateway_name:d.gateway_name||"HuShu智能网关"})}).catch(()=>e.show("error","加载网关配置失败")).finally(()=>o(!1))};Z(()=>{u()});const c=d=>{d.preventDefault(),a(!0),p(""),He("/api/gateway/config",t()).then(()=>{e.show("success","网关配置已保存")}).catch(S=>{p(S.message||"保存失败"),e.show("error","保存失败")}).finally(()=>a(!1))};return(()=>{var d=sn();return r(d,_(re,{title:"网关设置",get children(){return[_(U,{get when(){return i()},get children(){return tn()}}),_(U,{get when(){return!i()},get children(){var S=nn(),h=S.firstChild,$=h.firstChild,E=$.nextSibling,x=h.nextSibling,g=x.firstChild,b=g.nextSibling,v=x.nextSibling,k=v.firstChild,C=k.nextSibling,w=v.nextSibling,P=w.firstChild;return S.addEventListener("submit",c),E.$$input=D=>l({...t(),gateway_name:D.target.value}),b.$$input=D=>l({...t(),product_key:D.target.value}),C.$$input=D=>l({...t(),device_key:D.target.value}),r(S,_(U,{get when(){return s()},get children(){var D=ln();return r(D,s),D}}),w),r(P,()=>n()?"保存中...":"保存配置"),m(()=>P.disabled=n()),m(()=>E.value=t().gateway_name),m(()=>b.value=t().product_key),m(()=>C.value=t().device_key),S}})]}}),null),r(d,_(re,{title:"说明",style:"margin-top:16px;",get children(){return rn()}}),null),d})()}le(["input"]);var on=f("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无资源"),cn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>路径</th><th>状态</th><th>操作</th></tr></thead><tbody>"),dn=f('<input class=form-input placeholder="如 192.168.1.100:502"required>'),un=f('<div style="color:var(--accent-red);padding:4px 0">'),hn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title></h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=serial>串口</option><option value=net>网口 (TCP)</option><option value=di>DI</option><option value=do>DO</option></select></div><div class=form-group><label class=form-label>路径</label></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),fn=f("<div>"),pn=f('<button class="btn btn-primary">新增资源'),gn=f('<tr><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除'),$n=f('<input class=form-input placeholder="如 /dev/ttyUSB0"required>');const Qe={name:"",type:"serial",path:"",enabled:1};function vn(){const e=oe(),[t,l]=y([]),[i,o]=y(Qe),[n,a]=y(null),[s,p]=y(!1),[u,c]=y(!1),[d,S]=y(""),h=()=>{z("/api/resources").then(g=>l(g.data||g)).catch(()=>e.show("error","加载资源失败"))};Z(()=>{h()}),Z(()=>{if(!s())return;const g=b=>{b.key==="Escape"&&p(!1)};window.addEventListener("keydown",g),Be(()=>window.removeEventListener("keydown",g))});const $=g=>{g.preventDefault(),c(!0),S(""),(n()?He(`/api/resources/${n()}`,i()):ae("/api/resources",i())).then(()=>{e.show("success",n()?"资源已更新":"资源已创建"),o(Qe),a(null),p(!1),h()}).catch(v=>{S(v.message||"保存失败"),e.show("error","保存失败")}).finally(()=>c(!1))},E=g=>{confirm("删除该资源？")&&confirm("删除后关联设备可能需要重新绑定资源，确认继续？")&&Ie(`/api/resources/${g}`).then(()=>{e.show("success","已删除"),h()}).catch(()=>e.show("error","删除失败"))},x=g=>{ae(`/api/resources/${g.id}/toggle`,{}).then(h).catch(()=>e.show("error","切换失败"))};return(()=>{var g=fn();return r(g,_(re,{title:"资源列表",get extra(){return(()=>{var b=pn();return b.$$click=()=>{o(Qe),a(null),S(""),p(!0)},b})()},get children(){var b=cn(),v=b.firstChild,k=v.firstChild,C=k.nextSibling;return r(C,_(Y,{get each(){return t()},children:w=>(()=>{var P=gn(),D=P.firstChild,O=D.nextSibling,W=O.nextSibling,M=W.nextSibling,G=M.nextSibling,F=G.firstChild,B=G.nextSibling,H=B.firstChild,ee=H.nextSibling,N=ee.nextSibling;return r(D,()=>w.id),r(O,()=>w.name),r(W,()=>w.type),r(M,()=>w.path),r(F,()=>w.enabled===1?"启用":"禁用"),H.$$click=()=>{a(w.id),o({name:w.name,type:w.type,path:w.path,enabled:w.enabled}),S(""),p(!0)},ee.$$click=()=>x(w),r(ee,()=>w.enabled===1?"禁用":"启用"),N.$$click=()=>E(w.id),m(()=>de(F,`badge ${w.enabled===1?"badge-running":"badge-stopped"}`)),P})()}),null),r(C,_(U,{get when(){return t().length===0},get children(){return on()}}),null),b}}),null),r(g,_(U,{get when(){return s()},get children(){var b=hn(),v=b.firstChild,k=v.firstChild,C=k.firstChild,w=k.nextSibling,P=w.firstChild,D=P.firstChild,O=D.nextSibling,W=P.nextSibling,M=W.firstChild,G=M.nextSibling,F=W.nextSibling;F.firstChild;var B=F.nextSibling,H=B.firstChild,ee=H.nextSibling;return b.$$click=N=>{N.target===N.currentTarget&&p(!1)},r(C,()=>n()?"编辑资源":"新增资源"),w.addEventListener("submit",$),O.$$input=N=>o({...i(),name:N.target.value}),G.addEventListener("change",N=>o({...i(),type:N.target.value})),r(F,_(U,{get when(){return i().type==="net"},get fallback(){return(()=>{var N=$n();return N.$$input=ne=>o({...i(),path:ne.target.value}),m(()=>N.value=i().path),N})()},get children(){var N=dn();return N.$$input=ne=>o({...i(),path:ne.target.value}),m(()=>N.value=i().path),N}}),null),r(w,_(U,{get when(){return d()},get children(){var N=un();return r(N,d),N}}),B),H.$$click=()=>{p(!1),a(null),o(Qe)},r(ee,(()=>{var N=j(()=>!!u());return()=>N()?"保存中...":n()?"保存":"创建"})()),m(N=>{var ne=u(),se=u();return ne!==N.e&&(H.disabled=N.e=ne),se!==N.t&&(ee.disabled=N.t=se),N},{e:void 0,t:void 0}),m(()=>O.value=i().name),m(()=>G.value=i().type),b}}),null),g})()}le(["click","input"]);var bn=f("<option value disabled>暂无可用驱动"),_n=f("<option value disabled>暂无可用资源"),mn=f('<div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>波特率</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>校验位</label><select class=form-select><option value=N>None</option><option value=E>Even</option><option value=O>Odd</option></select></div><div class=form-group><label class=form-label>数据位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>停止位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>设备地址</label><input class=form-input required>'),xn=f('<div class=grid style="grid-template-columns:repeat(1, 1fr);gap:12px"><div class=form-group><label class=form-label>设备地址</label><input class=form-input required>'),yn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:720px;max-width:100%><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:0 4px"><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>描述</label><input class=form-input></div><div class=form-group><label class=form-label>ProductKey</label><input class=form-input placeholder="子设备 productKey"></div><div class=form-group><label class=form-label>DeviceKey</label><input class=form-input placeholder="子设备 deviceKey"></div><div class=form-group><label class=form-label>选择驱动 <span style=color:var(--accent-red)>*</span></label><select class=form-select required><option value>请选择驱动</option></select></div><div class=form-group><label class=form-label>绑定资源</label><select class=form-select><option value>请选择资源</option></select></div></div><div class=form-group><label class=form-label>驱动类型</label><select class=form-select><option value=modbus_rtu_wasm>ModbusRtu / Wasm</option><option value=modbus_tcp_wasm>ModbusTcp / Wasm</option><option value=modbus_rtu_excel>ModbusRtu / Excel</option><option value=modbus_tcp_excel>ModbusTcp / Excel</option></select></div><div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>采集周期(ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>存储周期(s)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>超时(ms)</label><input class=form-input type=number required></div></div><div class=form-group style=margin-top:12px><label class=form-label>状态</label><select class=form-select><option value=1>启用</option><option value=0>禁用</option></select></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:16px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),wn=f('<div style="color:var(--accent-red);padding:4px 0">'),Sn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1001><div class=card style=width:400px;max-width:90vw><div class=card-header><h3 class=card-title>写入数据 - </h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style=padding:16px><div class=form-group><label class=form-label>字段</label><select class=form-select></select></div><div class=form-group><label class=form-label>值</label><input class=form-input type=number required></div><div class=flex style=gap:8px;marginTop:12px><button type=button class=btn style=flex:1>取消</button><button type=submit class="btn btn-primary"style=flex:1>写入'),Cn=f("<div>"),kn=f('<div class="flex gap-3"><input class=form-input placeholder=搜索设备/地址/驱动 style=max-width:240px><button class=btn>刷新</button><button class="btn btn-primary">新增设备'),En=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Ln=f('<div style="color:var(--accent-red);padding:16px 0">'),Tn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>驱动类型</th><th>驱动</th><th>资源</th><th>周期(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),An=f('<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:4px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger"style=padding-left:8px;padding-right:8px>删'),Dn=f('<div><div></div><div class="text-muted text-xs">'),Nn=f("<span style=color:var(--text-muted)>-"),qn=f("<tr><td colspan=8 style=text-align:center;padding:24px;color:var(--text-muted)>暂无设备"),In=f("<option> (v<!>)"),Pn=f("<option> (<!>) "),Mn=f("<option>");const Oe={name:"",description:"",product_key:"",device_key:"",driver_id:null,driver_type:"modbus_rtu_wasm",serial_port:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",ip_address:"",port_num:502,device_address:"1",collect_interval:1e3,storage_interval:300,timeout:1e3,resource_id:null,enabled:1};function On(){const e=oe(),[t,l]=y([]),[i,o]=y([]),[n,a]=y([]),[s,p]=y(!0),[u,c]=y(""),[d,S]=y(""),[h,$]=y(Oe),[E,x]=y(null),[g,b]=y(!1),[v,k]=y(!1),[C,w]=y(!1),[P]=y([]),[D,O]=y({field:"",value:""}),[W,M]=y(""),[G]=y(null),F=T=>Array.isArray(T)?T:T&&Array.isArray(T.data)?T.data:[],B=()=>{p(!0),Promise.allSettled([z("/api/devices"),z("/api/resources"),z("/api/drivers")]).then(([T,q,R])=>{if(T.status==="fulfilled"&&l(F(T.value)),q.status==="fulfilled"&&o(F(q.value)),R.status==="fulfilled"){const K=F(R.value);a(K.filter(L=>Number(L.enabled??1)===1))}const I=[T,q,R].some(K=>K.status==="rejected");c(I?"加载设备、资源或驱动失败":"")}).finally(()=>p(!1))};Z(()=>{B()}),Z(()=>{if(!g())return;const T=q=>{q.key==="Escape"&&b(!1)};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)});const H=()=>{const T=d().trim().toLowerCase();return T?t().filter(q=>[q.name,q.device_address,q.driver_type,q.driver_name].filter(Boolean).some(R=>R.toLowerCase().includes(T))):t()},ee=T=>{T.preventDefault(),k(!0),(E()?He(`/api/devices/${E()}`,h()):ae("/api/devices",h())).then(()=>{e.show("success",E()?"设备已更新":"设备已创建"),$(Oe),x(null),b(!1),B()}).catch(()=>e.show("error","操作失败")).finally(()=>k(!1))},N=T=>{ae(`/api/devices/${T}/toggle`,{}).then(B).catch(()=>e.show("error","切换失败"))},ne=T=>{confirm("确定删除该设备？")&&Ie(`/api/devices/${T}`).then(()=>{e.show("success","已删除"),B()}).catch(()=>e.show("error","删除失败"))},se=T=>{T.preventDefault(),M("");const q={function:"write",params:{[D().field]:D().value}};ae(`/api/devices/${G().id}/execute`,q).then(()=>{e.show("success","写入成功"),w(!1)}).catch(R=>M(R.message||"写入失败"))},ve=()=>{$(Oe),x(null),b(!0)},Ae=T=>{x(T.id),$({name:T.name,description:T.description||"",product_key:T.product_key||"",device_key:T.device_key||"",driver_id:T.driver_id,driver_type:T.driver_type||"modbus_rtu_wasm",serial_port:T.serial_port||"",baud_rate:T.baud_rate||9600,data_bits:T.data_bits||8,stop_bits:T.stop_bits||1,parity:T.parity||"N",ip_address:T.ip_address||"",port_num:T.port_num||502,device_address:T.device_address||"1",collect_interval:T.collect_interval||1e3,storage_interval:T.storage_interval||300,timeout:T.timeout||1e3,resource_id:T.resource_id,enabled:T.enabled}),b(!0)},be=()=>i().length?i():[];return(()=>{var T=Cn();return r(T,_(re,{title:"设备列表",get extra(){return(()=>{var q=kn(),R=q.firstChild,I=R.nextSibling,K=I.nextSibling;return R.$$input=L=>S(L.target.value),I.$$click=B,K.$$click=ve,m(()=>R.value=d()),q})()},get children(){return j(()=>!!s())()?En():j(()=>!!u())()?(()=>{var q=Ln();return r(q,u),q})():(()=>{var q=Tn(),R=q.firstChild,I=R.firstChild,K=I.nextSibling;return r(K,_(Y,{get each(){return H()},children:L=>(()=>{var Q=An(),ue=Q.firstChild,Se=ue.nextSibling,_e=Se.nextSibling,me=_e.nextSibling,Ce=me.nextSibling,ke=Ce.nextSibling,xe=ke.nextSibling,Ee=xe.firstChild,te=xe.nextSibling,pe=te.firstChild,De=pe.nextSibling,rt=De.nextSibling;return r(ue,()=>L.id),r(Se,()=>L.name),r(_e,()=>L.driver_type),r(me,()=>L.driver_name||(L.driver_id?`驱动 #${L.driver_id}`:"-")),r(Ce,(()=>{var Ve=j(()=>!!L.resource_name);return()=>Ve()?(()=>{var Pe=Dn(),Je=Pe.firstChild,Le=Je.nextSibling;return r(Je,()=>L.resource_name),r(Le,()=>L.resource_path),Pe})():Nn()})()),r(ke,()=>L.collect_interval),r(Ee,()=>L.enabled===1?"启用":"禁用"),pe.$$click=()=>Ae(L),De.$$click=()=>N(L.id),r(De,()=>L.enabled===1?"禁用":"启用"),rt.$$click=()=>ne(L.id),m(()=>de(Ee,`badge ${L.enabled===1?"badge-running":"badge-stopped"}`)),Q})()}),null),r(K,_(Y,{get each(){return H().length===0?[1]:[]},children:()=>qn()}),null),q})()}}),null),r(T,_(U,{get when(){return g()},get children(){var q=yn(),R=q.firstChild,I=R.firstChild,K=I.firstChild,L=K.nextSibling,Q=I.nextSibling,ue=Q.firstChild,Se=ue.firstChild,_e=Se.firstChild,me=_e.nextSibling,Ce=Se.nextSibling,ke=Ce.firstChild,xe=ke.nextSibling,Ee=Ce.nextSibling,te=Ee.firstChild,pe=te.nextSibling,De=Ee.nextSibling,rt=De.firstChild,Ve=rt.nextSibling,Pe=De.nextSibling,Je=Pe.firstChild,Le=Je.nextSibling;Le.firstChild;var Ht=Pe.nextSibling,Vt=Ht.firstChild,Me=Vt.nextSibling;Me.firstChild;var ft=ue.nextSibling,Jt=ft.firstChild,pt=Jt.nextSibling,ze=ft.nextSibling,gt=ze.firstChild,zt=gt.firstChild,$t=zt.nextSibling,vt=gt.nextSibling,Qt=vt.firstChild,bt=Qt.nextSibling,Xt=vt.nextSibling,Yt=Xt.firstChild,_t=Yt.nextSibling,mt=ze.nextSibling,Zt=mt.firstChild,xt=Zt.nextSibling,el=mt.nextSibling,st=el.firstChild,yt=st.nextSibling;return r(K,()=>E()?"编辑设备":"新增设备"),L.$$click=()=>{b(!1),x(null),$(Oe)},Q.addEventListener("submit",ee),me.$$input=A=>$({...h(),name:A.target.value}),xe.$$input=A=>$({...h(),description:A.target.value}),pe.$$input=A=>$({...h(),product_key:A.target.value}),Ve.$$input=A=>$({...h(),device_key:A.target.value}),Le.addEventListener("change",A=>$({...h(),driver_id:A.target.value?+A.target.value:null})),r(Le,_(U,{get when(){return!n().length},get children(){return bn()}}),null),r(Le,_(Y,{get each(){return n()},children:A=>(()=>{var V=In(),ce=V.firstChild,he=ce.nextSibling;return he.nextSibling,r(V,()=>A.name,ce),r(V,()=>A.version||"1.0",he),m(()=>V.value=A.id),V})()}),null),Me.addEventListener("change",A=>$({...h(),resource_id:A.target.value?+A.target.value:null})),r(Me,_(U,{get when(){return!be().length},get children(){return _n()}}),null),r(Me,_(Y,{get each(){return be()},children:A=>(()=>{var V=Pn(),ce=V.firstChild,he=ce.nextSibling;return he.nextSibling,r(V,()=>A.name,ce),r(V,()=>A.type,he),r(V,(()=>{var Ne=j(()=>!!A.path);return()=>Ne()?`- ${A.path}`:""})(),null),m(()=>V.value=A.id),V})()}),null),pt.addEventListener("change",A=>$({...h(),driver_type:A.target.value,resource_id:null})),r(Q,_(U,{get when(){var A;return(A=h().driver_type)==null?void 0:A.startsWith("modbus_rtu")},get children(){var A=mn(),V=A.firstChild,ce=V.firstChild,he=ce.nextSibling,Ne=V.nextSibling,tl=Ne.firstChild,wt=tl.nextSibling,St=Ne.nextSibling,ll=St.firstChild,Ct=ll.nextSibling,kt=St.nextSibling,nl=kt.firstChild,Et=nl.nextSibling,il=kt.nextSibling,rl=il.firstChild,Lt=rl.nextSibling;return he.$$input=ge=>$({...h(),baud_rate:+ge.target.value}),wt.addEventListener("change",ge=>$({...h(),parity:ge.target.value})),Ct.$$input=ge=>$({...h(),data_bits:+ge.target.value}),Et.$$input=ge=>$({...h(),stop_bits:+ge.target.value}),Lt.$$input=ge=>$({...h(),device_address:ge.target.value}),m(()=>he.value=h().baud_rate),m(()=>wt.value=h().parity),m(()=>Ct.value=h().data_bits),m(()=>Et.value=h().stop_bits),m(()=>Lt.value=h().device_address),A}}),ze),r(Q,_(U,{get when(){var A;return(A=h().driver_type)==null?void 0:A.startsWith("modbus_tcp")},get children(){var A=xn(),V=A.firstChild,ce=V.firstChild,he=ce.nextSibling;return he.$$input=Ne=>$({...h(),device_address:Ne.target.value}),m(()=>he.value=h().device_address),A}}),ze),$t.$$input=A=>$({...h(),collect_interval:+A.target.value}),bt.$$input=A=>$({...h(),storage_interval:+A.target.value}),_t.$$input=A=>$({...h(),timeout:+A.target.value}),xt.addEventListener("change",A=>$({...h(),enabled:+A.target.value})),st.$$click=()=>{b(!1),x(null),$(Oe)},r(yt,(()=>{var A=j(()=>!!v());return()=>A()?"保存中...":E()?"保存":"创建"})()),m(A=>{var V=v(),ce=v();return V!==A.e&&(st.disabled=A.e=V),ce!==A.t&&(yt.disabled=A.t=ce),A},{e:void 0,t:void 0}),m(()=>me.value=h().name),m(()=>xe.value=h().description),m(()=>pe.value=h().product_key),m(()=>Ve.value=h().device_key),m(()=>Le.value=h().driver_id??""),m(()=>Me.value=h().resource_id??""),m(()=>pt.value=h().driver_type),m(()=>$t.value=h().collect_interval),m(()=>bt.value=h().storage_interval),m(()=>_t.value=h().timeout),m(()=>xt.value=h().enabled),q}}),null),r(T,_(U,{get when(){return C()},get children(){var q=Sn(),R=q.firstChild,I=R.firstChild,K=I.firstChild;K.firstChild;var L=K.nextSibling,Q=I.nextSibling,ue=Q.firstChild,Se=ue.firstChild,_e=Se.nextSibling,me=ue.nextSibling,Ce=me.firstChild,ke=Ce.nextSibling,xe=me.nextSibling,Ee=xe.firstChild;return r(K,()=>{var te;return(te=G())==null?void 0:te.name},null),L.$$click=()=>w(!1),Q.addEventListener("submit",se),_e.addEventListener("change",te=>O({...D(),field:te.target.value})),r(_e,_(Y,{get each(){return P()},children:te=>(()=>{var pe=Mn();return r(pe,()=>te.label||te.field),m(()=>pe.value=te.field),pe})()})),ke.$$input=te=>O({...D(),value:te.target.value}),r(Q,_(U,{get when(){return W()},get children(){var te=wn();return r(te,W),te}}),xe),Ee.$$click=()=>w(!1),m(()=>_e.value=D().field),m(()=>ke.value=D().value),q}}),null),T})()}le(["click","input"]);function jn(){return _(On,{})}var Wn=f('<label class="btn btn-primary"style=cursor:pointer>上传驱动<input type=file accept=.wasm style=display:none>'),Fn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Bn=f('<div style="color:var(--accent-red);padding:16px 0">'),Rn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>文件</th><th>大小</th><th>操作</th></tr></thead><tbody>"),Un=f('<tr><td></td><td></td><td></td><td></td><td class=flex style=gap:8px><a class=btn>下载</a><button class="btn btn-danger">删除'),Gn=f("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无驱动");function Kn(){const e=oe(),[t,l]=y([]),[i,o]=y(!0),[n,a]=y(""),s=()=>{o(!0),z("/api/drivers").then(c=>{l(c.data||c),a("")}).catch(()=>a("加载驱动失败")).finally(()=>o(!1))};Z(()=>{s()});const p=(c,d)=>{confirm(`删除驱动 ${d} ？`)&&Ie(`/api/drivers/${c}`).then(()=>{e.show("success","已删除"),s()}).catch(()=>e.show("error","删除失败"))},u=c=>{var h;const d=(h=c.target.files)==null?void 0:h[0];if(!d)return;const S=new FormData;S.append("file",d),Cl("/api/drivers/upload",S).then(()=>{e.show("success","上传成功"),s()}).catch(()=>e.show("error","上传失败")).finally(()=>{c.target.value=""})};return _(re,{title:"驱动管理",get extra(){return(()=>{var c=Wn(),d=c.firstChild,S=d.nextSibling;return S.addEventListener("change",u),c})()},get children(){return j(()=>!!i())()?Fn():j(()=>!!n())()?(()=>{var c=Bn();return r(c,n),c})():(()=>{var c=Rn(),d=c.firstChild,S=d.firstChild,h=S.nextSibling;return r(h,_(Y,{get each(){return t()},children:$=>(()=>{var E=Un(),x=E.firstChild,g=x.nextSibling,b=g.nextSibling,v=b.nextSibling,k=v.nextSibling,C=k.firstChild,w=C.nextSibling;return r(x,()=>$.id),r(g,()=>$.name),r(b,()=>$.filename||$.file_path||""),r(v,(()=>{var P=j(()=>!!$.size);return()=>P()?($.size/1024).toFixed(1)+" KB":"-"})()),w.$$click=()=>p($.id,$.name),m(()=>fe(C,"href",`/api/drivers/${$.id}/download`)),E})()}),null),r(h,_(Y,{get each(){return t().length===0?[1]:[]},children:()=>Gn()}),null),c})()}})}le(["click"]);function Hn(){return _(Kn,{})}var Vn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:480px;max-width:90vw><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input placeholder=配置名称 required></div><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=http>HTTP</option><option value=mqtt>MQTT</option><option value=xunji>寻迹</option></select></div><div class=form-group><label class=form-label>上传间隔 (ms)</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>配置 (JSON)</label><textarea class=form-input rows=5 placeholder="{ &quot;url&quot;: &quot;http://...&quot;, &quot;method&quot;: &quot;POST&quot; }"style=font-family:monospace;font-size:13px></textarea></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),Jn=f("<div>"),zn=f('<button class="btn btn-primary">新增配置'),Qn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Xn=f("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置"),Yn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>上传间隔(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Zn=f('<tr><td></td><td></td><td><span class="badge badge-info"></span></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const je={name:"",type:"http",upload_interval:5e3,config:"{}",enabled:1};function ei(){const e=oe(),[t,l]=y([]),[i,o]=y(!0),[n,a]=y(je),[s,p]=y(null),[u,c]=y(!1),[d,S]=y(!1),h=()=>{o(!0),z("/api/northbound").then(v=>l(v.data||v)).catch(()=>e.show("error","加载北向配置失败")).finally(()=>o(!1))};Z(()=>{h()});const $=v=>{v.preventDefault(),S(!0),(s()?He(`/api/northbound/${s()}`,n()):ae("/api/northbound",n())).then(()=>{e.show("success",s()?"已更新":"已创建"),a(je),p(null),c(!1),h()}).catch(()=>e.show("error","操作失败")).finally(()=>S(!1))},E=(v,k)=>{ae(`/api/northbound/${v}/toggle`,{}).then(h).catch(()=>e.show("error","切换失败"))},x=v=>{confirm("删除该配置？")&&Ie(`/api/northbound/${v}`).then(()=>{e.show("success","已删除"),h()}).catch(()=>e.show("error","删除失败"))},g=()=>{a(je),p(null),c(!0)},b=v=>{p(v.id),a({name:v.name,type:v.type,upload_interval:v.upload_interval,config:v.config,enabled:v.enabled}),c(!0)};return(()=>{var v=Jn();return r(v,_(re,{title:"北向配置列表",get extra(){return(()=>{var k=zn();return k.$$click=g,k})()},get children(){return j(()=>!!i())()?Qn():(()=>{var k=Yn(),C=k.firstChild,w=C.firstChild,P=w.nextSibling;return r(P,_(Y,{get each(){return t()},children:D=>(()=>{var O=Zn(),W=O.firstChild,M=W.nextSibling,G=M.nextSibling,F=G.firstChild,B=G.nextSibling,H=B.nextSibling,ee=H.firstChild,N=H.nextSibling,ne=N.firstChild,se=ne.nextSibling,ve=se.nextSibling;return r(W,()=>D.id),r(M,()=>D.name),r(F,()=>D.type.toUpperCase()),r(B,()=>D.upload_interval),r(ee,()=>D.enabled===1?"启用":"禁用"),ne.$$click=()=>b(D),se.$$click=()=>E(D.id,D.enabled===1),r(se,()=>D.enabled===1?"禁用":"启用"),ve.$$click=()=>x(D.id),m(()=>de(ee,`badge ${D.enabled===1?"badge-running":"badge-stopped"}`)),O})()}),null),r(P,_(U,{get when(){return t().length===0},get children(){return Xn()}}),null),k})()}}),null),r(v,_(U,{get when(){return u()},get children(){var k=Vn(),C=k.firstChild,w=C.firstChild,P=w.firstChild,D=P.nextSibling,O=w.nextSibling,W=O.firstChild,M=W.firstChild,G=M.nextSibling,F=W.nextSibling,B=F.firstChild,H=B.firstChild,ee=H.nextSibling,N=B.nextSibling,ne=N.firstChild,se=ne.nextSibling,ve=F.nextSibling,Ae=ve.firstChild,be=Ae.nextSibling,T=ve.nextSibling,q=T.firstChild,R=q.nextSibling;return r(P,()=>s()?"编辑北向配置":"新增北向配置"),D.$$click=()=>{c(!1),p(null),a(je)},O.addEventListener("submit",$),G.$$input=I=>a({...n(),name:I.target.value}),ee.addEventListener("change",I=>a({...n(),type:I.target.value})),se.$$input=I=>a({...n(),upload_interval:+I.target.value}),be.$$input=I=>a({...n(),config:I.target.value}),q.$$click=()=>{c(!1),p(null),a(je)},r(R,(()=>{var I=j(()=>!!d());return()=>I()?"保存中...":s()?"保存":"创建"})()),m(I=>{var K=d(),L=d();return K!==I.e&&(q.disabled=I.e=K),L!==I.t&&(R.disabled=I.t=L),I},{e:void 0,t:void 0}),m(()=>G.value=n().name),m(()=>ee.value=n().type),m(()=>se.value=n().upload_interval),m(()=>be.value=n().config),k}}),null),v})()}le(["click","input"]);function ti(){return _(ei,{})}var li=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>设备</th><th>字段</th><th>条件</th><th>严重性</th><th>状态</th><th>操作</th></tr></thead><tbody>"),ni=f('<div style="color:var(--accent-red);padding:4px 0">'),ii=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:440px;max-width:92vw><div class=card-header><h3 class=card-title>新增阈值</h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>设备</label><select class=form-select required><option value>选择设备</option></select></div><div class=form-group><label class=form-label>字段名</label><input class=form-input required></div><div class=grid style="gridTemplateColumns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>运算符</label><select class=form-select><option value=">">大于 &gt;</option><option value=">=">大于等于 &gt;=</option><option value="<">小于 &lt;</option><option value="<=">小于等于 &lt;=</option><option value="==">等于 ==</option></select></div><div class=form-group><label class=form-label>阈值</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>严重程度</label><select class=form-select><option value=info>info</option><option value=warning>warning</option><option value=error>error</option><option value=critical>critical</option></select></div><div class=form-group><label class=form-label>报警消息</label><input class=form-input></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),ri=f("<div>"),si=f('<button class="btn btn-primary">新增阈值'),ai=f('<tr><td></td><td></td><td></td><td> </td><td></td><td><span></span></td><td><button class="btn btn-danger">删除'),oi=f("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无阈值"),ci=f("<option>");const Xe={device_id:"",field_name:"",operator:">",value:0,severity:"warning",message:"",enabled:1};function di(){const e=oe(),[t,l]=y([]),[i,o]=y([]),[n,a]=y(Xe),[s,p]=y(!1),[u,c]=y(!1),[d,S]=y(""),h=()=>{z("/api/thresholds").then(g=>l(g.data||g)).catch(()=>e.show("error","加载阈值失败"))},$=()=>{z("/api/devices").then(g=>o(g.data||g)).catch(()=>{})};Z(()=>{h(),$()}),Z(()=>{if(!s())return;const g=b=>{b.key==="Escape"&&p(!1)};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)});const E=g=>{g.preventDefault(),c(!0),S(""),ae("/api/thresholds",n()).then(()=>{e.show("success","阈值已创建"),a(Xe),p(!1),h()}).catch(b=>{S(b.message||"创建失败"),e.show("error","创建失败")}).finally(()=>c(!1))},x=g=>{confirm("删除该阈值？")&&Ie(`/api/thresholds/${g}`).then(()=>{e.show("success","已删除"),h()}).catch(()=>e.show("error","删除失败"))};return(()=>{var g=ri();return r(g,_(re,{title:"阈值配置列表",get extra(){return(()=>{var b=si();return b.$$click=()=>{a(Xe),S(""),p(!0)},b})()},get children(){var b=li(),v=b.firstChild,k=v.firstChild,C=k.nextSibling;return r(C,_(Y,{get each(){return t()},children:w=>(()=>{var P=ai(),D=P.firstChild,O=D.nextSibling,W=O.nextSibling,M=W.nextSibling,G=M.firstChild,F=M.nextSibling,B=F.nextSibling,H=B.firstChild,ee=B.nextSibling,N=ee.firstChild;return r(D,()=>w.id),r(O,()=>w.device_id),r(W,()=>w.field_name),r(M,()=>w.operator,G),r(M,()=>w.value,null),r(F,()=>w.severity),r(H,()=>w.enabled===1?"启用":"禁用"),N.$$click=()=>x(w.id),m(()=>de(H,`badge ${w.enabled===1?"badge-running":"badge-stopped"}`)),P})()}),null),r(C,_(Y,{get each(){return t().length===0?[1]:[]},children:()=>oi()}),null),b}}),null),r(g,_(U,{get when(){return s()},get children(){var b=ii(),v=b.firstChild,k=v.firstChild,C=k.nextSibling,w=C.firstChild,P=w.firstChild,D=P.nextSibling;D.firstChild;var O=w.nextSibling,W=O.firstChild,M=W.nextSibling,G=O.nextSibling,F=G.firstChild,B=F.firstChild,H=B.nextSibling,ee=F.nextSibling,N=ee.firstChild,ne=N.nextSibling,se=G.nextSibling,ve=se.firstChild,Ae=ve.nextSibling,be=se.nextSibling,T=be.firstChild,q=T.nextSibling,R=be.nextSibling,I=R.firstChild,K=I.nextSibling;return b.$$click=L=>{L.target===L.currentTarget&&p(!1)},C.addEventListener("submit",E),D.addEventListener("change",L=>a({...n(),device_id:+L.target.value})),r(D,()=>i().map(L=>(()=>{var Q=ci();return r(Q,()=>L.name||L.id),m(()=>fe(Q,"key",L.id)),m(()=>Q.value=L.id),Q})()),null),M.$$input=L=>a({...n(),field_name:L.target.value}),H.addEventListener("change",L=>a({...n(),operator:L.target.value})),ne.$$input=L=>a({...n(),value:+L.target.value}),Ae.addEventListener("change",L=>a({...n(),severity:L.target.value})),q.$$input=L=>a({...n(),message:L.target.value}),r(C,_(U,{get when(){return d()},get children(){var L=ni();return r(L,d),L}}),R),I.$$click=()=>{p(!1),a(Xe)},r(K,()=>u()?"创建中...":"创建"),m(L=>{var Q=u(),ue=u();return Q!==L.e&&(I.disabled=L.e=Q),ue!==L.t&&(K.disabled=L.t=ue),L},{e:void 0,t:void 0}),m(()=>D.value=n().device_id),m(()=>M.value=n().field_name),m(()=>H.value=n().operator),m(()=>ne.value=n().value),m(()=>Ae.value=n().severity),m(()=>q.value=n().message),b}}),null),g})()}le(["click","input"]);function ui(){return _(di,{})}var hi=f("<div class=table-container style=max-height:600px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备ID</th><th>字段</th><th>实际值</th><th>阈值条件</th><th>级别</th><th>消息</th><th>状态</th><th>操作</th></tr></thead><tbody>"),fi=f("<button class=btn>刷新"),pi=f("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td></td><td></td><td>"),gi=f('<span class="text-muted text-xs">已确认'),$i=f("<span class=text-warning>未确认"),vi=f('<button class="btn btn-primary btn-sm">确认'),bi=f("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无告警");function _i(){const e=oe(),[t,l]=y([]),i=()=>{z("/api/alarms").then(n=>l(n.data||n)).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const o=n=>{ae(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return _(re,{title:"报警日志",get extra(){return(()=>{var n=fi();return n.$$click=i,n})()},get children(){var n=hi(),a=n.firstChild,s=a.firstChild,p=s.nextSibling;return r(p,_(Y,{get each(){return t()},children:u=>(()=>{var c=pi(),d=c.firstChild,S=d.nextSibling,h=S.nextSibling,$=h.nextSibling,E=$.nextSibling,x=E.nextSibling,g=x.firstChild,b=x.nextSibling,v=b.nextSibling,k=v.nextSibling;return r(d,()=>{var C;return((C=u.triggered_at)==null?void 0:C.slice(5,19))||u.triggered_at}),r(S,()=>u.device_id),r(h,()=>u.field_name),r($,()=>u.actual_value),r(E,()=>`${u.operator} ${u.threshold_value}`),r(g,()=>u.severity||"warn"),r(b,()=>u.message||"-"),r(v,(()=>{var C=j(()=>u.acknowledged===1);return()=>C()?gi():$i()})()),r(k,(()=>{var C=j(()=>u.acknowledged!==1);return()=>C()&&(()=>{var w=vi();return w.$$click=()=>o(u.id),w})()})()),m(()=>de(g,`badge ${u.severity==="critical"?"badge-critical":"badge-running"}`)),c})()}),null),r(p,_(Y,{get each(){return t().length===0?[1]:[]},children:()=>bi()}),null),n}})}le(["click"]);var mi=f("<div class=tabs style=flex-wrap:wrap;gap:6px;margin-bottom:16px>"),xi=f("<button>"),yi=f('<div style="color:var(--text-muted);padding:8px 4px">暂无设备'),wi=f("<div style=padding:24px>加载中..."),Si=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Ci=f("<tr><td></td><td></td><td></td><td>"),ki=f("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无数据");function Ei(){const e=oe(),[t,l]=y([]),[i,o]=y(""),[n,a]=y([]),[s,p]=y(!1);return Z(()=>{z("/api/devices").then(u=>{const c=u.data||u;l(c),c.length&&o(String(c[0].id))}).catch(()=>e.show("error","加载设备失败"))}),Z(()=>{i()&&(p(!0),z(`/api/data/cache/${i()}`).then(u=>{const c=u.data||u||[];c.sort((d,S)=>String(d.field_name||"").localeCompare(String(S.field_name||""))),a(c)}).catch(()=>e.show("error","加载实时数据失败")).finally(()=>p(!1)))}),_(re,{title:"实时数据",get children(){return[(()=>{var u=mi();return r(u,()=>t().map(c=>(()=>{var d=xi();return d.$$click=()=>o(String(c.id)),r(d,()=>c.name||c.id),m(()=>de(d,`tab-btn ${i()===String(c.id)?"active":""}`)),d})()),null),r(u,(()=>{var c=j(()=>t().length===0);return()=>c()&&yi()})(),null),u})(),j(()=>j(()=>!!s())()?wi():(()=>{var u=Si(),c=u.firstChild,d=c.firstChild,S=d.nextSibling;return r(S,()=>n().map(h=>{var E;const $=((E=t().find(x=>String(x.id)===String(h.device_id)))==null?void 0:E.name)||h.device_name||"";return(()=>{var x=Ci(),g=x.firstChild,b=g.nextSibling,v=b.nextSibling,k=v.nextSibling;return r(g,()=>h.collected_at||h.CollectedAt||""),r(b,$),r(v,()=>h.field_name||""),r(k,()=>h.value),m(()=>fe(x,"key",h.id||`${h.device_id}-${h.field_name}`)),x})()}),null),r(S,(()=>{var h=j(()=>n().length===0);return()=>h()&&ki()})(),null),u})())]}})}le(["click"]);var Li=f('<div class="flex gap-3"><select class=form-select><option value>全部设备</option></select><button class=btn>刷新'),Ti=f("<option>"),Ai=f("<div style=padding:24px>加载中..."),Di=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Ni=f("<tr><td></td><td></td><td></td><td>"),qi=f("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无历史数据");function Ii(){const e=oe(),[t,l]=y(""),[i,o]=y([]),[n,a]=y(!1),[s,p]=y([]);Z(()=>{z("/api/devices").then(c=>p(c.data||c)).catch(()=>{})});const u=()=>{a(!0);const c=t()?`/api/data/history?device_id=${t()}`:"/api/data/history";z(c).then(d=>o(d.data||d)).catch(()=>e.show("error","加载历史数据失败")).finally(()=>a(!1))};return Z(()=>{u()}),_(re,{title:"历史数据",get extra(){return(()=>{var c=Li(),d=c.firstChild;d.firstChild;var S=d.nextSibling;return d.addEventListener("change",h=>l(h.target.value)),r(d,()=>s().map(h=>(()=>{var $=Ti();return r($,()=>h.name||h.id),m(()=>fe($,"key",h.id)),m(()=>$.value=h.id),$})()),null),S.$$click=u,m(()=>d.value=t()),c})()},get children(){return j(()=>!!n())()?Ai():(()=>{var c=Di(),d=c.firstChild,S=d.firstChild,h=S.nextSibling;return r(h,()=>i().map($=>(()=>{var E=Ni(),x=E.firstChild,g=x.nextSibling,b=g.nextSibling,v=b.nextSibling;return r(x,()=>{var k;return((k=$.collected_at)==null?void 0:k.slice(0,19))||$.CollectedAt}),r(g,()=>$.device_name||$.DeviceName),r(b,()=>$.field_name||$.FieldName),r(v,()=>$.value||$.Value),m(()=>fe(E,"key",$.id)),E})()),null),r(h,(()=>{var $=j(()=>i().length===0);return()=>$()&&qi()})(),null),c})()}})}le(["click"]);var Pi=f('<form class=form><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>保留天数</label><input class=form-input type=number required></div><div class=flex style=gap:12px;margin-top:12px><button class="btn btn-primary"type=submit style=flex:1></button><button class=btn type=button style=flex:1>重置'),Mi=f('<div class=grid style="grid-template-columns:3fr 1.4fr;gap:24px">'),Oi=f("<button class=btn>立即清理"),ji=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Wi=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>保留天数</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Fi=f('<tr><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class="btn btn-danger">删除'),Bi=f("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置");const ot={name:"",storage_days:30,enabled:1};function Ri(){const e=oe(),[t,l]=y([]),[i,o]=y(!0),[n,a]=y(ot),[s,p]=y(null),[u,c]=y(!1),d=()=>{o(!0),z("/api/storage").then(x=>l(x.data||x)).catch(()=>e.show("error","加载存储配置失败")).finally(()=>o(!1))};Z(()=>{d()});const S=x=>{x.preventDefault(),c(!0),(s()?He(`/api/storage/${s()}`,n()):ae("/api/storage",n())).then(()=>{e.show("success",s()?"已更新":"已创建"),a(ot),p(null),d()}).catch(()=>e.show("error","操作失败")).finally(()=>c(!1))},h=x=>{confirm("删除该配置？")&&Ie(`/api/storage/${x}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))},$=x=>{p(x.id),a({name:x.name,storage_days:x.storage_days,enabled:x.enabled})},E=()=>{ae("/api/storage/run",{}).then(x=>e.show("success",`清理完成，删除 ${x.deleted_count} 条记录`)).catch(()=>e.show("error","清理失败"))};return(()=>{var x=Mi();return r(x,_(re,{title:"存储策略列表",get extra(){return(()=>{var g=Oi();return g.$$click=E,g})()},get children(){return j(()=>!!i())()?ji():(()=>{var g=Wi(),b=g.firstChild,v=b.firstChild,k=v.nextSibling;return r(k,_(Y,{get each(){return t()},children:C=>(()=>{var w=Fi(),P=w.firstChild,D=P.nextSibling,O=D.nextSibling,W=O.nextSibling,M=W.firstChild,G=W.nextSibling,F=G.firstChild,B=F.nextSibling;return r(P,()=>C.id),r(D,()=>C.name),r(O,()=>C.storage_days),r(M,()=>C.enabled===1?"启用":"禁用"),F.$$click=()=>$(C),B.$$click=()=>h(C.id),m(()=>de(M,`badge ${C.enabled===1?"badge-running":"badge-stopped"}`)),w})()}),null),r(k,_(Y,{get each(){return t().length===0?[1]:[]},children:()=>Bi()}),null),g})()}}),null),r(x,_(re,{get title(){return s()?"编辑存储策略":"新增存储策略"},get children(){var g=Pi(),b=g.firstChild,v=b.firstChild,k=v.nextSibling,C=b.nextSibling,w=C.firstChild,P=w.nextSibling,D=C.nextSibling,O=D.firstChild,W=O.nextSibling;return g.addEventListener("submit",S),k.$$input=M=>a({...n(),name:M.target.value}),P.$$input=M=>a({...n(),storage_days:+M.target.value}),r(O,(()=>{var M=j(()=>!!u());return()=>M()?"保存中...":s()?"保存":"创建"})()),W.$$click=()=>{a(ot),p(null)},m(()=>O.disabled=u()),m(()=>k.value=n().name),m(()=>P.value=n().storage_days),g}}),null),x})()}le(["input","click"]);function Ui(){return _(Ri,{})}var Gi=f("<div><main class=container style=padding-top:32px;padding-bottom:32px></main><div id=toast-container class=toast-container>");function Ki(){const[e,t]=xl(),[l,i]=y(!0);Z(()=>{e()!=="/login"&&z("/api/status").then(()=>i(!0)).catch(()=>{i(!1),Kt("/login")})});const o=()=>{const n=e();switch(!0){case n==="/login":return _(en,{onSuccess:()=>t("/")});case n==="/":return _(Nt,{});case n.startsWith("/gateway"):return _(an,{});case n.startsWith("/resources"):return _(vn,{});case n.startsWith("/devices"):return _(jn,{});case n.startsWith("/drivers"):return _(Hn,{});case n.startsWith("/northbound"):return _(ti,{});case n.startsWith("/storage"):return _(Ui,{});case n.startsWith("/thresholds"):return _(ui,{});case n.startsWith("/alarms"):return _(_i,{});case n.startsWith("/realtime"):return _(Ei,{});case n.startsWith("/history"):return _(Ii,{});default:return _(Nt,{})}};return(()=>{var n=Gi(),a=n.firstChild;return r(n,_(U,{get when(){return e()!=="/login"},get children(){return _(Nl,{get path(){return e()},onNav:t})}}),a),r(a,o),n})()}const qt=document.getElementById("app-root");qt&&Bt(()=>_(Ki,{}),qt);const Hi={};typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-solid-island]").forEach(e=>{const t=e.getAttribute("data-solid-island"),l=Hi[t];if(!l)return;const i=e.dataset.props?JSON.parse(e.dataset.props):{};Bt(()=>_(l,i),e)})});
