const sl=(e,t)=>e===t,al=Symbol("solid-track"),lt={equals:sl};let Mt=Ut;const Se=1,nt=2,Rt={owned:null,cleanups:null,context:null,owner:null};var Q=null;let pt=null,ol=null,H=null,te=null,be=null,at=0;function tt(e,t){const l=H,i=Q,a=e.length===0,n=t===void 0?i:t,d=a?Rt:{owned:null,cleanups:null,context:n?n.context:null,owner:n},o=a?e:()=>e(()=>Ae(()=>Ke(d)));Q=d,H=null;try{return ze(o,!0)}finally{H=l,Q=i}}function w(e,t){t=t?Object.assign({},lt,t):lt;const l={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=a=>(typeof a=="function"&&(a=a(l.value)),Ft(l,a));return[Wt.bind(l),i]}function v(e,t,l){const i=vt(e,t,!1,Se);Ve(i)}function Z(e,t,l){Mt=ul;const i=vt(e,t,!1,Se);i.user=!0,be?be.push(i):Ve(i)}function Be(e,t,l){l=l?Object.assign({},lt,l):lt;const i=vt(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=l.equals||void 0,Ve(i),Wt.bind(i)}function Ae(e){if(H===null)return e();const t=H;H=null;try{return e()}finally{H=t}}function Je(e){return Q===null||(Q.cleanups===null?Q.cleanups=[e]:Q.cleanups.push(e)),e}function Wt(){if(this.sources&&this.state)if(this.state===Se)Ve(this);else{const e=te;te=null,ze(()=>rt(this),!1),te=e}if(H){const e=this.observers?this.observers.length:0;H.sources?(H.sources.push(this),H.sourceSlots.push(e)):(H.sources=[this],H.sourceSlots=[e]),this.observers?(this.observers.push(H),this.observerSlots.push(H.sources.length-1)):(this.observers=[H],this.observerSlots=[H.sources.length-1])}return this.value}function Ft(e,t,l){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&ze(()=>{for(let a=0;a<e.observers.length;a+=1){const n=e.observers[a],d=pt&&pt.running;d&&pt.disposed.has(n),(d?!n.tState:!n.state)&&(n.pure?te.push(n):be.push(n),n.observers&&Bt(n)),d||(n.state=Se)}if(te.length>1e6)throw te=[],new Error},!1)),t}function Ve(e){if(!e.fn)return;Ke(e);const t=at;dl(e,e.value,t)}function dl(e,t,l){let i;const a=Q,n=H;H=Q=e;try{i=e.fn(t)}catch(d){return e.pure&&(e.state=Se,e.owned&&e.owned.forEach(Ke),e.owned=null),e.updatedAt=l+1,Kt(d)}finally{H=n,Q=a}(!e.updatedAt||e.updatedAt<=l)&&(e.updatedAt!=null&&"observers"in e?Ft(e,i):e.value=i,e.updatedAt=l)}function vt(e,t,l,i=Se,a){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Q,context:Q?Q.context:null,pure:l};return Q===null||Q!==Rt&&(Q.owned?Q.owned.push(n):Q.owned=[n]),n}function it(e){if(e.state===0)return;if(e.state===nt)return rt(e);if(e.suspense&&Ae(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<at);)e.state&&t.push(e);for(let l=t.length-1;l>=0;l--)if(e=t[l],e.state===Se)Ve(e);else if(e.state===nt){const i=te;te=null,ze(()=>rt(e,t[0]),!1),te=i}}function ze(e,t){if(te)return e();let l=!1;t||(te=[]),be?l=!0:be=[],at++;try{const i=e();return cl(l),i}catch(i){l||(be=null),te=null,Kt(i)}}function cl(e){if(te&&(Ut(te),te=null),e)return;const t=be;be=null,t.length&&ze(()=>Mt(t),!1)}function Ut(e){for(let t=0;t<e.length;t++)it(e[t])}function ul(e){let t,l=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[l++]=i:it(i)}for(t=0;t<l;t++)it(e[t])}function rt(e,t){e.state=0;for(let l=0;l<e.sources.length;l+=1){const i=e.sources[l];if(i.sources){const a=i.state;a===Se?i!==t&&(!i.updatedAt||i.updatedAt<at)&&it(i):a===nt&&rt(i,t)}}}function Bt(e){for(let t=0;t<e.observers.length;t+=1){const l=e.observers[t];l.state||(l.state=nt,l.pure?te.push(l):be.push(l),l.observers&&Bt(l))}}function Ke(e){let t;if(e.sources)for(;e.sources.length;){const l=e.sources.pop(),i=e.sourceSlots.pop(),a=l.observers;if(a&&a.length){const n=a.pop(),d=l.observerSlots.pop();i<a.length&&(n.sourceSlots[d]=i,a[i]=n,l.observerSlots[i]=d)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ke(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ke(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function fl(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Kt(e,t=Q){throw fl(e)}const hl=Symbol("fallback");function Dt(e){for(let t=0;t<e.length;t++)e[t]()}function pl(e,t,l={}){let i=[],a=[],n=[],d=0,o=t.length>1?[]:null;return Je(()=>Dt(n)),()=>{let f=e()||[],c=f.length,u,s;return f[al],Ae(()=>{let $,y,T,m,p,g,x,S,C;if(c===0)d!==0&&(Dt(n),n=[],i=[],a=[],d=0,o&&(o=[])),l.fallback&&(i=[hl],a[0]=tt(k=>(n[0]=k,l.fallback())),d=1);else if(d===0){for(a=new Array(c),s=0;s<c;s++)i[s]=f[s],a[s]=tt(_);d=c}else{for(T=new Array(c),m=new Array(c),o&&(p=new Array(c)),g=0,x=Math.min(d,c);g<x&&i[g]===f[g];g++);for(x=d-1,S=c-1;x>=g&&S>=g&&i[x]===f[S];x--,S--)T[S]=a[x],m[S]=n[x],o&&(p[S]=o[x]);for($=new Map,y=new Array(S+1),s=S;s>=g;s--)C=f[s],u=$.get(C),y[s]=u===void 0?-1:u,$.set(C,s);for(u=g;u<=x;u++)C=i[u],s=$.get(C),s!==void 0&&s!==-1?(T[s]=a[u],m[s]=n[u],o&&(p[s]=o[u]),s=y[s],$.set(C,s)):n[u]();for(s=g;s<c;s++)s in T?(a[s]=T[s],n[s]=m[s],o&&(o[s]=p[s],o[s](s))):a[s]=tt(_);a=a.slice(0,d=c),i=f.slice(0)}return a});function _($){if(n[s]=$,o){const[y,T]=w(s);return o[s]=T,t(f[s],y)}return t(f[s])}}}function b(e,t){return Ae(()=>e(t||{}))}const gl=e=>`Stale read from <${e}>.`;function le(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Be(pl(()=>e.each,e.children,t||void 0))}function X(e){const t=e.keyed,l=Be(()=>e.when,void 0,void 0),i=t?l:Be(l,void 0,{equals:(a,n)=>!a==!n});return Be(()=>{const a=i();if(a){const n=e.children;return typeof n=="function"&&n.length>0?Ae(()=>n(t?a:()=>{if(!Ae(i))throw gl("Show");return l()})):n}return e.fallback},void 0,void 0)}const V=e=>Be(()=>e());function $l(e,t,l){let i=l.length,a=t.length,n=i,d=0,o=0,f=t[a-1].nextSibling,c=null;for(;d<a||o<n;){if(t[d]===l[o]){d++,o++;continue}for(;t[a-1]===l[n-1];)a--,n--;if(a===d){const u=n<i?o?l[o-1].nextSibling:l[n-o]:f;for(;o<n;)e.insertBefore(l[o++],u)}else if(n===o)for(;d<a;)(!c||!c.has(t[d]))&&t[d].remove(),d++;else if(t[d]===l[n-1]&&l[o]===t[a-1]){const u=t[--a].nextSibling;e.insertBefore(l[o++],t[d++].nextSibling),e.insertBefore(l[--n],u),t[a]=l[n]}else{if(!c){c=new Map;let s=o;for(;s<n;)c.set(l[s],s++)}const u=c.get(t[d]);if(u!=null)if(o<u&&u<n){let s=d,_=1,$;for(;++s<a&&s<n&&!(($=c.get(t[s]))==null||$!==u+_);)_++;if(_>u-o){const y=t[d];for(;o<u;)e.insertBefore(l[o++],y)}else e.replaceChild(l[o++],t[d++])}else d++;else t[d++].remove()}}}const Nt="_$DX_DELEGATE";function Jt(e,t,l,i={}){let a;return tt(n=>{a=n,t===document?e():r(t,e(),t.firstChild?null:void 0,l)},i.owner),()=>{a(),t.textContent=""}}function h(e,t,l,i){let a;const n=()=>{const o=document.createElement("template");return o.innerHTML=e,o.content.firstChild},d=()=>(a||(a=n())).cloneNode(!0);return d.cloneNode=d,d}function ne(e,t=window.document){const l=t[Nt]||(t[Nt]=new Set);for(let i=0,a=e.length;i<a;i++){const n=e[i];l.has(n)||(l.add(n),t.addEventListener(n,bl))}}function oe(e,t,l){l==null?e.removeAttribute(t):e.setAttribute(t,l)}function de(e,t){t==null?e.removeAttribute("class"):e.className=t}function vl(e,t,l){if(!t)return l?oe(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof l=="string"&&(i.cssText=l=void 0),l||(l={}),t||(t={});let a,n;for(n in l)t[n]==null&&i.removeProperty(n),delete l[n];for(n in t)a=t[n],a!==l[n]&&(i.setProperty(n,a),l[n]=a);return l}function Vt(e,t,l){return Ae(()=>e(t,l))}function r(e,t,l,i){if(l!==void 0&&!i&&(i=[]),typeof t!="function")return st(e,t,i,l);v(a=>st(e,t(),a,l),i)}function bl(e){let t=e.target;const l=`$$${e.type}`,i=e.target,a=e.currentTarget,n=f=>Object.defineProperty(e,"target",{configurable:!0,value:f}),d=()=>{const f=t[l];if(f&&!t.disabled){const c=t[`${l}Data`];if(c!==void 0?f.call(t,c,e):f.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},o=()=>{for(;d()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const f=e.composedPath();n(f[0]);for(let c=0;c<f.length-2&&(t=f[c],!!d());c++){if(t._$host){t=t._$host,o();break}if(t.parentNode===a)break}}else o();n(i)}function st(e,t,l,i,a){for(;typeof l=="function";)l=l();if(t===l)return l;const n=typeof t,d=i!==void 0;if(e=d&&l[0]&&l[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===l))return l;if(d){let o=l[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),l=qe(e,l,i,o)}else l!==""&&typeof l=="string"?l=e.firstChild.data=t:l=e.textContent=t}else if(t==null||n==="boolean")l=qe(e,l,i);else{if(n==="function")return v(()=>{let o=t();for(;typeof o=="function";)o=o();l=st(e,o,l,i)}),()=>l;if(Array.isArray(t)){const o=[],f=l&&Array.isArray(l);if($t(o,t,l,a))return v(()=>l=st(e,o,l,i,!0)),()=>l;if(o.length===0){if(l=qe(e,l,i),d)return l}else f?l.length===0?qt(e,o,i):$l(e,l,o):(l&&qe(e),qt(e,o));l=o}else if(t.nodeType){if(Array.isArray(l)){if(d)return l=qe(e,l,i,t);qe(e,l,null,t)}else l==null||l===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);l=t}}return l}function $t(e,t,l,i){let a=!1;for(let n=0,d=t.length;n<d;n++){let o=t[n],f=l&&l[e.length],c;if(!(o==null||o===!0||o===!1))if((c=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))a=$t(e,o,f)||a;else if(c==="function")if(i){for(;typeof o=="function";)o=o();a=$t(e,Array.isArray(o)?o:[o],Array.isArray(f)?f:[f])||a}else e.push(o),a=!0;else{const u=String(o);f&&f.nodeType===3&&f.data===u?e.push(f):e.push(document.createTextNode(u))}}return a}function qt(e,t,l=null){for(let i=0,a=t.length;i<a;i++)e.insertBefore(t[i],l)}function qe(e,t,l,i){if(l===void 0)return e.textContent="";const a=i||document.createTextNode("");if(t.length){let n=!1;for(let d=t.length-1;d>=0;d--){const o=t[d];if(a!==o){const f=o.parentNode===e;!n&&!d?f?e.replaceChild(a,o):e.insertBefore(a,l):f&&o.remove()}else n=!0}}else e.insertBefore(a,l);return[a]}const[zt,Ht]=w(window.location.pathname||"/"),[_l,Qt]=w(new URLSearchParams(window.location.search));if(typeof window<"u"){const e=()=>{Ht(window.location.pathname||"/"),Qt(new URLSearchParams(window.location.search))};window.addEventListener("popstate",e),Je(()=>window.removeEventListener("popstate",e))}function Gt(e,t={}){const l=zt();e!==l&&(t.replace?window.history.replaceState({},"",e):window.history.pushState({},"",e),Ht(e),Qt(new URLSearchParams(window.location.search)),window.scrollTo({top:0,behavior:"smooth"}))}function ml(){return[zt,Gt,_l]}function we(e,t){return t==="/"?e==="/":String(e).startsWith(t)}const bt="gogw_jwt";function xl(){return localStorage.getItem(bt)||""}function _t(e={}){const t=xl();return t?{...e,Authorization:`Bearer ${t}`}:e}function yl(e){if(e.status===401)throw localStorage.removeItem(bt),window.location.href="/login",new Error("unauthorized")}async function He(e,t={}){const l=await fetch(e,{credentials:"same-origin",headers:_t(t.headers),...t});return yl(l),l}async function Qe(e){if(e.status===204)return null;const t=await e.text();if(!t)return null;try{const l=JSON.parse(t);if(l&&typeof l=="object"&&"success"in l){if(l.success)return l.data??null;const i=l.error||l.message||"request failed";throw new Error(i)}return l}catch{throw new Error("invalid json")}}function wl(e){e&&localStorage.setItem(bt,e)}async function Y(e,t={}){const l=await He(e,t);if(!l.ok)throw new Error(`${l.status} ${l.statusText}`);return Qe(l)}async function re(e,t,l={}){const i=await He(e,{method:"POST",headers:_t({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Qe(i)}async function ot(e,t,l={}){const i=await He(e,{method:"PUT",headers:_t({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Qe(i)}async function Ie(e){const t=await He(e,{method:"DELETE"});if(!t.ok&&t.status!==204)throw new Error(`${t.status} ${t.statusText}`);return t.status===204?null:Qe(t)}async function Sl(e,t,l={}){const i=await He(e,{method:"POST",body:t,...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Qe(i)}var Cl=h("<div class=dropdown-menu>"),kl=h('<nav class=nav><div class="container nav-inner"><div class=nav-brand><div class=nav-logo>☰</div><div><div class=nav-title>HuShu智能网关</div><div class=nav-subtitle>工业物联网网关管理</div></div></div><div class=nav-links><div class=dropdown><button>设置 ▾</button></div><a class="btn btn-danger"href=/logout>退出'),It=h("<a>");const El=[{to:"/",label:"仪表盘"},{to:"/alarms",label:"报警"},{to:"/realtime",label:"实时"},{to:"/history",label:"历史"}],Tl=[{to:"/resources",label:"资源"},{to:"/devices",label:"设备"},{to:"/drivers",label:"驱动"},{to:"/northbound",label:"北向"},{to:"/storage",label:"存储策略"},{to:"/thresholds",label:"阈值"}];function Ll(e){const[t,l]=w(!1);let i;const a=o=>{localStorage.removeItem("gogw_jwt")},n=()=>{l(!1)},d=o=>{i&&!i.contains(o.target)&&l(!1)};return(()=>{var o=kl(),f=o.firstChild,c=f.firstChild,u=c.nextSibling,s=u.firstChild,_=s.firstChild,$=s.nextSibling;u.$$click=d,r(u,()=>El.map(T=>(()=>{var m=It();return m.$$click=p=>{p.preventDefault(),e.onNav(T.to),n()},r(m,()=>T.label),v(p=>{var g=T.to,x=T.to,S=`nav-link ${we(e.path,T.to)?"active":""}`;return g!==p.e&&oe(m,"key",p.e=g),x!==p.t&&oe(m,"href",p.t=x),S!==p.a&&de(m,p.a=S),p},{e:void 0,t:void 0,a:void 0}),m})()),s);var y=i;return typeof y=="function"?Vt(y,s):i=s,_.$$click=()=>l(!t()),r(s,b(X,{get when(){return t()},get children(){var T=Cl();return r(T,()=>Tl.map(m=>(()=>{var p=It();return p.$$click=g=>{g.preventDefault(),e.onNav(m.to),n()},r(p,()=>m.label),v(g=>{var x=m.to,S=m.to,C=`dropdown-item ${we(e.path,m.to)?"active":""}`;return x!==g.e&&oe(p,"key",g.e=x),S!==g.t&&oe(p,"href",g.t=S),C!==g.a&&de(p,g.a=C),g},{e:void 0,t:void 0,a:void 0}),p})())),T}}),null),$.$$click=a,v(()=>de(_,`nav-link dropdown-toggle ${we(e.path,"/resources")||we(e.path,"/devices")||we(e.path,"/drivers")||we(e.path,"/northbound")||we(e.path,"/storage")||we(e.path,"/thresholds")?"active":""}`)),o})()}ne(["click"]);var Al=h("<div class=card><div class=card-body>"),Dl=h("<div class=card-header>"),Nl=h("<h3 class=card-title>"),ql=h("<div class=card-extra>");function se(e){return(()=>{var t=Al(),l=t.firstChild;return r(t,(()=>{var i=V(()=>!!(e.title||e.extra));return()=>i()&&(()=>{var a=Dl();return r(a,(()=>{var n=V(()=>!!e.title);return()=>n()&&(()=>{var d=Nl();return r(d,()=>e.title),d})()})(),null),r(a,(()=>{var n=V(()=>!!e.extra);return()=>n()&&(()=>{var d=ql();return r(d,()=>e.extra),d})()})(),null),a})()})(),l),r(l,()=>e.children),v(i=>vl(t,e.style||"",i)),t})()}ne(["click"]);function ce(){return{show:(e,t)=>{typeof window<"u"&&window.toast&&window.toast.show(e,t)}}}ne(["click"]);var Il=h("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Pl=h("<button class=btn>刷新"),Ol=h("<tr><td></td><td></td><td></td><td>"),jl=h("<tr><td colspan=4 style=text-align:center;padding:16px;color:var(--text-muted)>暂无数据");function Ml(){const e=ce(),[t,l]=w([]),i=()=>{Y("/api/data/points").then(a=>l((a.data||a).slice(0,8))).catch(()=>e.show("error","加载实时数据失败"))};return Z(()=>{i();const a=setInterval(i,4e3);Je(()=>clearInterval(a))}),b(se,{title:"最新采集",get extra(){return(()=>{var a=Pl();return a.$$click=i,a})()},get children(){var a=Il(),n=a.firstChild,d=n.firstChild,o=d.nextSibling;return r(o,b(le,{get each(){return t()},children:f=>(()=>{var c=Ol(),u=c.firstChild,s=u.nextSibling,_=s.nextSibling,$=_.nextSibling;return r(u,()=>{var y;return((y=f.collected_at)==null?void 0:y.slice(5,19))||f.CollectedAt}),r(s,()=>f.device_name||f.DeviceName),r(_,()=>f.field_name||f.FieldName),r($,()=>f.value||f.Value),v(()=>oe(c,"key",f.id||`${f.device_id}-${f.field_name}-${f.collected_at}`)),c})()}),null),r(o,b(le,{get each(){return t().length===0?[1]:[]},children:()=>jl()}),null),a}})}ne(["click"]);var Rl=h("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th><th>阈值</th><th>级别</th><th></th></tr></thead><tbody>"),Wl=h("<button class=btn>刷新"),Fl=h('<button class="btn btn-primary"style="padding:6px 10px">确认'),Ul=h('<span class="text-muted text-xs">已确认'),Bl=h("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td>"),Kl=h("<tr><td colspan=7 style=text-align:center;padding:16px;color:var(--text-muted)>暂无告警");function Jl(){const e=ce(),[t,l]=w([]),i=()=>{Y("/api/alarms").then(n=>l((n.data||n).slice(0,8))).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const a=n=>{re(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return b(se,{title:"最近告警",get extra(){return(()=>{var n=Wl();return n.$$click=i,n})()},get children(){var n=Rl(),d=n.firstChild,o=d.firstChild,f=o.nextSibling;return r(f,b(le,{get each(){return t()},children:c=>(()=>{var u=Bl(),s=u.firstChild,_=s.nextSibling,$=_.nextSibling,y=$.nextSibling,T=y.nextSibling,m=T.nextSibling,p=m.firstChild,g=m.nextSibling;return r(s,()=>{var x;return((x=c.triggered_at)==null?void 0:x.slice(5,19))||c.triggered_at}),r(_,()=>c.device_id),r($,()=>c.field_name),r(y,()=>c.actual_value),r(T,()=>`${c.operator} ${c.threshold_value}`),r(p,()=>c.severity||"warn"),r(g,b(X,{get when(){return c.acknowledged!==1},get children(){var x=Fl();return x.$$click=()=>a(c.id),x}}),null),r(g,b(X,{get when(){return c.acknowledged===1},get children(){return Ul()}}),null),v(()=>de(p,`badge ${c.severity==="critical"?"badge-critical":"badge-running"}`)),u})()}),null),r(f,b(le,{get each(){return t().length===0?[1]:[]},children:()=>Kl()}),null),n}})}ne(["click"]);var Vl=h("<div class=flex style=gap:12px;flex-wrap:wrap><button>");function zl(e){const t=ce(),[l,i]=w(!1),a=()=>{i(!0);const n=e.collectorRunning?"/api/collector/stop":"/api/collector/start";re(n,{}).then(()=>{var d;t.show("success",e.collectorRunning?"已停止采集":"已启动采集"),(d=e.onRefresh)==null||d.call(e)}).catch(()=>t.show("error","操作失败")).finally(()=>i(!1))};return b(se,{title:"快捷操作",get children(){var n=Vl(),d=n.firstChild;return d.$$click=a,r(d,()=>e.collectorRunning?"停止采集器":"启动采集器"),v(o=>{var f=`btn ${e.collectorRunning?"btn-danger":"btn-success"}`,c=l();return f!==o.e&&de(d,o.e=f),c!==o.t&&(d.disabled=o.t=c),o},{e:void 0,t:void 0}),n}})}ne(["click"]);var Hl=h('<div><div class=grid style="grid-template-columns:2fr 1fr;gap:24px"><div class=grid style=grid-template-columns:1fr;gap:24px></div><div class=grid style=grid-template-columns:1fr;gap:24px>');function Pt(){const[e,t]=w(null),[l,i]=w(!0),a=()=>{Y("/api/status").then(n=>t(n.data||n)).catch(()=>{}).finally(()=>i(!1))};return Z(()=>{a();const n=setInterval(a,5e3);Je(()=>clearInterval(n))}),(()=>{var n=Hl(),d=n.firstChild,o=d.firstChild,f=o.nextSibling;return r(n,b(se,{get data(){return e()},get loading(){return l()}}),d),r(o,b(Ml,{}),null),r(o,b(Jl,{}),null),r(f,b(zl,{get collectorRunning(){var c;return(c=e())==null?void 0:c.collector_running},onRefresh:a})),n})()}var Ql=h('<div class=container style=max-width:420px;margin-top:48px><div class=card><div class=card-header><h3 class=card-title>登录</h3></div><form class=form><div class=form-group><label class=form-label>用户名</label><input class=form-input required></div><div class=form-group><label class=form-label>密码</label><input class=form-input type=password required></div><button class="btn btn-primary"type=submit style=width:100%;margin-top:8px>'),Gl=h('<div style="color:var(--accent-red);padding:8px 0">');function Xl(e){const[t,l]=w("admin"),[i,a]=w("123456"),[n,d]=w(""),[o,f]=w(!1),c=u=>{u.preventDefault(),f(!0),d(""),re("/login",{username:t(),password:i()}).then(s=>{wl(s.token),window.location.replace("/")}).catch(()=>d("用户名或密码错误")).finally(()=>f(!1))};return(()=>{var u=Ql(),s=u.firstChild,_=s.firstChild,$=_.nextSibling,y=$.firstChild,T=y.firstChild,m=T.nextSibling,p=y.nextSibling,g=p.firstChild,x=g.nextSibling,S=p.nextSibling;return $.addEventListener("submit",c),m.$$input=C=>l(C.target.value),x.$$input=C=>a(C.target.value),r($,(()=>{var C=V(()=>!!n());return()=>C()&&(()=>{var k=Gl();return r(k,n),k})()})(),S),r(S,()=>o()?"登录中...":"登录"),v(()=>S.disabled=o()),v(()=>m.value=t()),v(()=>x.value=i()),u})()}ne(["input"]);var Yl=h("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无资源"),Zl=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>路径</th><th>状态</th><th>操作</th></tr></thead><tbody>"),en=h('<div style="color:var(--accent-red);padding:4px 0">'),tn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title></h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=serial>串口</option><option value=di>DI</option><option value=do>DO</option></select></div><div class=form-group><label class=form-label>路径</label><input class=form-input placeholder="如 /dev/ttyUSB0 或 eth0"required></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),ln=h("<div>"),nn=h('<button class="btn btn-primary">新增资源'),rn=h('<tr><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const Ze={name:"",type:"serial",path:"",enabled:1};function sn(){const e=ce(),[t,l]=w([]),[i,a]=w(Ze),[n,d]=w(null),[o,f]=w(!1),[c,u]=w(!1),[s,_]=w(""),$=()=>{Y("/api/resources").then(p=>l(p.data||p)).catch(()=>e.show("error","加载资源失败"))};Z(()=>{$()}),Z(()=>{if(!o())return;const p=g=>{g.key==="Escape"&&f(!1)};window.addEventListener("keydown",p),Je(()=>window.removeEventListener("keydown",p))});const y=p=>{p.preventDefault(),u(!0),_(""),(n()?ot(`/api/resources/${n()}`,i()):re("/api/resources",i())).then(()=>{e.show("success",n()?"资源已更新":"资源已创建"),a(Ze),d(null),f(!1),$()}).catch(x=>{_(x.message||"保存失败"),e.show("error","保存失败")}).finally(()=>u(!1))},T=p=>{confirm("删除该资源？")&&confirm("删除后关联设备可能需要重新绑定资源，确认继续？")&&Ie(`/api/resources/${p}`).then(()=>{e.show("success","已删除"),$()}).catch(()=>e.show("error","删除失败"))},m=p=>{re(`/api/resources/${p.id}/toggle`,{}).then($).catch(()=>e.show("error","切换失败"))};return(()=>{var p=ln();return r(p,b(se,{title:"资源列表",get extra(){return(()=>{var g=nn();return g.$$click=()=>{a(Ze),d(null),_(""),f(!0)},g})()},get children(){var g=Zl(),x=g.firstChild,S=x.firstChild,C=S.nextSibling;return r(C,b(le,{get each(){return t()},children:k=>(()=>{var O=rn(),N=O.firstChild,M=N.nextSibling,j=M.nextSibling,R=j.nextSibling,F=R.nextSibling,U=F.firstChild,W=F.nextSibling,B=W.firstChild,K=B.nextSibling,ee=K.nextSibling;return r(N,()=>k.id),r(M,()=>k.name),r(j,()=>k.type),r(R,()=>k.path),r(U,()=>k.enabled===1?"启用":"禁用"),B.$$click=()=>{d(k.id),a({name:k.name,type:k.type,path:k.path,enabled:k.enabled}),_(""),f(!0)},K.$$click=()=>m(k),r(K,()=>k.enabled===1?"禁用":"启用"),ee.$$click=()=>T(k.id),v(()=>de(U,`badge ${k.enabled===1?"badge-running":"badge-stopped"}`)),O})()}),null),r(C,b(X,{get when(){return t().length===0},get children(){return Yl()}}),null),g}}),null),r(p,b(X,{get when(){return o()},get children(){var g=tn(),x=g.firstChild,S=x.firstChild,C=S.firstChild,k=S.nextSibling,O=k.firstChild,N=O.firstChild,M=N.nextSibling,j=O.nextSibling,R=j.firstChild,F=R.nextSibling,U=j.nextSibling,W=U.firstChild,B=W.nextSibling,K=U.nextSibling,ee=K.firstChild,J=ee.nextSibling;return g.$$click=P=>{P.target===P.currentTarget&&f(!1)},r(C,()=>n()?"编辑资源":"新增资源"),k.addEventListener("submit",y),M.$$input=P=>a({...i(),name:P.target.value}),F.addEventListener("change",P=>a({...i(),type:P.target.value})),B.$$input=P=>a({...i(),path:P.target.value}),r(k,b(X,{get when(){return s()},get children(){var P=en();return r(P,s),P}}),K),ee.$$click=()=>{f(!1),d(null),a(Ze)},r(J,(()=>{var P=V(()=>!!c());return()=>P()?"保存中...":n()?"保存":"创建"})()),v(P=>{var ue=c(),pe=c();return ue!==P.e&&(ee.disabled=P.e=ue),pe!==P.t&&(J.disabled=P.t=pe),P},{e:void 0,t:void 0}),v(()=>M.value=i().name),v(()=>F.value=i().type),v(()=>B.value=i().path),g}}),null),p})()}ne(["click","input"]);var an=h('<div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>串口</label><input class=form-input required></div><div class=form-group><label class=form-label>波特率</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>校验位</label><select class=form-select><option value=N>None</option><option value=E>Even</option><option value=O>Odd</option></select></div><div class=form-group><label class=form-label>数据位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>停止位</label><input class=form-input type=number required>'),on=h('<div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>IP 地址</label><input class=form-input required></div><div class=form-group><label class=form-label>端口</label><input class=form-input type=number required>'),dn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:640px;max-width:100%><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:0 4px"><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>描述</label><input class=form-input></div></div><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>ProductKey</label><input class=form-input></div><div class=form-group><label class=form-label>DeviceKey</label><input class=form-input></div></div><div class=form-group><label class=form-label>驱动类型</label><select class=form-select><option value=modbus_rtu>Modbus RTU (串口)</option><option value=modbus_tcp>Modbus TCP</option></select></div><div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>设备地址</label><input class=form-input required></div><div class=form-group><label class=form-label>采集周期 (ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>超时 (ms)</label><input class=form-input type=number></div></div><div class=form-group><label class=form-label>绑定资源</label><select class=form-select><option value>不绑定</option></select><div class="text-muted text-xs"style=margin-top:4px>同一资源串行访问，建议按驱动类型匹配。</div></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:16px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),cn=h("<div style=color:var(--text-muted);font-size:12px;margin-top:4px>驱动未提供可写元数据"),un=h('<div style="color:var(--accent-red);padding:4px 0">'),fn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title>写寄存器</h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>字段</label><select class=form-select required><option value>选择字段</option></select></div><div class=form-group><label class=form-label>值</label><input class=form-input required></div><div class=flex style=gap:8px;justify-content:flex-end;margin-top:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">写入'),hn=h("<div>"),pn=h('<div class="flex gap-3"><input class=form-input placeholder=搜索设备/地址/驱动 style=max-width:240px><button class=btn>刷新</button><button class="btn btn-primary">新增设备'),gn=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),$n=h('<div style="color:var(--accent-red);padding:16px 0">'),vn=h("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无设备"),bn=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>产品/设备Key</th><th>驱动类型</th><th>驱动</th><th>资源</th><th>周期(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),_n=h('<tr><td></td><td></td><td style=min-width:140px><div class=text-sm></div><div class="text-muted text-xs"></div></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn>写</button><button></button><button class="btn btn-danger">删除'),mn=h('<div><div></div><div class="text-muted text-xs">'),xn=h("<span class=text-muted>未绑定"),Ot=h("<option>");const Fe={name:"",description:"",product_key:"",device_key:"",driver_type:"modbus_rtu",serial_port:"/dev/ttyS0",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",ip_address:"",port_num:502,device_address:"1",collect_interval:1e3,timeout:1e3,resource_id:null,enabled:1};function yn(){const e=ce(),[t,l]=w([]),[i,a]=w([]),[n,d]=w(!0),[o,f]=w(""),[c,u]=w(""),[s,_]=w(Fe),[$,y]=w(null),[T,m]=w(!1),[p,g]=w(!1),[x,S]=w(!1),[C,k]=w([]),[O,N]=w({field:"",value:""}),[M,j]=w(""),[R,F]=w(null);let U;const W=()=>{d(!0),Promise.all([Y("/api/devices"),Y("/api/resources")]).then(([E,L])=>{l(E.data||E),a(L.data||L),f("")}).catch(()=>f("加载设备或资源失败")).finally(()=>d(!1))};Z(()=>{W()}),Z(()=>{if(!T())return;const E=L=>{L.key==="Escape"&&m(!1)};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)});const B=()=>{const E=c().trim().toLowerCase();return E?t().filter(L=>[L.name,L.device_address,L.driver_type,L.driver_name].filter(Boolean).some(q=>q.toLowerCase().includes(E))):t()},K=E=>{E.preventDefault(),g(!0),($()?ot(`/api/devices/${$()}`,s()):re("/api/devices",s())).then(()=>{e.show("success",$()?"设备已更新":"设备已创建"),_(Fe),y(null),m(!1),W()}).catch(()=>e.show("error","操作失败")).finally(()=>g(!1))},ee=E=>{re(`/api/devices/${E}/toggle`,{}).then(W).catch(()=>e.show("error","切换失败"))},J=E=>{confirm("确定删除该设备？")&&confirm("删除后将无法恢复，继续吗？")&&Ie(`/api/devices/${E}`).then(()=>{e.show("success","已删除"),W()}).catch(()=>e.show("error","删除失败"))},P=E=>{j(""),k([]),N({field:"",value:""}),F(E.id),S(!0),Y(`/api/devices/${E.id}/writables`).then(L=>{const q=(L==null?void 0:L.data)||L||[];k(q),q.length&&N({field:q[0].field||"",value:""})}).catch(()=>j("加载可写寄存器失败"))},ue=E=>{E.preventDefault(),j("");const L=O().field,q=O().value;if(!L){j("请选择字段");return}re(`/api/devices/${R()}/execute`,{function:"handle",params:{func_name:"write",field:L,value:q}}).then(()=>{e.show("success","写入成功"),S(!1)}).catch(G=>j(G.message||"写入失败"))},pe=()=>{_(Fe),y(null),m(!0)},Ce=E=>{y(E.id),_({name:E.name,description:E.description||"",product_key:E.product_key||"",device_key:E.device_key||"",driver_type:E.driver_type,serial_port:E.serial_port||"/dev/ttyS0",baud_rate:E.baud_rate||9600,data_bits:E.data_bits||8,stop_bits:E.stop_bits||1,parity:E.parity||"N",ip_address:E.ip_address||"",port_num:E.port_num||502,device_address:E.device_address||"1",collect_interval:E.collect_interval||1e3,timeout:E.timeout||1e3,resource_id:E.resource_id,enabled:E.enabled}),m(!0)},Pe=()=>i().length?s().driver_type==="modbus_rtu"?i().filter(E=>E.type==="serial"):s().driver_type==="modbus_tcp"?i().filter(E=>E.type==="net"):i():[];return(()=>{var E=hn();return r(E,b(se,{title:"设备列表",get extra(){return(()=>{var L=pn(),q=L.firstChild,G=q.nextSibling,A=G.nextSibling;return q.$$input=I=>u(I.target.value),G.$$click=W,A.$$click=pe,v(()=>q.value=c()),L})()},get children(){return V(()=>!!n())()?gn():V(()=>!!o())()?(()=>{var L=$n();return r(L,o),L})():(()=>{var L=bn(),q=L.firstChild,G=q.firstChild,A=G.nextSibling;return r(A,b(le,{get each(){return B()},children:I=>(()=>{var ie=_n(),ge=ie.firstChild,ke=ge.nextSibling,$e=ke.nextSibling,_e=$e.firstChild,Oe=_e.nextSibling,Ee=$e.nextSibling,me=Ee.nextSibling,Te=me.nextSibling,z=Te.nextSibling,xe=z.nextSibling,je=xe.firstChild,dt=xe.nextSibling,Ge=dt.firstChild,Me=Ge.nextSibling,Le=Me.nextSibling,ct=Le.nextSibling;return r(ge,()=>I.id),r(ke,()=>I.name),r(_e,()=>I.product_key||"-"),r(Oe,()=>I.device_key||""),r(Ee,()=>I.driver_type),r(me,()=>I.driver_name||(I.driver_id?`驱动 #${I.driver_id}`:"-")),r(Te,(()=>{var fe=V(()=>!!I.resource_name);return()=>fe()?(()=>{var he=mn(),ye=he.firstChild,ut=ye.nextSibling;return r(ye,()=>I.resource_name),r(ut,()=>I.resource_path),he})():xn()})()),r(z,()=>I.collect_interval),r(je,()=>I.enabled===1?"采集中":"停止"),Ge.$$click=()=>Ce(I),Me.$$click=()=>P(I),Le.$$click=()=>ee(I.id),r(Le,()=>I.enabled===1?"停止":"启动"),ct.$$click=()=>J(I.id),v(fe=>{var he=`badge ${I.enabled===1?"badge-running":"badge-stopped"}`,ye=`btn ${I.enabled===1?"btn-danger":"btn-success"}`;return he!==fe.e&&de(je,fe.e=he),ye!==fe.t&&de(Le,fe.t=ye),fe},{e:void 0,t:void 0}),ie})()}),null),r(A,b(X,{get when(){return B().length===0},get children(){return vn()}}),null),L})()}}),null),r(E,b(X,{get when(){return T()},get children(){var L=dn(),q=L.firstChild,G=q.firstChild,A=G.firstChild,I=A.nextSibling,ie=G.nextSibling,ge=ie.firstChild,ke=ge.firstChild,$e=ke.firstChild,_e=$e.nextSibling,Oe=ke.nextSibling,Ee=Oe.firstChild,me=Ee.nextSibling,Te=ge.nextSibling,z=Te.firstChild,xe=z.firstChild,je=xe.nextSibling,dt=z.nextSibling,Ge=dt.firstChild,Me=Ge.nextSibling,Le=Te.nextSibling,ct=Le.firstChild,fe=ct.nextSibling,he=Le.nextSibling,ye=he.firstChild,ut=ye.firstChild,mt=ut.nextSibling,xt=ye.nextSibling,Xt=xt.firstChild,yt=Xt.nextSibling,Yt=xt.nextSibling,Zt=Yt.firstChild,wt=Zt.nextSibling,St=he.nextSibling,el=St.firstChild,Xe=el.nextSibling;Xe.firstChild;var tl=St.nextSibling,ft=tl.firstChild,Ct=ft.nextSibling;L.$$click=D=>{D.target===D.currentTarget&&m(!1)};var kt=U;return typeof kt=="function"?Vt(kt,L):U=L,r(A,()=>$()?"编辑设备":"新增设备"),I.$$click=()=>{m(!1),y(null),_(Fe)},ie.addEventListener("submit",K),_e.$$input=D=>_({...s(),name:D.target.value}),me.$$input=D=>_({...s(),description:D.target.value}),je.$$input=D=>_({...s(),product_key:D.target.value}),Me.$$input=D=>_({...s(),device_key:D.target.value}),fe.addEventListener("change",D=>_({...s(),driver_type:D.target.value,resource_id:null})),r(ie,b(X,{get when(){return s().driver_type==="modbus_rtu"},get children(){var D=an(),ae=D.firstChild,De=ae.firstChild,Re=De.nextSibling,Ye=ae.nextSibling,ht=Ye.firstChild,We=ht.nextSibling,Ne=Ye.nextSibling,ll=Ne.firstChild,Et=ll.nextSibling,Tt=Ne.nextSibling,nl=Tt.firstChild,Lt=nl.nextSibling,il=Tt.nextSibling,rl=il.firstChild,At=rl.nextSibling;return Re.$$input=ve=>_({...s(),serial_port:ve.target.value}),We.$$input=ve=>_({...s(),baud_rate:+ve.target.value}),Et.addEventListener("change",ve=>_({...s(),parity:ve.target.value})),Lt.$$input=ve=>_({...s(),data_bits:+ve.target.value}),At.$$input=ve=>_({...s(),stop_bits:+ve.target.value}),v(()=>Re.value=s().serial_port),v(()=>We.value=s().baud_rate),v(()=>Et.value=s().parity),v(()=>Lt.value=s().data_bits),v(()=>At.value=s().stop_bits),D}}),he),r(ie,b(X,{get when(){return s().driver_type==="modbus_tcp"},get children(){var D=on(),ae=D.firstChild,De=ae.firstChild,Re=De.nextSibling,Ye=ae.nextSibling,ht=Ye.firstChild,We=ht.nextSibling;return Re.$$input=Ne=>_({...s(),ip_address:Ne.target.value}),We.$$input=Ne=>_({...s(),port_num:+Ne.target.value}),v(()=>Re.value=s().ip_address),v(()=>We.value=s().port_num),D}}),he),mt.$$input=D=>_({...s(),device_address:D.target.value}),yt.$$input=D=>_({...s(),collect_interval:+D.target.value}),wt.$$input=D=>_({...s(),timeout:+D.target.value}),Xe.addEventListener("change",D=>_({...s(),resource_id:D.target.value?Number(D.target.value):null})),r(Xe,()=>Pe().map(D=>(()=>{var ae=Ot();return r(ae,()=>`${D.name} (${D.path})`),v(()=>oe(ae,"key",D.id)),v(()=>ae.value=D.id),ae})()),null),ft.$$click=()=>{m(!1),y(null),_(Fe)},r(Ct,(()=>{var D=V(()=>!!p());return()=>D()?"保存中...":$()?"保存":"创建"})()),v(D=>{var ae=p(),De=p();return ae!==D.e&&(ft.disabled=D.e=ae),De!==D.t&&(Ct.disabled=D.t=De),D},{e:void 0,t:void 0}),v(()=>_e.value=s().name),v(()=>me.value=s().description),v(()=>je.value=s().product_key),v(()=>Me.value=s().device_key),v(()=>fe.value=s().driver_type),v(()=>mt.value=s().device_address),v(()=>yt.value=s().collect_interval),v(()=>wt.value=s().timeout),v(()=>Xe.value=s().resource_id??""),L}}),null),r(E,b(X,{get when(){return x()},get children(){var L=fn(),q=L.firstChild,G=q.firstChild,A=G.firstChild,I=A.nextSibling,ie=G.nextSibling,ge=ie.firstChild,ke=ge.firstChild,$e=ke.nextSibling;$e.firstChild;var _e=ge.nextSibling,Oe=_e.firstChild,Ee=Oe.nextSibling,me=_e.nextSibling,Te=me.firstChild;return L.$$click=z=>{z.target===z.currentTarget&&S(!1)},I.$$click=()=>S(!1),ie.addEventListener("submit",ue),$e.addEventListener("change",z=>N({...O(),field:z.target.value})),r($e,b(le,{get each(){return C()},children:z=>(()=>{var xe=Ot();return r(xe,()=>z.label||z.field||z.name),v(()=>xe.value=z.field||z.name),xe})()}),null),r(ge,b(X,{get when(){return C().length===0},get children(){return cn()}}),null),Ee.$$input=z=>N({...O(),value:z.target.value}),r(ie,b(X,{get when(){return M()},get children(){var z=un();return r(z,M),z}}),me),Te.$$click=()=>S(!1),v(()=>$e.value=O().field),v(()=>Ee.value=O().value),L}}),null),E})()}ne(["click","input"]);function wn(){return b(yn,{})}var Sn=h('<label class="btn btn-primary"style=cursor:pointer>上传驱动<input type=file accept=.wasm style=display:none>'),Cn=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),kn=h('<div style="color:var(--accent-red);padding:16px 0">'),En=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>文件</th><th>大小</th><th>操作</th></tr></thead><tbody>"),Tn=h('<tr><td></td><td></td><td></td><td></td><td class=flex style=gap:8px><a class=btn>下载</a><button class="btn btn-danger">删除'),Ln=h("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无驱动");function An(){const e=ce(),[t,l]=w([]),[i,a]=w(!0),[n,d]=w(""),o=()=>{a(!0),Y("/api/drivers").then(u=>{l(u.data||u),d("")}).catch(()=>d("加载驱动失败")).finally(()=>a(!1))};Z(()=>{o()});const f=(u,s)=>{confirm(`删除驱动 ${s} ？`)&&Ie(`/api/drivers/${u}`).then(()=>{e.show("success","已删除"),o()}).catch(()=>e.show("error","删除失败"))},c=u=>{var $;const s=($=u.target.files)==null?void 0:$[0];if(!s)return;const _=new FormData;_.append("file",s),Sl("/api/drivers/upload",_).then(()=>{e.show("success","上传成功"),o()}).catch(()=>e.show("error","上传失败")).finally(()=>{u.target.value=""})};return b(se,{title:"驱动管理",get extra(){return(()=>{var u=Sn(),s=u.firstChild,_=s.nextSibling;return _.addEventListener("change",c),u})()},get children(){return V(()=>!!i())()?Cn():V(()=>!!n())()?(()=>{var u=kn();return r(u,n),u})():(()=>{var u=En(),s=u.firstChild,_=s.firstChild,$=_.nextSibling;return r($,b(le,{get each(){return t()},children:y=>(()=>{var T=Tn(),m=T.firstChild,p=m.nextSibling,g=p.nextSibling,x=g.nextSibling,S=x.nextSibling,C=S.firstChild,k=C.nextSibling;return r(m,()=>y.id),r(p,()=>y.name),r(g,()=>y.filename||y.file_path||""),r(x,(()=>{var O=V(()=>!!y.size);return()=>O()?(y.size/1024).toFixed(1)+" KB":"-"})()),k.$$click=()=>f(y.id,y.name),v(()=>oe(C,"href",`/api/drivers/${y.id}/download`)),T})()}),null),r($,b(le,{get each(){return t().length===0?[1]:[]},children:()=>Ln()}),null),u})()}})}ne(["click"]);function Dn(){return b(An,{})}var Nn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:480px;max-width:90vw><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input placeholder=配置名称 required></div><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=http>HTTP</option><option value=mqtt>MQTT</option><option value=xunji>寻迹</option></select></div><div class=form-group><label class=form-label>上传间隔 (ms)</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>配置 (JSON)</label><textarea class=form-input rows=5 placeholder="{ &quot;url&quot;: &quot;http://...&quot;, &quot;method&quot;: &quot;POST&quot; }"style=font-family:monospace;font-size:13px></textarea></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),qn=h("<div>"),In=h('<button class="btn btn-primary">新增配置'),Pn=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),On=h("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置"),jn=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>上传间隔(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Mn=h('<tr><td></td><td></td><td><span class="badge badge-info"></span></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const Ue={name:"",type:"http",upload_interval:5e3,config:"{}",enabled:1};function Rn(){const e=ce(),[t,l]=w([]),[i,a]=w(!0),[n,d]=w(Ue),[o,f]=w(null),[c,u]=w(!1),[s,_]=w(!1),$=()=>{a(!0),Y("/api/northbound").then(x=>l(x.data||x)).catch(()=>e.show("error","加载北向配置失败")).finally(()=>a(!1))};Z(()=>{$()});const y=x=>{x.preventDefault(),_(!0),(o()?ot(`/api/northbound/${o()}`,n()):re("/api/northbound",n())).then(()=>{e.show("success",o()?"已更新":"已创建"),d(Ue),f(null),u(!1),$()}).catch(()=>e.show("error","操作失败")).finally(()=>_(!1))},T=(x,S)=>{re(`/api/northbound/${x}/toggle`,{}).then($).catch(()=>e.show("error","切换失败"))},m=x=>{confirm("删除该配置？")&&Ie(`/api/northbound/${x}`).then(()=>{e.show("success","已删除"),$()}).catch(()=>e.show("error","删除失败"))},p=()=>{d(Ue),f(null),u(!0)},g=x=>{f(x.id),d({name:x.name,type:x.type,upload_interval:x.upload_interval,config:x.config,enabled:x.enabled}),u(!0)};return(()=>{var x=qn();return r(x,b(se,{title:"北向配置列表",get extra(){return(()=>{var S=In();return S.$$click=p,S})()},get children(){return V(()=>!!i())()?Pn():(()=>{var S=jn(),C=S.firstChild,k=C.firstChild,O=k.nextSibling;return r(O,b(le,{get each(){return t()},children:N=>(()=>{var M=Mn(),j=M.firstChild,R=j.nextSibling,F=R.nextSibling,U=F.firstChild,W=F.nextSibling,B=W.nextSibling,K=B.firstChild,ee=B.nextSibling,J=ee.firstChild,P=J.nextSibling,ue=P.nextSibling;return r(j,()=>N.id),r(R,()=>N.name),r(U,()=>N.type.toUpperCase()),r(W,()=>N.upload_interval),r(K,()=>N.enabled===1?"启用":"禁用"),J.$$click=()=>g(N),P.$$click=()=>T(N.id,N.enabled===1),r(P,()=>N.enabled===1?"禁用":"启用"),ue.$$click=()=>m(N.id),v(()=>de(K,`badge ${N.enabled===1?"badge-running":"badge-stopped"}`)),M})()}),null),r(O,b(X,{get when(){return t().length===0},get children(){return On()}}),null),S})()}}),null),r(x,b(X,{get when(){return c()},get children(){var S=Nn(),C=S.firstChild,k=C.firstChild,O=k.firstChild,N=O.nextSibling,M=k.nextSibling,j=M.firstChild,R=j.firstChild,F=R.nextSibling,U=j.nextSibling,W=U.firstChild,B=W.firstChild,K=B.nextSibling,ee=W.nextSibling,J=ee.firstChild,P=J.nextSibling,ue=U.nextSibling,pe=ue.firstChild,Ce=pe.nextSibling,Pe=ue.nextSibling,E=Pe.firstChild,L=E.nextSibling;return r(O,()=>o()?"编辑北向配置":"新增北向配置"),N.$$click=()=>{u(!1),f(null),d(Ue)},M.addEventListener("submit",y),F.$$input=q=>d({...n(),name:q.target.value}),K.addEventListener("change",q=>d({...n(),type:q.target.value})),P.$$input=q=>d({...n(),upload_interval:+q.target.value}),Ce.$$input=q=>d({...n(),config:q.target.value}),E.$$click=()=>{u(!1),f(null),d(Ue)},r(L,(()=>{var q=V(()=>!!s());return()=>q()?"保存中...":o()?"保存":"创建"})()),v(q=>{var G=s(),A=s();return G!==q.e&&(E.disabled=q.e=G),A!==q.t&&(L.disabled=q.t=A),q},{e:void 0,t:void 0}),v(()=>F.value=n().name),v(()=>K.value=n().type),v(()=>P.value=n().upload_interval),v(()=>Ce.value=n().config),S}}),null),x})()}ne(["click","input"]);function Wn(){return b(Rn,{})}var Fn=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>设备</th><th>字段</th><th>条件</th><th>严重性</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Un=h('<div style="color:var(--accent-red);padding:4px 0">'),Bn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:440px;max-width:92vw><div class=card-header><h3 class=card-title>新增阈值</h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>设备</label><select class=form-select required><option value>选择设备</option></select></div><div class=form-group><label class=form-label>字段名</label><input class=form-input required></div><div class=grid style="gridTemplateColumns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>运算符</label><select class=form-select><option value=">">大于 &gt;</option><option value=">=">大于等于 &gt;=</option><option value="<">小于 &lt;</option><option value="<=">小于等于 &lt;=</option><option value="==">等于 ==</option></select></div><div class=form-group><label class=form-label>阈值</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>严重程度</label><select class=form-select><option value=info>info</option><option value=warning>warning</option><option value=error>error</option><option value=critical>critical</option></select></div><div class=form-group><label class=form-label>报警消息</label><input class=form-input></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),Kn=h("<div>"),Jn=h('<button class="btn btn-primary">新增阈值'),Vn=h('<tr><td></td><td></td><td></td><td> </td><td></td><td><span></span></td><td><button class="btn btn-danger">删除'),zn=h("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无阈值"),Hn=h("<option>");const et={device_id:"",field_name:"",operator:">",value:0,severity:"warning",message:"",enabled:1};function Qn(){const e=ce(),[t,l]=w([]),[i,a]=w([]),[n,d]=w(et),[o,f]=w(!1),[c,u]=w(!1),[s,_]=w(""),$=()=>{Y("/api/thresholds").then(p=>l(p.data||p)).catch(()=>e.show("error","加载阈值失败"))},y=()=>{Y("/api/devices").then(p=>a(p.data||p)).catch(()=>{})};Z(()=>{$(),y()}),Z(()=>{if(!o())return;const p=g=>{g.key==="Escape"&&f(!1)};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)});const T=p=>{p.preventDefault(),u(!0),_(""),re("/api/thresholds",n()).then(()=>{e.show("success","阈值已创建"),d(et),f(!1),$()}).catch(g=>{_(g.message||"创建失败"),e.show("error","创建失败")}).finally(()=>u(!1))},m=p=>{confirm("删除该阈值？")&&Ie(`/api/thresholds/${p}`).then(()=>{e.show("success","已删除"),$()}).catch(()=>e.show("error","删除失败"))};return(()=>{var p=Kn();return r(p,b(se,{title:"阈值配置列表",get extra(){return(()=>{var g=Jn();return g.$$click=()=>{d(et),_(""),f(!0)},g})()},get children(){var g=Fn(),x=g.firstChild,S=x.firstChild,C=S.nextSibling;return r(C,b(le,{get each(){return t()},children:k=>(()=>{var O=Vn(),N=O.firstChild,M=N.nextSibling,j=M.nextSibling,R=j.nextSibling,F=R.firstChild,U=R.nextSibling,W=U.nextSibling,B=W.firstChild,K=W.nextSibling,ee=K.firstChild;return r(N,()=>k.id),r(M,()=>k.device_id),r(j,()=>k.field_name),r(R,()=>k.operator,F),r(R,()=>k.value,null),r(U,()=>k.severity),r(B,()=>k.enabled===1?"启用":"禁用"),ee.$$click=()=>m(k.id),v(()=>de(B,`badge ${k.enabled===1?"badge-running":"badge-stopped"}`)),O})()}),null),r(C,b(le,{get each(){return t().length===0?[1]:[]},children:()=>zn()}),null),g}}),null),r(p,b(X,{get when(){return o()},get children(){var g=Bn(),x=g.firstChild,S=x.firstChild,C=S.nextSibling,k=C.firstChild,O=k.firstChild,N=O.nextSibling;N.firstChild;var M=k.nextSibling,j=M.firstChild,R=j.nextSibling,F=M.nextSibling,U=F.firstChild,W=U.firstChild,B=W.nextSibling,K=U.nextSibling,ee=K.firstChild,J=ee.nextSibling,P=F.nextSibling,ue=P.firstChild,pe=ue.nextSibling,Ce=P.nextSibling,Pe=Ce.firstChild,E=Pe.nextSibling,L=Ce.nextSibling,q=L.firstChild,G=q.nextSibling;return g.$$click=A=>{A.target===A.currentTarget&&f(!1)},C.addEventListener("submit",T),N.addEventListener("change",A=>d({...n(),device_id:+A.target.value})),r(N,()=>i().map(A=>(()=>{var I=Hn();return r(I,()=>A.name||A.id),v(()=>oe(I,"key",A.id)),v(()=>I.value=A.id),I})()),null),R.$$input=A=>d({...n(),field_name:A.target.value}),B.addEventListener("change",A=>d({...n(),operator:A.target.value})),J.$$input=A=>d({...n(),value:+A.target.value}),pe.addEventListener("change",A=>d({...n(),severity:A.target.value})),E.$$input=A=>d({...n(),message:A.target.value}),r(C,b(X,{get when(){return s()},get children(){var A=Un();return r(A,s),A}}),L),q.$$click=()=>{f(!1),d(et)},r(G,()=>c()?"创建中...":"创建"),v(A=>{var I=c(),ie=c();return I!==A.e&&(q.disabled=A.e=I),ie!==A.t&&(G.disabled=A.t=ie),A},{e:void 0,t:void 0}),v(()=>N.value=n().device_id),v(()=>R.value=n().field_name),v(()=>B.value=n().operator),v(()=>J.value=n().value),v(()=>pe.value=n().severity),v(()=>E.value=n().message),g}}),null),p})()}ne(["click","input"]);function Gn(){return b(Qn,{})}var Xn=h("<div class=table-container style=max-height:600px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备ID</th><th>字段</th><th>实际值</th><th>阈值条件</th><th>级别</th><th>消息</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Yn=h("<button class=btn>刷新"),Zn=h("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td></td><td></td><td>"),ei=h('<span class="text-muted text-xs">已确认'),ti=h("<span class=text-warning>未确认"),li=h('<button class="btn btn-primary btn-sm">确认'),ni=h("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无告警");function ii(){const e=ce(),[t,l]=w([]),i=()=>{Y("/api/alarms").then(n=>l(n.data||n)).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const a=n=>{re(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return b(se,{title:"报警日志",get extra(){return(()=>{var n=Yn();return n.$$click=i,n})()},get children(){var n=Xn(),d=n.firstChild,o=d.firstChild,f=o.nextSibling;return r(f,b(le,{get each(){return t()},children:c=>(()=>{var u=Zn(),s=u.firstChild,_=s.nextSibling,$=_.nextSibling,y=$.nextSibling,T=y.nextSibling,m=T.nextSibling,p=m.firstChild,g=m.nextSibling,x=g.nextSibling,S=x.nextSibling;return r(s,()=>{var C;return((C=c.triggered_at)==null?void 0:C.slice(5,19))||c.triggered_at}),r(_,()=>c.device_id),r($,()=>c.field_name),r(y,()=>c.actual_value),r(T,()=>`${c.operator} ${c.threshold_value}`),r(p,()=>c.severity||"warn"),r(g,()=>c.message||"-"),r(x,(()=>{var C=V(()=>c.acknowledged===1);return()=>C()?ei():ti()})()),r(S,(()=>{var C=V(()=>c.acknowledged!==1);return()=>C()&&(()=>{var k=li();return k.$$click=()=>a(c.id),k})()})()),v(()=>de(p,`badge ${c.severity==="critical"?"badge-critical":"badge-running"}`)),u})()}),null),r(f,b(le,{get each(){return t().length===0?[1]:[]},children:()=>ni()}),null),n}})}ne(["click"]);var ri=h("<select class=form-select>"),si=h("<option>"),ai=h("<div style=padding:24px>加载中..."),oi=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),di=h("<tr><td></td><td></td><td></td><td>"),ci=h("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无数据");function ui(){const e=ce(),[t,l]=w([]),[i,a]=w(""),[n,d]=w([]),[o,f]=w(!1);return Z(()=>{Y("/api/devices").then(c=>{const u=c.data||c;l(u),u.length&&a(String(u[0].id))}).catch(()=>e.show("error","加载设备失败"))}),Z(()=>{i()&&(f(!0),Y(`/api/data/points/${i()}`).then(c=>d(c.data||c)).catch(()=>e.show("error","加载实时数据失败")).finally(()=>f(!1)))}),b(se,{title:"实时数据",get extra(){return(()=>{var c=ri();return c.addEventListener("change",u=>a(u.target.value)),r(c,()=>t().map(u=>(()=>{var s=si();return r(s,()=>u.name||u.id),v(()=>oe(s,"key",u.id)),v(()=>s.value=u.id),s})())),v(()=>c.value=i()),c})()},get children(){return V(()=>!!o())()?ai():(()=>{var c=oi(),u=c.firstChild,s=u.firstChild,_=s.nextSibling;return r(_,()=>n().map($=>(()=>{var y=di(),T=y.firstChild,m=T.nextSibling,p=m.nextSibling,g=p.nextSibling;return r(T,()=>$.collected_at||$.CollectedAt||""),r(m,()=>$.device_name||""),r(p,()=>$.field_name||""),r(g,()=>$.value),v(()=>oe(y,"key",$.id||`${$.device_id}-${$.collected_at}-${$.field_name}`)),y})()),null),r(_,(()=>{var $=V(()=>n().length===0);return()=>$()&&ci()})(),null),c})()}})}var fi=h('<div class="flex gap-3"><select class=form-select><option value>全部设备</option></select><button class=btn>刷新'),hi=h("<option>"),pi=h("<div style=padding:24px>加载中..."),gi=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),$i=h("<tr><td></td><td></td><td></td><td>"),vi=h("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无历史数据");function bi(){const e=ce(),[t,l]=w(""),[i,a]=w([]),[n,d]=w(!1),[o,f]=w([]);Z(()=>{Y("/api/devices").then(u=>f(u.data||u)).catch(()=>{})});const c=()=>{d(!0);const u=t()?`/api/data/history?device_id=${t()}`:"/api/data/history";Y(u).then(s=>a(s.data||s)).catch(()=>e.show("error","加载历史数据失败")).finally(()=>d(!1))};return Z(()=>{c()}),b(se,{title:"历史数据",get extra(){return(()=>{var u=fi(),s=u.firstChild;s.firstChild;var _=s.nextSibling;return s.addEventListener("change",$=>l($.target.value)),r(s,()=>o().map($=>(()=>{var y=hi();return r(y,()=>$.name||$.id),v(()=>oe(y,"key",$.id)),v(()=>y.value=$.id),y})()),null),_.$$click=c,v(()=>s.value=t()),u})()},get children(){return V(()=>!!n())()?pi():(()=>{var u=gi(),s=u.firstChild,_=s.firstChild,$=_.nextSibling;return r($,()=>i().map(y=>(()=>{var T=$i(),m=T.firstChild,p=m.nextSibling,g=p.nextSibling,x=g.nextSibling;return r(m,()=>{var S;return((S=y.collected_at)==null?void 0:S.slice(0,19))||y.CollectedAt}),r(p,()=>y.device_name||y.DeviceName),r(g,()=>y.field_name||y.FieldName),r(x,()=>y.value||y.Value),v(()=>oe(T,"key",y.id)),T})()),null),r($,(()=>{var y=V(()=>i().length===0);return()=>y()&&vi()})(),null),u})()}})}ne(["click"]);var _i=h('<form class=form><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>产品Key (可选)</label><input class=form-input></div><div class=form-group><label class=form-label>设备Key (可选)</label><input class=form-input></div></div><div class=form-group><label class=form-label>保留天数</label><input class=form-input type=number required></div><div class=flex style=gap:12px;margin-top:12px><button class="btn btn-primary"type=submit style=flex:1></button><button class=btn type=button style=flex:1>重置'),mi=h('<div class=grid style="grid-template-columns:3fr 1.4fr;gap:24px">'),xi=h("<button class=btn>立即清理"),yi=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),wi=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>产品Key</th><th>设备Key</th><th>保留天数</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Si=h('<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class="btn btn-danger">删除'),Ci=h("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置");const gt={name:"",product_key:"",device_key:"",storage_days:30,enabled:1};function ki(){const e=ce(),[t,l]=w([]),[i,a]=w(!0),[n,d]=w(gt),[o,f]=w(null),[c,u]=w(!1),s=()=>{a(!0),Y("/api/storage").then(m=>l(m.data||m)).catch(()=>e.show("error","加载存储配置失败")).finally(()=>a(!1))};Z(()=>{s()});const _=m=>{m.preventDefault(),u(!0),(o()?ot(`/api/storage/${o()}`,n()):re("/api/storage",n())).then(()=>{e.show("success",o()?"已更新":"已创建"),d(gt),f(null),s()}).catch(()=>e.show("error","操作失败")).finally(()=>u(!1))},$=m=>{confirm("删除该配置？")&&Ie(`/api/storage/${m}`).then(()=>{e.show("success","已删除"),s()}).catch(()=>e.show("error","删除失败"))},y=m=>{f(m.id),d({name:m.name,product_key:m.product_key||"",device_key:m.device_key||"",storage_days:m.storage_days,enabled:m.enabled})},T=()=>{re("/api/storage/run",{}).then(m=>e.show("success",`清理完成，删除 ${m.deleted_count} 条记录`)).catch(()=>e.show("error","清理失败"))};return(()=>{var m=mi();return r(m,b(se,{title:"存储策略列表",get extra(){return(()=>{var p=xi();return p.$$click=T,p})()},get children(){return V(()=>!!i())()?yi():(()=>{var p=wi(),g=p.firstChild,x=g.firstChild,S=x.nextSibling;return r(S,b(le,{get each(){return t()},children:C=>(()=>{var k=Si(),O=k.firstChild,N=O.nextSibling,M=N.nextSibling,j=M.nextSibling,R=j.nextSibling,F=R.nextSibling,U=F.firstChild,W=F.nextSibling,B=W.firstChild,K=B.nextSibling;return r(O,()=>C.id),r(N,()=>C.name),r(M,()=>C.product_key||"-"),r(j,()=>C.device_key||"-"),r(R,()=>C.storage_days),r(U,()=>C.enabled===1?"启用":"禁用"),B.$$click=()=>y(C),K.$$click=()=>$(C.id),v(()=>de(U,`badge ${C.enabled===1?"badge-running":"badge-stopped"}`)),k})()}),null),r(S,b(le,{get each(){return t().length===0?[1]:[]},children:()=>Ci()}),null),p})()}}),null),r(m,b(se,{get title(){return o()?"编辑存储策略":"新增存储策略"},get children(){var p=_i(),g=p.firstChild,x=g.firstChild,S=x.nextSibling,C=g.nextSibling,k=C.firstChild,O=k.firstChild,N=O.nextSibling,M=k.nextSibling,j=M.firstChild,R=j.nextSibling,F=C.nextSibling,U=F.firstChild,W=U.nextSibling,B=F.nextSibling,K=B.firstChild,ee=K.nextSibling;return p.addEventListener("submit",_),S.$$input=J=>d({...n(),name:J.target.value}),N.$$input=J=>d({...n(),product_key:J.target.value}),R.$$input=J=>d({...n(),device_key:J.target.value}),W.$$input=J=>d({...n(),storage_days:+J.target.value}),r(K,(()=>{var J=V(()=>!!c());return()=>J()?"保存中...":o()?"保存":"创建"})()),ee.$$click=()=>{d(gt),f(null)},v(()=>K.disabled=c()),v(()=>S.value=n().name),v(()=>N.value=n().product_key),v(()=>R.value=n().device_key),v(()=>W.value=n().storage_days),p}}),null),m})()}ne(["input","click"]);function Ei(){return b(ki,{})}var Ti=h("<div><main class=container style=padding-top:32px;padding-bottom:32px></main><div id=toast-container class=toast-container>");function Li(){const[e,t]=ml(),[l,i]=w(!0);Z(()=>{e()!=="/login"&&Y("/api/status").then(()=>i(!0)).catch(()=>{i(!1),Gt("/login")})});const a=()=>{const n=e();switch(!0){case n==="/login":return b(Xl,{onSuccess:()=>t("/")});case n==="/":return b(Pt,{});case n.startsWith("/resources"):return b(sn,{});case n.startsWith("/devices"):return b(wn,{});case n.startsWith("/drivers"):return b(Dn,{});case n.startsWith("/northbound"):return b(Wn,{});case n.startsWith("/storage"):return b(Ei,{});case n.startsWith("/thresholds"):return b(Gn,{});case n.startsWith("/alarms"):return b(ii,{});case n.startsWith("/realtime"):return b(ui,{});case n.startsWith("/history"):return b(bi,{});default:return b(Pt,{})}};return(()=>{var n=Ti(),d=n.firstChild;return r(n,b(X,{get when(){return e()!=="/login"},get children(){return b(Ll,{get path(){return e()},onNav:t})}}),d),r(d,a),n})()}const jt=document.getElementById("app-root");jt&&Jt(()=>b(Li,{}),jt);const Ai={};typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-solid-island]").forEach(e=>{const t=e.getAttribute("data-solid-island"),l=Ai[t];if(!l)return;const i=e.dataset.props?JSON.parse(e.dataset.props):{};Jt(()=>b(l,i),e)})});
