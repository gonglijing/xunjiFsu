const rl=(e,t)=>e===t,sl=Symbol("solid-track"),lt={equals:rl};let Ot=Bt;const Se=1,nt=2,jt={owned:null,cleanups:null,context:null,owner:null};var z=null;let pt=null,al=null,H=null,te=null,ve=null,at=0;function tt(e,t){const l=H,i=z,a=e.length===0,n=t===void 0?i:t,c=a?jt:{owned:null,cleanups:null,context:n?n.context:null,owner:n},o=a?e:()=>e(()=>Ae(()=>Ge(c)));z=c,H=null;try{return Je(o,!0)}finally{H=l,z=i}}function w(e,t){t=t?Object.assign({},lt,t):lt;const l={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=a=>(typeof a=="function"&&(a=a(l.value)),Wt(l,a));return[Rt.bind(l),i]}function v(e,t,l){const i=bt(e,t,!1,Se);Ve(i)}function Z(e,t,l){Ot=dl;const i=bt(e,t,!1,Se);i.user=!0,ve?ve.push(i):Ve(i)}function Ue(e,t,l){l=l?Object.assign({},lt,l):lt;const i=bt(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=l.equals||void 0,Ve(i),Rt.bind(i)}function Ae(e){if(H===null)return e();const t=H;H=null;try{return e()}finally{H=t}}function Ke(e){return z===null||(z.cleanups===null?z.cleanups=[e]:z.cleanups.push(e)),e}function Rt(){if(this.sources&&this.state)if(this.state===Se)Ve(this);else{const e=te;te=null,Je(()=>rt(this),!1),te=e}if(H){const e=this.observers?this.observers.length:0;H.sources?(H.sources.push(this),H.sourceSlots.push(e)):(H.sources=[this],H.sourceSlots=[e]),this.observers?(this.observers.push(H),this.observerSlots.push(H.sources.length-1)):(this.observers=[H],this.observerSlots=[H.sources.length-1])}return this.value}function Wt(e,t,l){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&Je(()=>{for(let a=0;a<e.observers.length;a+=1){const n=e.observers[a],c=pt&&pt.running;c&&pt.disposed.has(n),(c?!n.tState:!n.state)&&(n.pure?te.push(n):ve.push(n),n.observers&&Ft(n)),c||(n.state=Se)}if(te.length>1e6)throw te=[],new Error},!1)),t}function Ve(e){if(!e.fn)return;Ge(e);const t=at;ol(e,e.value,t)}function ol(e,t,l){let i;const a=z,n=H;H=z=e;try{i=e.fn(t)}catch(c){return e.pure&&(e.state=Se,e.owned&&e.owned.forEach(Ge),e.owned=null),e.updatedAt=l+1,Ut(c)}finally{H=n,z=a}(!e.updatedAt||e.updatedAt<=l)&&(e.updatedAt!=null&&"observers"in e?Wt(e,i):e.value=i,e.updatedAt=l)}function bt(e,t,l,i=Se,a){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:z,context:z?z.context:null,pure:l};return z===null||z!==jt&&(z.owned?z.owned.push(n):z.owned=[n]),n}function it(e){if(e.state===0)return;if(e.state===nt)return rt(e);if(e.suspense&&Ae(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<at);)e.state&&t.push(e);for(let l=t.length-1;l>=0;l--)if(e=t[l],e.state===Se)Ve(e);else if(e.state===nt){const i=te;te=null,Je(()=>rt(e,t[0]),!1),te=i}}function Je(e,t){if(te)return e();let l=!1;t||(te=[]),ve?l=!0:ve=[],at++;try{const i=e();return cl(l),i}catch(i){l||(ve=null),te=null,Ut(i)}}function cl(e){if(te&&(Bt(te),te=null),e)return;const t=ve;ve=null,t.length&&Je(()=>Ot(t),!1)}function Bt(e){for(let t=0;t<e.length;t++)it(e[t])}function dl(e){let t,l=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[l++]=i:it(i)}for(t=0;t<l;t++)it(e[t])}function rt(e,t){e.state=0;for(let l=0;l<e.sources.length;l+=1){const i=e.sources[l];if(i.sources){const a=i.state;a===Se?i!==t&&(!i.updatedAt||i.updatedAt<at)&&it(i):a===nt&&rt(i,t)}}}function Ft(e){for(let t=0;t<e.observers.length;t+=1){const l=e.observers[t];l.state||(l.state=nt,l.pure?te.push(l):ve.push(l),l.observers&&Ft(l))}}function Ge(e){let t;if(e.sources)for(;e.sources.length;){const l=e.sources.pop(),i=e.sourceSlots.pop(),a=l.observers;if(a&&a.length){const n=a.pop(),c=l.observerSlots.pop();i<a.length&&(n.sourceSlots[c]=i,a[i]=n,l.observerSlots[i]=c)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ge(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ge(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function ul(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ut(e,t=z){throw ul(e)}const fl=Symbol("fallback");function Dt(e){for(let t=0;t<e.length;t++)e[t]()}function hl(e,t,l={}){let i=[],a=[],n=[],c=0,o=t.length>1?[]:null;return Ke(()=>Dt(n)),()=>{let f=e()||[],d=f.length,u,s;return f[sl],Ae(()=>{let b,y,L,_,p,$,g,C,S;if(d===0)c!==0&&(Dt(n),n=[],i=[],a=[],c=0,o&&(o=[])),l.fallback&&(i=[fl],a[0]=tt(k=>(n[0]=k,l.fallback())),c=1);else if(c===0){for(a=new Array(d),s=0;s<d;s++)i[s]=f[s],a[s]=tt(x);c=d}else{for(L=new Array(d),_=new Array(d),o&&(p=new Array(d)),$=0,g=Math.min(c,d);$<g&&i[$]===f[$];$++);for(g=c-1,C=d-1;g>=$&&C>=$&&i[g]===f[C];g--,C--)L[C]=a[g],_[C]=n[g],o&&(p[C]=o[g]);for(b=new Map,y=new Array(C+1),s=C;s>=$;s--)S=f[s],u=b.get(S),y[s]=u===void 0?-1:u,b.set(S,s);for(u=$;u<=g;u++)S=i[u],s=b.get(S),s!==void 0&&s!==-1?(L[s]=a[u],_[s]=n[u],o&&(p[s]=o[u]),s=y[s],b.set(S,s)):n[u]();for(s=$;s<d;s++)s in L?(a[s]=L[s],n[s]=_[s],o&&(o[s]=p[s],o[s](s))):a[s]=tt(x);a=a.slice(0,c=d),i=f.slice(0)}return a});function x(b){if(n[s]=b,o){const[y,L]=w(s);return o[s]=L,t(f[s],y)}return t(f[s])}}}function m(e,t){return Ae(()=>e(t||{}))}const pl=e=>`Stale read from <${e}>.`;function le(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Ue(hl(()=>e.each,e.children,t||void 0))}function X(e){const t=e.keyed,l=Ue(()=>e.when,void 0,void 0),i=t?l:Ue(l,void 0,{equals:(a,n)=>!a==!n});return Ue(()=>{const a=i();if(a){const n=e.children;return typeof n=="function"&&n.length>0?Ae(()=>n(t?a:()=>{if(!Ae(i))throw pl("Show");return l()})):n}return e.fallback},void 0,void 0)}const V=e=>Ue(()=>e());function gl(e,t,l){let i=l.length,a=t.length,n=i,c=0,o=0,f=t[a-1].nextSibling,d=null;for(;c<a||o<n;){if(t[c]===l[o]){c++,o++;continue}for(;t[a-1]===l[n-1];)a--,n--;if(a===c){const u=n<i?o?l[o-1].nextSibling:l[n-o]:f;for(;o<n;)e.insertBefore(l[o++],u)}else if(n===o)for(;c<a;)(!d||!d.has(t[c]))&&t[c].remove(),c++;else if(t[c]===l[n-1]&&l[o]===t[a-1]){const u=t[--a].nextSibling;e.insertBefore(l[o++],t[c++].nextSibling),e.insertBefore(l[--n],u),t[a]=l[n]}else{if(!d){d=new Map;let s=o;for(;s<n;)d.set(l[s],s++)}const u=d.get(t[c]);if(u!=null)if(o<u&&u<n){let s=c,x=1,b;for(;++s<a&&s<n&&!((b=d.get(t[s]))==null||b!==u+x);)x++;if(x>u-o){const y=t[c];for(;o<u;)e.insertBefore(l[o++],y)}else e.replaceChild(l[o++],t[c++])}else c++;else t[c++].remove()}}}const Nt="_$DX_DELEGATE";function Gt(e,t,l,i={}){let a;return tt(n=>{a=n,t===document?e():r(t,e(),t.firstChild?null:void 0,l)},i.owner),()=>{a(),t.textContent=""}}function h(e,t,l,i){let a;const n=()=>{const o=document.createElement("template");return o.innerHTML=e,o.content.firstChild},c=()=>(a||(a=n())).cloneNode(!0);return c.cloneNode=c,c}function ne(e,t=window.document){const l=t[Nt]||(t[Nt]=new Set);for(let i=0,a=e.length;i<a;i++){const n=e[i];l.has(n)||(l.add(n),t.addEventListener(n,bl))}}function oe(e,t,l){l==null?e.removeAttribute(t):e.setAttribute(t,l)}function ce(e,t){t==null?e.removeAttribute("class"):e.className=t}function $l(e,t,l){if(!t)return l?oe(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof l=="string"&&(i.cssText=l=void 0),l||(l={}),t||(t={});let a,n;for(n in l)t[n]==null&&i.removeProperty(n),delete l[n];for(n in t)a=t[n],a!==l[n]&&(i.setProperty(n,a),l[n]=a);return l}function Kt(e,t,l){return Ae(()=>e(t,l))}function r(e,t,l,i){if(l!==void 0&&!i&&(i=[]),typeof t!="function")return st(e,t,i,l);v(a=>st(e,t(),a,l),i)}function bl(e){let t=e.target;const l=`$$${e.type}`,i=e.target,a=e.currentTarget,n=f=>Object.defineProperty(e,"target",{configurable:!0,value:f}),c=()=>{const f=t[l];if(f&&!t.disabled){const d=t[`${l}Data`];if(d!==void 0?f.call(t,d,e):f.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},o=()=>{for(;c()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const f=e.composedPath();n(f[0]);for(let d=0;d<f.length-2&&(t=f[d],!!c());d++){if(t._$host){t=t._$host,o();break}if(t.parentNode===a)break}}else o();n(i)}function st(e,t,l,i,a){for(;typeof l=="function";)l=l();if(t===l)return l;const n=typeof t,c=i!==void 0;if(e=c&&l[0]&&l[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===l))return l;if(c){let o=l[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),l=qe(e,l,i,o)}else l!==""&&typeof l=="string"?l=e.firstChild.data=t:l=e.textContent=t}else if(t==null||n==="boolean")l=qe(e,l,i);else{if(n==="function")return v(()=>{let o=t();for(;typeof o=="function";)o=o();l=st(e,o,l,i)}),()=>l;if(Array.isArray(t)){const o=[],f=l&&Array.isArray(l);if($t(o,t,l,a))return v(()=>l=st(e,o,l,i,!0)),()=>l;if(o.length===0){if(l=qe(e,l,i),c)return l}else f?l.length===0?qt(e,o,i):gl(e,l,o):(l&&qe(e),qt(e,o));l=o}else if(t.nodeType){if(Array.isArray(l)){if(c)return l=qe(e,l,i,t);qe(e,l,null,t)}else l==null||l===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);l=t}}return l}function $t(e,t,l,i){let a=!1;for(let n=0,c=t.length;n<c;n++){let o=t[n],f=l&&l[e.length],d;if(!(o==null||o===!0||o===!1))if((d=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))a=$t(e,o,f)||a;else if(d==="function")if(i){for(;typeof o=="function";)o=o();a=$t(e,Array.isArray(o)?o:[o],Array.isArray(f)?f:[f])||a}else e.push(o),a=!0;else{const u=String(o);f&&f.nodeType===3&&f.data===u?e.push(f):e.push(document.createTextNode(u))}}return a}function qt(e,t,l=null){for(let i=0,a=t.length;i<a;i++)e.insertBefore(t[i],l)}function qe(e,t,l,i){if(l===void 0)return e.textContent="";const a=i||document.createTextNode("");if(t.length){let n=!1;for(let c=t.length-1;c>=0;c--){const o=t[c];if(a!==o){const f=o.parentNode===e;!n&&!c?f?e.replaceChild(a,o):e.insertBefore(a,l):f&&o.remove()}else n=!0}}else e.insertBefore(a,l);return[a]}const[Vt,Jt]=w(window.location.pathname||"/"),[vl,Ht]=w(new URLSearchParams(window.location.search));if(typeof window<"u"){const e=()=>{Jt(window.location.pathname||"/"),Ht(new URLSearchParams(window.location.search))};window.addEventListener("popstate",e),Ke(()=>window.removeEventListener("popstate",e))}function zt(e,t={}){const l=Vt();e!==l&&(t.replace?window.history.replaceState({},"",e):window.history.pushState({},"",e),Jt(e),Ht(new URLSearchParams(window.location.search)),window.scrollTo({top:0,behavior:"smooth"}))}function _l(){return[Vt,zt,vl]}function we(e,t){return t==="/"?e==="/":String(e).startsWith(t)}const vt="gogw_jwt";function ml(){return localStorage.getItem(vt)||""}function _t(e={}){const t=ml();return t?{...e,Authorization:`Bearer ${t}`}:e}function xl(e){if(e.status===401)throw localStorage.removeItem(vt),window.location.href="/login",new Error("unauthorized")}async function He(e,t={}){const l=await fetch(e,{credentials:"same-origin",headers:_t(t.headers),...t});return xl(l),l}async function ze(e){if(e.status===204)return null;const t=await e.text();if(!t)return null;try{const l=JSON.parse(t);if(l&&typeof l=="object"&&"success"in l){if(l.success)return l.data??null;const i=l.error||l.message||"request failed";throw new Error(i)}return l}catch{throw new Error("invalid json")}}function yl(e){e&&localStorage.setItem(vt,e)}async function Y(e,t={}){const l=await He(e,t);if(!l.ok)throw new Error(`${l.status} ${l.statusText}`);return ze(l)}async function re(e,t,l={}){const i=await He(e,{method:"POST",headers:_t({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return ze(i)}async function ot(e,t,l={}){const i=await He(e,{method:"PUT",headers:_t({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return ze(i)}async function Ie(e){const t=await He(e,{method:"DELETE"});if(!t.ok&&t.status!==204)throw new Error(`${t.status} ${t.statusText}`);return t.status===204?null:ze(t)}async function wl(e,t,l={}){const i=await He(e,{method:"POST",body:t,...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return ze(i)}var Sl=h("<div class=dropdown-menu>"),Cl=h('<nav class=nav><div class="container nav-inner"><div class=nav-brand><svg class=nav-brand-icon viewBox="0 0 48 48"fill=none xmlns=http://www.w3.org/2000/svg><defs><linearGradient id=brandGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#3b82f6></stop><stop offset=100% style=stop-color:#8b5cf6></stop></linearGradient><linearGradient id=chipGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#06b6d4></stop><stop offset=100% style=stop-color:#22d3ee></stop></linearGradient></defs><rect x=4 y=4 width=40 height=40 rx=10 fill=url(#brandGradient) opacity=0.15></rect><rect x=4 y=4 width=40 height=40 rx=10 stroke=url(#brandGradient) stroke-width=2></rect><rect x=14 y=14 width=20 height=20 rx=4 fill=url(#chipGradient) opacity=0.9></rect><circle cx=18 cy=18 r=2 fill=white opacity=0.9></circle><circle cx=18 cy=30 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=18 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=30 r=2 fill=white opacity=0.9></circle><path d="M24 10V14M24 34V38M10 24H14M34 24H38"stroke=url(#brandGradient) stroke-width=2 stroke-linecap=round></path></svg><div class=nav-brand-text><div class=nav-title><span class=brand-hu>Hu</span><span class=brand-shu>Shu</span><span class=brand-gateway>智能网关</span></div><div class=nav-subtitle><span class=subtitle-icon>◆</span>工业物联网网关管理平台</div></div></div><div class=nav-links><div class=dropdown><button><span class=nav-btn-icon>⚙</span>设置<span class=dropdown-arrow>▾</span></button></div><a class="nav-btn nav-btn-danger"href=/logout><span class=nav-btn-icon>⏻</span>退出'),kl=h("<a><span class=nav-btn-icon>"),El=h("<a><span class=dropdown-item-icon>");const Ll=[{to:"/",label:"仪表盘",icon:"◉"},{to:"/alarms",label:"报警",icon:"⚠"},{to:"/realtime",label:"实时",icon:"◈"},{to:"/history",label:"历史",icon:"▤"}],Tl=[{to:"/resources",label:"资源",icon:"◐"},{to:"/devices",label:"设备",icon:"◑"},{to:"/drivers",label:"驱动",icon:"▣"},{to:"/northbound",label:"北向",icon:"◉"},{to:"/storage",label:"存储策略",icon:"◫"},{to:"/thresholds",label:"阈值",icon:"◐"}];function Al(e){const[t,l]=w(!1);let i;const a=o=>{localStorage.removeItem("gogw_jwt")},n=()=>{l(!1)},c=o=>{i&&!i.contains(o.target)&&l(!1)};return(()=>{var o=Cl(),f=o.firstChild,d=f.firstChild,u=d.nextSibling,s=u.firstChild,x=s.firstChild,b=s.nextSibling;u.$$click=c,r(u,()=>Ll.map(L=>(()=>{var _=kl(),p=_.firstChild;return _.$$click=$=>{$.preventDefault(),e.onNav(L.to),n()},r(p,()=>L.icon),r(_,()=>L.label,null),v($=>{var g=L.to,C=L.to,S=`nav-btn ${we(e.path,L.to)?"active":""}`;return g!==$.e&&oe(_,"key",$.e=g),C!==$.t&&oe(_,"href",$.t=C),S!==$.a&&ce(_,$.a=S),$},{e:void 0,t:void 0,a:void 0}),_})()),s);var y=i;return typeof y=="function"?Kt(y,s):i=s,x.$$click=()=>l(!t()),r(s,m(X,{get when(){return t()},get children(){var L=Sl();return r(L,()=>Tl.map(_=>(()=>{var p=El(),$=p.firstChild;return p.$$click=g=>{g.preventDefault(),e.onNav(_.to),n()},r($,()=>_.icon),r(p,()=>_.label,null),v(g=>{var C=_.to,S=_.to,k=`dropdown-item ${we(e.path,_.to)?"active":""}`;return C!==g.e&&oe(p,"key",g.e=C),S!==g.t&&oe(p,"href",g.t=S),k!==g.a&&ce(p,g.a=k),g},{e:void 0,t:void 0,a:void 0}),p})())),L}}),null),b.$$click=L=>{L.preventDefault(),a(),e.onNav("/login")},v(()=>ce(x,`nav-btn dropdown-toggle ${we(e.path,"/resources")||we(e.path,"/devices")||we(e.path,"/drivers")||we(e.path,"/northbound")||we(e.path,"/storage")||we(e.path,"/thresholds")?"active":""}`)),o})()}ne(["click"]);var Dl=h("<div class=card><div class=card-body>"),Nl=h("<div class=card-header>"),ql=h("<h3 class=card-title>"),Il=h("<div class=card-extra>");function se(e){return(()=>{var t=Dl(),l=t.firstChild;return r(t,(()=>{var i=V(()=>!!(e.title||e.extra));return()=>i()&&(()=>{var a=Nl();return r(a,(()=>{var n=V(()=>!!e.title);return()=>n()&&(()=>{var c=ql();return r(c,()=>e.title),c})()})(),null),r(a,(()=>{var n=V(()=>!!e.extra);return()=>n()&&(()=>{var c=Il();return r(c,()=>e.extra),c})()})(),null),a})()})(),l),r(l,()=>e.children),v(i=>$l(t,e.style||"",i)),t})()}ne(["click"]);function de(){return{show:(e,t)=>{typeof window<"u"&&window.toast&&window.toast.show(e,t)}}}ne(["click"]);var Pl=h("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Ml=h("<button class=btn>刷新"),Ol=h("<tr><td></td><td></td><td></td><td>"),jl=h("<tr><td colspan=4 style=text-align:center;padding:16px;color:var(--text-muted)>暂无数据");function Rl(){const e=de(),[t,l]=w([]),i=()=>{Y("/api/data/points").then(a=>l((a.data||a).slice(0,8))).catch(()=>e.show("error","加载实时数据失败"))};return Z(()=>{i();const a=setInterval(i,4e3);Ke(()=>clearInterval(a))}),m(se,{title:"最新采集",get extra(){return(()=>{var a=Ml();return a.$$click=i,a})()},get children(){var a=Pl(),n=a.firstChild,c=n.firstChild,o=c.nextSibling;return r(o,m(le,{get each(){return t()},children:f=>(()=>{var d=Ol(),u=d.firstChild,s=u.nextSibling,x=s.nextSibling,b=x.nextSibling;return r(u,()=>{var y;return((y=f.collected_at)==null?void 0:y.slice(5,19))||f.CollectedAt}),r(s,()=>f.device_name||f.DeviceName),r(x,()=>f.field_name||f.FieldName),r(b,()=>f.value||f.Value),v(()=>oe(d,"key",f.id||`${f.device_id}-${f.field_name}-${f.collected_at}`)),d})()}),null),r(o,m(le,{get each(){return t().length===0?[1]:[]},children:()=>jl()}),null),a}})}ne(["click"]);var Wl=h("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th><th>阈值</th><th>级别</th><th></th></tr></thead><tbody>"),Bl=h("<button class=btn>刷新"),Fl=h('<button class="btn btn-primary"style="padding:6px 10px">确认'),Ul=h('<span class="text-muted text-xs">已确认'),Gl=h("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td>"),Kl=h("<tr><td colspan=7 style=text-align:center;padding:16px;color:var(--text-muted)>暂无告警");function Vl(){const e=de(),[t,l]=w([]),i=()=>{Y("/api/alarms").then(n=>l((n.data||n).slice(0,8))).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const a=n=>{re(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return m(se,{title:"最近告警",get extra(){return(()=>{var n=Bl();return n.$$click=i,n})()},get children(){var n=Wl(),c=n.firstChild,o=c.firstChild,f=o.nextSibling;return r(f,m(le,{get each(){return t()},children:d=>(()=>{var u=Gl(),s=u.firstChild,x=s.nextSibling,b=x.nextSibling,y=b.nextSibling,L=y.nextSibling,_=L.nextSibling,p=_.firstChild,$=_.nextSibling;return r(s,()=>{var g;return((g=d.triggered_at)==null?void 0:g.slice(5,19))||d.triggered_at}),r(x,()=>d.device_id),r(b,()=>d.field_name),r(y,()=>d.actual_value),r(L,()=>`${d.operator} ${d.threshold_value}`),r(p,()=>d.severity||"warn"),r($,m(X,{get when(){return d.acknowledged!==1},get children(){var g=Fl();return g.$$click=()=>a(d.id),g}}),null),r($,m(X,{get when(){return d.acknowledged===1},get children(){return Ul()}}),null),v(()=>ce(p,`badge ${d.severity==="critical"?"badge-critical":"badge-running"}`)),u})()}),null),r(f,m(le,{get each(){return t().length===0?[1]:[]},children:()=>Kl()}),null),n}})}ne(["click"]);var Jl=h("<div class=flex style=gap:12px;flex-wrap:wrap><button>");function Hl(e){const t=de(),[l,i]=w(!1),a=()=>{i(!0);const n=e.collectorRunning?"/api/collector/stop":"/api/collector/start";re(n,{}).then(()=>{var c;t.show("success",e.collectorRunning?"已停止采集":"已启动采集"),(c=e.onRefresh)==null||c.call(e)}).catch(()=>t.show("error","操作失败")).finally(()=>i(!1))};return m(se,{title:"快捷操作",get children(){var n=Jl(),c=n.firstChild;return c.$$click=a,r(c,()=>e.collectorRunning?"停止采集器":"启动采集器"),v(o=>{var f=`btn ${e.collectorRunning?"btn-danger":"btn-success"}`,d=l();return f!==o.e&&ce(c,o.e=f),d!==o.t&&(c.disabled=o.t=d),o},{e:void 0,t:void 0}),n}})}ne(["click"]);var zl=h('<div><div class=grid style="grid-template-columns:2fr 1fr;gap:24px"><div class=grid style=grid-template-columns:1fr;gap:24px></div><div class=grid style=grid-template-columns:1fr;gap:24px>');function It(){const[e,t]=w(null),[l,i]=w(!0),a=()=>{Y("/api/status").then(n=>t(n.data||n)).catch(()=>{}).finally(()=>i(!1))};return Z(()=>{a();const n=setInterval(a,5e3);Ke(()=>clearInterval(n))}),(()=>{var n=zl(),c=n.firstChild,o=c.firstChild,f=o.nextSibling;return r(n,m(se,{get data(){return e()},get loading(){return l()}}),c),r(o,m(Rl,{}),null),r(o,m(Vl,{}),null),r(f,m(Hl,{get collectorRunning(){var d;return(d=e())==null?void 0:d.collector_running},onRefresh:a})),n})()}var Ql=h('<div class=container style=max-width:420px;margin-top:48px><div class=card><div class=card-header><h3 class=card-title>登录</h3></div><form class=form><div class=form-group><label class=form-label>用户名</label><input class=form-input required></div><div class=form-group><label class=form-label>密码</label><input class=form-input type=password required></div><button class="btn btn-primary"type=submit style=width:100%;margin-top:8px>'),Xl=h('<div style="color:var(--accent-red);padding:8px 0">');function Yl(e){const[t,l]=w("admin"),[i,a]=w("123456"),[n,c]=w(""),[o,f]=w(!1),d=u=>{u.preventDefault(),f(!0),c(""),re("/login",{username:t(),password:i()}).then(s=>{yl(s.token),window.location.replace("/")}).catch(()=>c("用户名或密码错误")).finally(()=>f(!1))};return(()=>{var u=Ql(),s=u.firstChild,x=s.firstChild,b=x.nextSibling,y=b.firstChild,L=y.firstChild,_=L.nextSibling,p=y.nextSibling,$=p.firstChild,g=$.nextSibling,C=p.nextSibling;return b.addEventListener("submit",d),_.$$input=S=>l(S.target.value),g.$$input=S=>a(S.target.value),r(b,(()=>{var S=V(()=>!!n());return()=>S()&&(()=>{var k=Xl();return r(k,n),k})()})(),C),r(C,()=>o()?"登录中...":"登录"),v(()=>C.disabled=o()),v(()=>_.value=t()),v(()=>g.value=i()),u})()}ne(["input"]);var Zl=h("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无资源"),en=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>路径</th><th>状态</th><th>操作</th></tr></thead><tbody>"),tn=h('<div style="color:var(--accent-red);padding:4px 0">'),ln=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title></h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=serial>串口</option><option value=di>DI</option><option value=do>DO</option></select></div><div class=form-group><label class=form-label>路径</label><input class=form-input placeholder="如 /dev/ttyUSB0 或 eth0"required></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),nn=h("<div>"),rn=h('<button class="btn btn-primary">新增资源'),sn=h('<tr><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const Ze={name:"",type:"serial",path:"",enabled:1};function an(){const e=de(),[t,l]=w([]),[i,a]=w(Ze),[n,c]=w(null),[o,f]=w(!1),[d,u]=w(!1),[s,x]=w(""),b=()=>{Y("/api/resources").then(p=>l(p.data||p)).catch(()=>e.show("error","加载资源失败"))};Z(()=>{b()}),Z(()=>{if(!o())return;const p=$=>{$.key==="Escape"&&f(!1)};window.addEventListener("keydown",p),Ke(()=>window.removeEventListener("keydown",p))});const y=p=>{p.preventDefault(),u(!0),x(""),(n()?ot(`/api/resources/${n()}`,i()):re("/api/resources",i())).then(()=>{e.show("success",n()?"资源已更新":"资源已创建"),a(Ze),c(null),f(!1),b()}).catch(g=>{x(g.message||"保存失败"),e.show("error","保存失败")}).finally(()=>u(!1))},L=p=>{confirm("删除该资源？")&&confirm("删除后关联设备可能需要重新绑定资源，确认继续？")&&Ie(`/api/resources/${p}`).then(()=>{e.show("success","已删除"),b()}).catch(()=>e.show("error","删除失败"))},_=p=>{re(`/api/resources/${p.id}/toggle`,{}).then(b).catch(()=>e.show("error","切换失败"))};return(()=>{var p=nn();return r(p,m(se,{title:"资源列表",get extra(){return(()=>{var $=rn();return $.$$click=()=>{a(Ze),c(null),x(""),f(!0)},$})()},get children(){var $=en(),g=$.firstChild,C=g.firstChild,S=C.nextSibling;return r(S,m(le,{get each(){return t()},children:k=>(()=>{var M=sn(),N=M.firstChild,j=N.nextSibling,O=j.nextSibling,R=O.nextSibling,B=R.nextSibling,F=B.firstChild,W=B.nextSibling,U=W.firstChild,G=U.nextSibling,ee=G.nextSibling;return r(N,()=>k.id),r(j,()=>k.name),r(O,()=>k.type),r(R,()=>k.path),r(F,()=>k.enabled===1?"启用":"禁用"),U.$$click=()=>{c(k.id),a({name:k.name,type:k.type,path:k.path,enabled:k.enabled}),x(""),f(!0)},G.$$click=()=>_(k),r(G,()=>k.enabled===1?"禁用":"启用"),ee.$$click=()=>L(k.id),v(()=>ce(F,`badge ${k.enabled===1?"badge-running":"badge-stopped"}`)),M})()}),null),r(S,m(X,{get when(){return t().length===0},get children(){return Zl()}}),null),$}}),null),r(p,m(X,{get when(){return o()},get children(){var $=ln(),g=$.firstChild,C=g.firstChild,S=C.firstChild,k=C.nextSibling,M=k.firstChild,N=M.firstChild,j=N.nextSibling,O=M.nextSibling,R=O.firstChild,B=R.nextSibling,F=O.nextSibling,W=F.firstChild,U=W.nextSibling,G=F.nextSibling,ee=G.firstChild,K=ee.nextSibling;return $.$$click=P=>{P.target===P.currentTarget&&f(!1)},r(S,()=>n()?"编辑资源":"新增资源"),k.addEventListener("submit",y),j.$$input=P=>a({...i(),name:P.target.value}),B.addEventListener("change",P=>a({...i(),type:P.target.value})),U.$$input=P=>a({...i(),path:P.target.value}),r(k,m(X,{get when(){return s()},get children(){var P=tn();return r(P,s),P}}),G),ee.$$click=()=>{f(!1),c(null),a(Ze)},r(K,(()=>{var P=V(()=>!!d());return()=>P()?"保存中...":n()?"保存":"创建"})()),v(P=>{var ue=d(),pe=d();return ue!==P.e&&(ee.disabled=P.e=ue),pe!==P.t&&(K.disabled=P.t=pe),P},{e:void 0,t:void 0}),v(()=>j.value=i().name),v(()=>B.value=i().type),v(()=>U.value=i().path),$}}),null),p})()}ne(["click","input"]);var on=h('<div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>串口</label><input class=form-input required></div><div class=form-group><label class=form-label>波特率</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>校验位</label><select class=form-select><option value=N>None</option><option value=E>Even</option><option value=O>Odd</option></select></div><div class=form-group><label class=form-label>数据位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>停止位</label><input class=form-input type=number required>'),cn=h('<div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>IP 地址</label><input class=form-input required></div><div class=form-group><label class=form-label>端口</label><input class=form-input type=number required>'),dn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:640px;max-width:100%><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:0 4px"><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>描述</label><input class=form-input></div></div><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>ProductKey</label><input class=form-input></div><div class=form-group><label class=form-label>DeviceKey</label><input class=form-input></div></div><div class=form-group><label class=form-label>驱动类型</label><select class=form-select><option value=modbus_rtu_wasm>ModbusRtu / Wasm</option><option value=modbus_tcp_wasm>ModbusTcp / Wasm</option><option value=modbus_rtu_excel>ModbusRtu / Excel</option><option value=modbus_tcp_excel>ModbusTcp / Excel</option></select></div><div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>设备地址</label><input class=form-input required></div><div class=form-group><label class=form-label>采集周期 (ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>超时 (ms)</label><input class=form-input type=number></div></div><div class=form-group><label class=form-label>绑定资源</label><select class=form-select><option value>不绑定</option></select><div class="text-muted text-xs"style=margin-top:4px>同一资源串行访问，建议按驱动类型匹配。</div></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:16px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),un=h("<div style=color:var(--text-muted);font-size:12px;margin-top:4px>驱动未提供可写元数据"),fn=h('<div style="color:var(--accent-red);padding:4px 0">'),hn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title>写寄存器</h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>字段</label><select class=form-select required><option value>选择字段</option></select></div><div class=form-group><label class=form-label>值</label><input class=form-input required></div><div class=flex style=gap:8px;justify-content:flex-end;margin-top:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">写入'),pn=h("<div>"),gn=h('<div class="flex gap-3"><input class=form-input placeholder=搜索设备/地址/驱动 style=max-width:240px><button class=btn>刷新</button><button class="btn btn-primary">新增设备'),$n=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),bn=h('<div style="color:var(--accent-red);padding:16px 0">'),vn=h("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无设备"),_n=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>产品/设备Key</th><th>驱动类型</th><th>驱动</th><th>资源</th><th>周期(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),mn=h('<tr><td></td><td></td><td style=min-width:140px><div class=text-sm></div><div class="text-muted text-xs"></div></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn>写</button><button></button><button class="btn btn-danger">删除'),xn=h('<div><div></div><div class="text-muted text-xs">'),yn=h("<span class=text-muted>未绑定"),Pt=h("<option>");const Be={name:"",description:"",product_key:"",device_key:"",driver_type:"modbus_rtu_wasm",serial_port:"/dev/ttyS0",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",ip_address:"",port_num:502,device_address:"1",collect_interval:1e3,timeout:1e3,resource_id:null,enabled:1};function wn(){const e=de(),[t,l]=w([]),[i,a]=w([]),[n,c]=w(!0),[o,f]=w(""),[d,u]=w(""),[s,x]=w(Be),[b,y]=w(null),[L,_]=w(!1),[p,$]=w(!1),[g,C]=w(!1),[S,k]=w([]),[M,N]=w({field:"",value:""}),[j,O]=w(""),[R,B]=w(null);let F;const W=()=>{c(!0),Promise.all([Y("/api/devices"),Y("/api/resources")]).then(([E,T])=>{l(E.data||E),a(T.data||T),f("")}).catch(()=>f("加载设备或资源失败")).finally(()=>c(!1))};Z(()=>{W()}),Z(()=>{if(!L())return;const E=T=>{T.key==="Escape"&&_(!1)};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)});const U=()=>{const E=d().trim().toLowerCase();return E?t().filter(T=>[T.name,T.device_address,T.driver_type,T.driver_name].filter(Boolean).some(q=>q.toLowerCase().includes(E))):t()},G=E=>{E.preventDefault(),$(!0),(b()?ot(`/api/devices/${b()}`,s()):re("/api/devices",s())).then(()=>{e.show("success",b()?"设备已更新":"设备已创建"),x(Be),y(null),_(!1),W()}).catch(()=>e.show("error","操作失败")).finally(()=>$(!1))},ee=E=>{re(`/api/devices/${E}/toggle`,{}).then(W).catch(()=>e.show("error","切换失败"))},K=E=>{confirm("确定删除该设备？")&&confirm("删除后将无法恢复，继续吗？")&&Ie(`/api/devices/${E}`).then(()=>{e.show("success","已删除"),W()}).catch(()=>e.show("error","删除失败"))},P=E=>{O(""),k([]),N({field:"",value:""}),B(E.id),C(!0),Y(`/api/devices/${E.id}/writables`).then(T=>{const q=(T==null?void 0:T.data)||T||[];k(q),q.length&&N({field:q[0].field||"",value:""})}).catch(()=>O("加载可写寄存器失败"))},ue=E=>{E.preventDefault(),O("");const T=M().field,q=M().value;if(!T){O("请选择字段");return}re(`/api/devices/${R()}/execute`,{function:"handle",params:{func_name:"write",field:T,value:q}}).then(()=>{e.show("success","写入成功"),C(!1)}).catch(Q=>O(Q.message||"写入失败"))},pe=()=>{x(Be),y(null),_(!0)},Ce=E=>{y(E.id),x({name:E.name,description:E.description||"",product_key:E.product_key||"",device_key:E.device_key||"",driver_type:E.driver_type,serial_port:E.serial_port||"/dev/ttyS0",baud_rate:E.baud_rate||9600,data_bits:E.data_bits||8,stop_bits:E.stop_bits||1,parity:E.parity||"N",ip_address:E.ip_address||"",port_num:E.port_num||502,device_address:E.device_address||"1",collect_interval:E.collect_interval||1e3,timeout:E.timeout||1e3,resource_id:E.resource_id,enabled:E.enabled}),_(!0)},Pe=()=>i().length?s().driver_type==="modbus_rtu"?i().filter(E=>E.type==="serial"):s().driver_type==="modbus_tcp"?i().filter(E=>E.type==="net"):i():[];return(()=>{var E=pn();return r(E,m(se,{title:"设备列表",get extra(){return(()=>{var T=gn(),q=T.firstChild,Q=q.nextSibling,A=Q.nextSibling;return q.$$input=I=>u(I.target.value),Q.$$click=W,A.$$click=pe,v(()=>q.value=d()),T})()},get children(){return V(()=>!!n())()?$n():V(()=>!!o())()?(()=>{var T=bn();return r(T,o),T})():(()=>{var T=_n(),q=T.firstChild,Q=q.firstChild,A=Q.nextSibling;return r(A,m(le,{get each(){return U()},children:I=>(()=>{var ie=mn(),ge=ie.firstChild,ke=ge.nextSibling,$e=ke.nextSibling,_e=$e.firstChild,Me=_e.nextSibling,Ee=$e.nextSibling,me=Ee.nextSibling,Le=me.nextSibling,J=Le.nextSibling,xe=J.nextSibling,Oe=xe.firstChild,ct=xe.nextSibling,Qe=ct.firstChild,je=Qe.nextSibling,Te=je.nextSibling,dt=Te.nextSibling;return r(ge,()=>I.id),r(ke,()=>I.name),r(_e,()=>I.product_key||"-"),r(Me,()=>I.device_key||""),r(Ee,()=>I.driver_type),r(me,()=>I.driver_name||(I.driver_id?`驱动 #${I.driver_id}`:"-")),r(Le,(()=>{var fe=V(()=>!!I.resource_name);return()=>fe()?(()=>{var he=xn(),ye=he.firstChild,ut=ye.nextSibling;return r(ye,()=>I.resource_name),r(ut,()=>I.resource_path),he})():yn()})()),r(J,()=>I.collect_interval),r(Oe,()=>I.enabled===1?"采集中":"停止"),Qe.$$click=()=>Ce(I),je.$$click=()=>P(I),Te.$$click=()=>ee(I.id),r(Te,()=>I.enabled===1?"停止":"启动"),dt.$$click=()=>K(I.id),v(fe=>{var he=`badge ${I.enabled===1?"badge-running":"badge-stopped"}`,ye=`btn ${I.enabled===1?"btn-danger":"btn-success"}`;return he!==fe.e&&ce(Oe,fe.e=he),ye!==fe.t&&ce(Te,fe.t=ye),fe},{e:void 0,t:void 0}),ie})()}),null),r(A,m(X,{get when(){return U().length===0},get children(){return vn()}}),null),T})()}}),null),r(E,m(X,{get when(){return L()},get children(){var T=dn(),q=T.firstChild,Q=q.firstChild,A=Q.firstChild,I=A.nextSibling,ie=Q.nextSibling,ge=ie.firstChild,ke=ge.firstChild,$e=ke.firstChild,_e=$e.nextSibling,Me=ke.nextSibling,Ee=Me.firstChild,me=Ee.nextSibling,Le=ge.nextSibling,J=Le.firstChild,xe=J.firstChild,Oe=xe.nextSibling,ct=J.nextSibling,Qe=ct.firstChild,je=Qe.nextSibling,Te=Le.nextSibling,dt=Te.firstChild,fe=dt.nextSibling,he=Te.nextSibling,ye=he.firstChild,ut=ye.firstChild,mt=ut.nextSibling,xt=ye.nextSibling,Qt=xt.firstChild,yt=Qt.nextSibling,Xt=xt.nextSibling,Yt=Xt.firstChild,wt=Yt.nextSibling,St=he.nextSibling,Zt=St.firstChild,Xe=Zt.nextSibling;Xe.firstChild;var el=St.nextSibling,ft=el.firstChild,Ct=ft.nextSibling;T.$$click=D=>{D.target===D.currentTarget&&_(!1)};var kt=F;return typeof kt=="function"?Kt(kt,T):F=T,r(A,()=>b()?"编辑设备":"新增设备"),I.$$click=()=>{_(!1),y(null),x(Be)},ie.addEventListener("submit",G),_e.$$input=D=>x({...s(),name:D.target.value}),me.$$input=D=>x({...s(),description:D.target.value}),Oe.$$input=D=>x({...s(),product_key:D.target.value}),je.$$input=D=>x({...s(),device_key:D.target.value}),fe.addEventListener("change",D=>x({...s(),driver_type:D.target.value,resource_id:null})),r(ie,m(X,{get when(){return s().driver_type==="modbus_rtu"},get children(){var D=on(),ae=D.firstChild,De=ae.firstChild,Re=De.nextSibling,Ye=ae.nextSibling,ht=Ye.firstChild,We=ht.nextSibling,Ne=Ye.nextSibling,tl=Ne.firstChild,Et=tl.nextSibling,Lt=Ne.nextSibling,ll=Lt.firstChild,Tt=ll.nextSibling,nl=Lt.nextSibling,il=nl.firstChild,At=il.nextSibling;return Re.$$input=be=>x({...s(),serial_port:be.target.value}),We.$$input=be=>x({...s(),baud_rate:+be.target.value}),Et.addEventListener("change",be=>x({...s(),parity:be.target.value})),Tt.$$input=be=>x({...s(),data_bits:+be.target.value}),At.$$input=be=>x({...s(),stop_bits:+be.target.value}),v(()=>Re.value=s().serial_port),v(()=>We.value=s().baud_rate),v(()=>Et.value=s().parity),v(()=>Tt.value=s().data_bits),v(()=>At.value=s().stop_bits),D}}),he),r(ie,m(X,{get when(){return s().driver_type==="modbus_tcp"},get children(){var D=cn(),ae=D.firstChild,De=ae.firstChild,Re=De.nextSibling,Ye=ae.nextSibling,ht=Ye.firstChild,We=ht.nextSibling;return Re.$$input=Ne=>x({...s(),ip_address:Ne.target.value}),We.$$input=Ne=>x({...s(),port_num:+Ne.target.value}),v(()=>Re.value=s().ip_address),v(()=>We.value=s().port_num),D}}),he),mt.$$input=D=>x({...s(),device_address:D.target.value}),yt.$$input=D=>x({...s(),collect_interval:+D.target.value}),wt.$$input=D=>x({...s(),timeout:+D.target.value}),Xe.addEventListener("change",D=>x({...s(),resource_id:D.target.value?Number(D.target.value):null})),r(Xe,()=>Pe().map(D=>(()=>{var ae=Pt();return r(ae,()=>`${D.name} (${D.path})`),v(()=>oe(ae,"key",D.id)),v(()=>ae.value=D.id),ae})()),null),ft.$$click=()=>{_(!1),y(null),x(Be)},r(Ct,(()=>{var D=V(()=>!!p());return()=>D()?"保存中...":b()?"保存":"创建"})()),v(D=>{var ae=p(),De=p();return ae!==D.e&&(ft.disabled=D.e=ae),De!==D.t&&(Ct.disabled=D.t=De),D},{e:void 0,t:void 0}),v(()=>_e.value=s().name),v(()=>me.value=s().description),v(()=>Oe.value=s().product_key),v(()=>je.value=s().device_key),v(()=>fe.value=s().driver_type),v(()=>mt.value=s().device_address),v(()=>yt.value=s().collect_interval),v(()=>wt.value=s().timeout),v(()=>Xe.value=s().resource_id??""),T}}),null),r(E,m(X,{get when(){return g()},get children(){var T=hn(),q=T.firstChild,Q=q.firstChild,A=Q.firstChild,I=A.nextSibling,ie=Q.nextSibling,ge=ie.firstChild,ke=ge.firstChild,$e=ke.nextSibling;$e.firstChild;var _e=ge.nextSibling,Me=_e.firstChild,Ee=Me.nextSibling,me=_e.nextSibling,Le=me.firstChild;return T.$$click=J=>{J.target===J.currentTarget&&C(!1)},I.$$click=()=>C(!1),ie.addEventListener("submit",ue),$e.addEventListener("change",J=>N({...M(),field:J.target.value})),r($e,m(le,{get each(){return S()},children:J=>(()=>{var xe=Pt();return r(xe,()=>J.label||J.field||J.name),v(()=>xe.value=J.field||J.name),xe})()}),null),r(ge,m(X,{get when(){return S().length===0},get children(){return un()}}),null),Ee.$$input=J=>N({...M(),value:J.target.value}),r(ie,m(X,{get when(){return j()},get children(){var J=fn();return r(J,j),J}}),me),Le.$$click=()=>C(!1),v(()=>$e.value=M().field),v(()=>Ee.value=M().value),T}}),null),E})()}ne(["click","input"]);function Sn(){return m(wn,{})}var Cn=h('<label class="btn btn-primary"style=cursor:pointer>上传驱动<input type=file accept=.wasm style=display:none>'),kn=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),En=h('<div style="color:var(--accent-red);padding:16px 0">'),Ln=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>文件</th><th>大小</th><th>操作</th></tr></thead><tbody>"),Tn=h('<tr><td></td><td></td><td></td><td></td><td class=flex style=gap:8px><a class=btn>下载</a><button class="btn btn-danger">删除'),An=h("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无驱动");function Dn(){const e=de(),[t,l]=w([]),[i,a]=w(!0),[n,c]=w(""),o=()=>{a(!0),Y("/api/drivers").then(u=>{l(u.data||u),c("")}).catch(()=>c("加载驱动失败")).finally(()=>a(!1))};Z(()=>{o()});const f=(u,s)=>{confirm(`删除驱动 ${s} ？`)&&Ie(`/api/drivers/${u}`).then(()=>{e.show("success","已删除"),o()}).catch(()=>e.show("error","删除失败"))},d=u=>{var b;const s=(b=u.target.files)==null?void 0:b[0];if(!s)return;const x=new FormData;x.append("file",s),wl("/api/drivers/upload",x).then(()=>{e.show("success","上传成功"),o()}).catch(()=>e.show("error","上传失败")).finally(()=>{u.target.value=""})};return m(se,{title:"驱动管理",get extra(){return(()=>{var u=Cn(),s=u.firstChild,x=s.nextSibling;return x.addEventListener("change",d),u})()},get children(){return V(()=>!!i())()?kn():V(()=>!!n())()?(()=>{var u=En();return r(u,n),u})():(()=>{var u=Ln(),s=u.firstChild,x=s.firstChild,b=x.nextSibling;return r(b,m(le,{get each(){return t()},children:y=>(()=>{var L=Tn(),_=L.firstChild,p=_.nextSibling,$=p.nextSibling,g=$.nextSibling,C=g.nextSibling,S=C.firstChild,k=S.nextSibling;return r(_,()=>y.id),r(p,()=>y.name),r($,()=>y.filename||y.file_path||""),r(g,(()=>{var M=V(()=>!!y.size);return()=>M()?(y.size/1024).toFixed(1)+" KB":"-"})()),k.$$click=()=>f(y.id,y.name),v(()=>oe(S,"href",`/api/drivers/${y.id}/download`)),L})()}),null),r(b,m(le,{get each(){return t().length===0?[1]:[]},children:()=>An()}),null),u})()}})}ne(["click"]);function Nn(){return m(Dn,{})}var qn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:480px;max-width:90vw><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input placeholder=配置名称 required></div><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=http>HTTP</option><option value=mqtt>MQTT</option><option value=xunji>寻迹</option></select></div><div class=form-group><label class=form-label>上传间隔 (ms)</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>配置 (JSON)</label><textarea class=form-input rows=5 placeholder="{ &quot;url&quot;: &quot;http://...&quot;, &quot;method&quot;: &quot;POST&quot; }"style=font-family:monospace;font-size:13px></textarea></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),In=h("<div>"),Pn=h('<button class="btn btn-primary">新增配置'),Mn=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),On=h("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置"),jn=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>上传间隔(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Rn=h('<tr><td></td><td></td><td><span class="badge badge-info"></span></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const Fe={name:"",type:"http",upload_interval:5e3,config:"{}",enabled:1};function Wn(){const e=de(),[t,l]=w([]),[i,a]=w(!0),[n,c]=w(Fe),[o,f]=w(null),[d,u]=w(!1),[s,x]=w(!1),b=()=>{a(!0),Y("/api/northbound").then(g=>l(g.data||g)).catch(()=>e.show("error","加载北向配置失败")).finally(()=>a(!1))};Z(()=>{b()});const y=g=>{g.preventDefault(),x(!0),(o()?ot(`/api/northbound/${o()}`,n()):re("/api/northbound",n())).then(()=>{e.show("success",o()?"已更新":"已创建"),c(Fe),f(null),u(!1),b()}).catch(()=>e.show("error","操作失败")).finally(()=>x(!1))},L=(g,C)=>{re(`/api/northbound/${g}/toggle`,{}).then(b).catch(()=>e.show("error","切换失败"))},_=g=>{confirm("删除该配置？")&&Ie(`/api/northbound/${g}`).then(()=>{e.show("success","已删除"),b()}).catch(()=>e.show("error","删除失败"))},p=()=>{c(Fe),f(null),u(!0)},$=g=>{f(g.id),c({name:g.name,type:g.type,upload_interval:g.upload_interval,config:g.config,enabled:g.enabled}),u(!0)};return(()=>{var g=In();return r(g,m(se,{title:"北向配置列表",get extra(){return(()=>{var C=Pn();return C.$$click=p,C})()},get children(){return V(()=>!!i())()?Mn():(()=>{var C=jn(),S=C.firstChild,k=S.firstChild,M=k.nextSibling;return r(M,m(le,{get each(){return t()},children:N=>(()=>{var j=Rn(),O=j.firstChild,R=O.nextSibling,B=R.nextSibling,F=B.firstChild,W=B.nextSibling,U=W.nextSibling,G=U.firstChild,ee=U.nextSibling,K=ee.firstChild,P=K.nextSibling,ue=P.nextSibling;return r(O,()=>N.id),r(R,()=>N.name),r(F,()=>N.type.toUpperCase()),r(W,()=>N.upload_interval),r(G,()=>N.enabled===1?"启用":"禁用"),K.$$click=()=>$(N),P.$$click=()=>L(N.id,N.enabled===1),r(P,()=>N.enabled===1?"禁用":"启用"),ue.$$click=()=>_(N.id),v(()=>ce(G,`badge ${N.enabled===1?"badge-running":"badge-stopped"}`)),j})()}),null),r(M,m(X,{get when(){return t().length===0},get children(){return On()}}),null),C})()}}),null),r(g,m(X,{get when(){return d()},get children(){var C=qn(),S=C.firstChild,k=S.firstChild,M=k.firstChild,N=M.nextSibling,j=k.nextSibling,O=j.firstChild,R=O.firstChild,B=R.nextSibling,F=O.nextSibling,W=F.firstChild,U=W.firstChild,G=U.nextSibling,ee=W.nextSibling,K=ee.firstChild,P=K.nextSibling,ue=F.nextSibling,pe=ue.firstChild,Ce=pe.nextSibling,Pe=ue.nextSibling,E=Pe.firstChild,T=E.nextSibling;return r(M,()=>o()?"编辑北向配置":"新增北向配置"),N.$$click=()=>{u(!1),f(null),c(Fe)},j.addEventListener("submit",y),B.$$input=q=>c({...n(),name:q.target.value}),G.addEventListener("change",q=>c({...n(),type:q.target.value})),P.$$input=q=>c({...n(),upload_interval:+q.target.value}),Ce.$$input=q=>c({...n(),config:q.target.value}),E.$$click=()=>{u(!1),f(null),c(Fe)},r(T,(()=>{var q=V(()=>!!s());return()=>q()?"保存中...":o()?"保存":"创建"})()),v(q=>{var Q=s(),A=s();return Q!==q.e&&(E.disabled=q.e=Q),A!==q.t&&(T.disabled=q.t=A),q},{e:void 0,t:void 0}),v(()=>B.value=n().name),v(()=>G.value=n().type),v(()=>P.value=n().upload_interval),v(()=>Ce.value=n().config),C}}),null),g})()}ne(["click","input"]);function Bn(){return m(Wn,{})}var Fn=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>设备</th><th>字段</th><th>条件</th><th>严重性</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Un=h('<div style="color:var(--accent-red);padding:4px 0">'),Gn=h('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:440px;max-width:92vw><div class=card-header><h3 class=card-title>新增阈值</h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>设备</label><select class=form-select required><option value>选择设备</option></select></div><div class=form-group><label class=form-label>字段名</label><input class=form-input required></div><div class=grid style="gridTemplateColumns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>运算符</label><select class=form-select><option value=">">大于 &gt;</option><option value=">=">大于等于 &gt;=</option><option value="<">小于 &lt;</option><option value="<=">小于等于 &lt;=</option><option value="==">等于 ==</option></select></div><div class=form-group><label class=form-label>阈值</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>严重程度</label><select class=form-select><option value=info>info</option><option value=warning>warning</option><option value=error>error</option><option value=critical>critical</option></select></div><div class=form-group><label class=form-label>报警消息</label><input class=form-input></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),Kn=h("<div>"),Vn=h('<button class="btn btn-primary">新增阈值'),Jn=h('<tr><td></td><td></td><td></td><td> </td><td></td><td><span></span></td><td><button class="btn btn-danger">删除'),Hn=h("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无阈值"),zn=h("<option>");const et={device_id:"",field_name:"",operator:">",value:0,severity:"warning",message:"",enabled:1};function Qn(){const e=de(),[t,l]=w([]),[i,a]=w([]),[n,c]=w(et),[o,f]=w(!1),[d,u]=w(!1),[s,x]=w(""),b=()=>{Y("/api/thresholds").then(p=>l(p.data||p)).catch(()=>e.show("error","加载阈值失败"))},y=()=>{Y("/api/devices").then(p=>a(p.data||p)).catch(()=>{})};Z(()=>{b(),y()}),Z(()=>{if(!o())return;const p=$=>{$.key==="Escape"&&f(!1)};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)});const L=p=>{p.preventDefault(),u(!0),x(""),re("/api/thresholds",n()).then(()=>{e.show("success","阈值已创建"),c(et),f(!1),b()}).catch($=>{x($.message||"创建失败"),e.show("error","创建失败")}).finally(()=>u(!1))},_=p=>{confirm("删除该阈值？")&&Ie(`/api/thresholds/${p}`).then(()=>{e.show("success","已删除"),b()}).catch(()=>e.show("error","删除失败"))};return(()=>{var p=Kn();return r(p,m(se,{title:"阈值配置列表",get extra(){return(()=>{var $=Vn();return $.$$click=()=>{c(et),x(""),f(!0)},$})()},get children(){var $=Fn(),g=$.firstChild,C=g.firstChild,S=C.nextSibling;return r(S,m(le,{get each(){return t()},children:k=>(()=>{var M=Jn(),N=M.firstChild,j=N.nextSibling,O=j.nextSibling,R=O.nextSibling,B=R.firstChild,F=R.nextSibling,W=F.nextSibling,U=W.firstChild,G=W.nextSibling,ee=G.firstChild;return r(N,()=>k.id),r(j,()=>k.device_id),r(O,()=>k.field_name),r(R,()=>k.operator,B),r(R,()=>k.value,null),r(F,()=>k.severity),r(U,()=>k.enabled===1?"启用":"禁用"),ee.$$click=()=>_(k.id),v(()=>ce(U,`badge ${k.enabled===1?"badge-running":"badge-stopped"}`)),M})()}),null),r(S,m(le,{get each(){return t().length===0?[1]:[]},children:()=>Hn()}),null),$}}),null),r(p,m(X,{get when(){return o()},get children(){var $=Gn(),g=$.firstChild,C=g.firstChild,S=C.nextSibling,k=S.firstChild,M=k.firstChild,N=M.nextSibling;N.firstChild;var j=k.nextSibling,O=j.firstChild,R=O.nextSibling,B=j.nextSibling,F=B.firstChild,W=F.firstChild,U=W.nextSibling,G=F.nextSibling,ee=G.firstChild,K=ee.nextSibling,P=B.nextSibling,ue=P.firstChild,pe=ue.nextSibling,Ce=P.nextSibling,Pe=Ce.firstChild,E=Pe.nextSibling,T=Ce.nextSibling,q=T.firstChild,Q=q.nextSibling;return $.$$click=A=>{A.target===A.currentTarget&&f(!1)},S.addEventListener("submit",L),N.addEventListener("change",A=>c({...n(),device_id:+A.target.value})),r(N,()=>i().map(A=>(()=>{var I=zn();return r(I,()=>A.name||A.id),v(()=>oe(I,"key",A.id)),v(()=>I.value=A.id),I})()),null),R.$$input=A=>c({...n(),field_name:A.target.value}),U.addEventListener("change",A=>c({...n(),operator:A.target.value})),K.$$input=A=>c({...n(),value:+A.target.value}),pe.addEventListener("change",A=>c({...n(),severity:A.target.value})),E.$$input=A=>c({...n(),message:A.target.value}),r(S,m(X,{get when(){return s()},get children(){var A=Un();return r(A,s),A}}),T),q.$$click=()=>{f(!1),c(et)},r(Q,()=>d()?"创建中...":"创建"),v(A=>{var I=d(),ie=d();return I!==A.e&&(q.disabled=A.e=I),ie!==A.t&&(Q.disabled=A.t=ie),A},{e:void 0,t:void 0}),v(()=>N.value=n().device_id),v(()=>R.value=n().field_name),v(()=>U.value=n().operator),v(()=>K.value=n().value),v(()=>pe.value=n().severity),v(()=>E.value=n().message),$}}),null),p})()}ne(["click","input"]);function Xn(){return m(Qn,{})}var Yn=h("<div class=table-container style=max-height:600px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备ID</th><th>字段</th><th>实际值</th><th>阈值条件</th><th>级别</th><th>消息</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Zn=h("<button class=btn>刷新"),ei=h("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td></td><td></td><td>"),ti=h('<span class="text-muted text-xs">已确认'),li=h("<span class=text-warning>未确认"),ni=h('<button class="btn btn-primary btn-sm">确认'),ii=h("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无告警");function ri(){const e=de(),[t,l]=w([]),i=()=>{Y("/api/alarms").then(n=>l(n.data||n)).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const a=n=>{re(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return m(se,{title:"报警日志",get extra(){return(()=>{var n=Zn();return n.$$click=i,n})()},get children(){var n=Yn(),c=n.firstChild,o=c.firstChild,f=o.nextSibling;return r(f,m(le,{get each(){return t()},children:d=>(()=>{var u=ei(),s=u.firstChild,x=s.nextSibling,b=x.nextSibling,y=b.nextSibling,L=y.nextSibling,_=L.nextSibling,p=_.firstChild,$=_.nextSibling,g=$.nextSibling,C=g.nextSibling;return r(s,()=>{var S;return((S=d.triggered_at)==null?void 0:S.slice(5,19))||d.triggered_at}),r(x,()=>d.device_id),r(b,()=>d.field_name),r(y,()=>d.actual_value),r(L,()=>`${d.operator} ${d.threshold_value}`),r(p,()=>d.severity||"warn"),r($,()=>d.message||"-"),r(g,(()=>{var S=V(()=>d.acknowledged===1);return()=>S()?ti():li()})()),r(C,(()=>{var S=V(()=>d.acknowledged!==1);return()=>S()&&(()=>{var k=ni();return k.$$click=()=>a(d.id),k})()})()),v(()=>ce(p,`badge ${d.severity==="critical"?"badge-critical":"badge-running"}`)),u})()}),null),r(f,m(le,{get each(){return t().length===0?[1]:[]},children:()=>ii()}),null),n}})}ne(["click"]);var si=h("<select class=form-select>"),ai=h("<option>"),oi=h("<div style=padding:24px>加载中..."),ci=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),di=h("<tr><td></td><td></td><td></td><td>"),ui=h("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无数据");function fi(){const e=de(),[t,l]=w([]),[i,a]=w(""),[n,c]=w([]),[o,f]=w(!1);return Z(()=>{Y("/api/devices").then(d=>{const u=d.data||d;l(u),u.length&&a(String(u[0].id))}).catch(()=>e.show("error","加载设备失败"))}),Z(()=>{i()&&(f(!0),Y(`/api/data/points/${i()}`).then(d=>c(d.data||d)).catch(()=>e.show("error","加载实时数据失败")).finally(()=>f(!1)))}),m(se,{title:"实时数据",get extra(){return(()=>{var d=si();return d.addEventListener("change",u=>a(u.target.value)),r(d,()=>t().map(u=>(()=>{var s=ai();return r(s,()=>u.name||u.id),v(()=>oe(s,"key",u.id)),v(()=>s.value=u.id),s})())),v(()=>d.value=i()),d})()},get children(){return V(()=>!!o())()?oi():(()=>{var d=ci(),u=d.firstChild,s=u.firstChild,x=s.nextSibling;return r(x,()=>n().map(b=>(()=>{var y=di(),L=y.firstChild,_=L.nextSibling,p=_.nextSibling,$=p.nextSibling;return r(L,()=>b.collected_at||b.CollectedAt||""),r(_,()=>b.device_name||""),r(p,()=>b.field_name||""),r($,()=>b.value),v(()=>oe(y,"key",b.id||`${b.device_id}-${b.collected_at}-${b.field_name}`)),y})()),null),r(x,(()=>{var b=V(()=>n().length===0);return()=>b()&&ui()})(),null),d})()}})}var hi=h('<div class="flex gap-3"><select class=form-select><option value>全部设备</option></select><button class=btn>刷新'),pi=h("<option>"),gi=h("<div style=padding:24px>加载中..."),$i=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),bi=h("<tr><td></td><td></td><td></td><td>"),vi=h("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无历史数据");function _i(){const e=de(),[t,l]=w(""),[i,a]=w([]),[n,c]=w(!1),[o,f]=w([]);Z(()=>{Y("/api/devices").then(u=>f(u.data||u)).catch(()=>{})});const d=()=>{c(!0);const u=t()?`/api/data/history?device_id=${t()}`:"/api/data/history";Y(u).then(s=>a(s.data||s)).catch(()=>e.show("error","加载历史数据失败")).finally(()=>c(!1))};return Z(()=>{d()}),m(se,{title:"历史数据",get extra(){return(()=>{var u=hi(),s=u.firstChild;s.firstChild;var x=s.nextSibling;return s.addEventListener("change",b=>l(b.target.value)),r(s,()=>o().map(b=>(()=>{var y=pi();return r(y,()=>b.name||b.id),v(()=>oe(y,"key",b.id)),v(()=>y.value=b.id),y})()),null),x.$$click=d,v(()=>s.value=t()),u})()},get children(){return V(()=>!!n())()?gi():(()=>{var u=$i(),s=u.firstChild,x=s.firstChild,b=x.nextSibling;return r(b,()=>i().map(y=>(()=>{var L=bi(),_=L.firstChild,p=_.nextSibling,$=p.nextSibling,g=$.nextSibling;return r(_,()=>{var C;return((C=y.collected_at)==null?void 0:C.slice(0,19))||y.CollectedAt}),r(p,()=>y.device_name||y.DeviceName),r($,()=>y.field_name||y.FieldName),r(g,()=>y.value||y.Value),v(()=>oe(L,"key",y.id)),L})()),null),r(b,(()=>{var y=V(()=>i().length===0);return()=>y()&&vi()})(),null),u})()}})}ne(["click"]);var mi=h('<form class=form><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>产品Key (可选)</label><input class=form-input></div><div class=form-group><label class=form-label>设备Key (可选)</label><input class=form-input></div></div><div class=form-group><label class=form-label>保留天数</label><input class=form-input type=number required></div><div class=flex style=gap:12px;margin-top:12px><button class="btn btn-primary"type=submit style=flex:1></button><button class=btn type=button style=flex:1>重置'),xi=h('<div class=grid style="grid-template-columns:3fr 1.4fr;gap:24px">'),yi=h("<button class=btn>立即清理"),wi=h('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Si=h("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>产品Key</th><th>设备Key</th><th>保留天数</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Ci=h('<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class="btn btn-danger">删除'),ki=h("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置");const gt={name:"",product_key:"",device_key:"",storage_days:30,enabled:1};function Ei(){const e=de(),[t,l]=w([]),[i,a]=w(!0),[n,c]=w(gt),[o,f]=w(null),[d,u]=w(!1),s=()=>{a(!0),Y("/api/storage").then(_=>l(_.data||_)).catch(()=>e.show("error","加载存储配置失败")).finally(()=>a(!1))};Z(()=>{s()});const x=_=>{_.preventDefault(),u(!0),(o()?ot(`/api/storage/${o()}`,n()):re("/api/storage",n())).then(()=>{e.show("success",o()?"已更新":"已创建"),c(gt),f(null),s()}).catch(()=>e.show("error","操作失败")).finally(()=>u(!1))},b=_=>{confirm("删除该配置？")&&Ie(`/api/storage/${_}`).then(()=>{e.show("success","已删除"),s()}).catch(()=>e.show("error","删除失败"))},y=_=>{f(_.id),c({name:_.name,product_key:_.product_key||"",device_key:_.device_key||"",storage_days:_.storage_days,enabled:_.enabled})},L=()=>{re("/api/storage/run",{}).then(_=>e.show("success",`清理完成，删除 ${_.deleted_count} 条记录`)).catch(()=>e.show("error","清理失败"))};return(()=>{var _=xi();return r(_,m(se,{title:"存储策略列表",get extra(){return(()=>{var p=yi();return p.$$click=L,p})()},get children(){return V(()=>!!i())()?wi():(()=>{var p=Si(),$=p.firstChild,g=$.firstChild,C=g.nextSibling;return r(C,m(le,{get each(){return t()},children:S=>(()=>{var k=Ci(),M=k.firstChild,N=M.nextSibling,j=N.nextSibling,O=j.nextSibling,R=O.nextSibling,B=R.nextSibling,F=B.firstChild,W=B.nextSibling,U=W.firstChild,G=U.nextSibling;return r(M,()=>S.id),r(N,()=>S.name),r(j,()=>S.product_key||"-"),r(O,()=>S.device_key||"-"),r(R,()=>S.storage_days),r(F,()=>S.enabled===1?"启用":"禁用"),U.$$click=()=>y(S),G.$$click=()=>b(S.id),v(()=>ce(F,`badge ${S.enabled===1?"badge-running":"badge-stopped"}`)),k})()}),null),r(C,m(le,{get each(){return t().length===0?[1]:[]},children:()=>ki()}),null),p})()}}),null),r(_,m(se,{get title(){return o()?"编辑存储策略":"新增存储策略"},get children(){var p=mi(),$=p.firstChild,g=$.firstChild,C=g.nextSibling,S=$.nextSibling,k=S.firstChild,M=k.firstChild,N=M.nextSibling,j=k.nextSibling,O=j.firstChild,R=O.nextSibling,B=S.nextSibling,F=B.firstChild,W=F.nextSibling,U=B.nextSibling,G=U.firstChild,ee=G.nextSibling;return p.addEventListener("submit",x),C.$$input=K=>c({...n(),name:K.target.value}),N.$$input=K=>c({...n(),product_key:K.target.value}),R.$$input=K=>c({...n(),device_key:K.target.value}),W.$$input=K=>c({...n(),storage_days:+K.target.value}),r(G,(()=>{var K=V(()=>!!d());return()=>K()?"保存中...":o()?"保存":"创建"})()),ee.$$click=()=>{c(gt),f(null)},v(()=>G.disabled=d()),v(()=>C.value=n().name),v(()=>N.value=n().product_key),v(()=>R.value=n().device_key),v(()=>W.value=n().storage_days),p}}),null),_})()}ne(["input","click"]);function Li(){return m(Ei,{})}var Ti=h("<div><main class=container style=padding-top:32px;padding-bottom:32px></main><div id=toast-container class=toast-container>");function Ai(){const[e,t]=_l(),[l,i]=w(!0);Z(()=>{e()!=="/login"&&Y("/api/status").then(()=>i(!0)).catch(()=>{i(!1),zt("/login")})});const a=()=>{const n=e();switch(!0){case n==="/login":return m(Yl,{onSuccess:()=>t("/")});case n==="/":return m(It,{});case n.startsWith("/resources"):return m(an,{});case n.startsWith("/devices"):return m(Sn,{});case n.startsWith("/drivers"):return m(Nn,{});case n.startsWith("/northbound"):return m(Bn,{});case n.startsWith("/storage"):return m(Li,{});case n.startsWith("/thresholds"):return m(Xn,{});case n.startsWith("/alarms"):return m(ri,{});case n.startsWith("/realtime"):return m(fi,{});case n.startsWith("/history"):return m(_i,{});default:return m(It,{})}};return(()=>{var n=Ti(),c=n.firstChild;return r(n,m(X,{get when(){return e()!=="/login"},get children(){return m(Al,{get path(){return e()},onNav:t})}}),c),r(c,a),n})()}const Mt=document.getElementById("app-root");Mt&&Gt(()=>m(Ai,{}),Mt);const Di={};typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-solid-island]").forEach(e=>{const t=e.getAttribute("data-solid-island"),l=Di[t];if(!l)return;const i=e.dataset.props?JSON.parse(e.dataset.props):{};Gt(()=>m(l,i),e)})});
