const nl=(e,t)=>e===t,il=Symbol("solid-track"),Ze={equals:nl};let Nt=Ot;const we=1,et=2,qt={owned:null,cleanups:null,context:null,owner:null};var Q=null;let at=null,rl=null,J=null,ne=null,$e=null,it=0;function Ye(e,t){const l=J,i=Q,s=e.length===0,n=t===void 0?i:t,o=s?qt:{owned:null,cleanups:null,context:n?n.context:null,owner:n},a=s?e:()=>e(()=>Te(()=>Fe(o)));Q=o,J=null;try{return Ue(a,!0)}finally{J=l,Q=i}}function y(e,t){t=t?Object.assign({},Ze,t):Ze;const l={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=s=>(typeof s=="function"&&(s=s(l.value)),Pt(l,s));return[It.bind(l),i]}function m(e,t,l){const i=dt(e,t,!1,we);Re(i)}function Z(e,t,l){Nt=ol;const i=dt(e,t,!1,we);i.user=!0,$e?$e.push(i):Re(i)}function We(e,t,l){l=l?Object.assign({},Ze,l):Ze;const i=dt(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=l.equals||void 0,Re(i),It.bind(i)}function Te(e){if(J===null)return e();const t=J;J=null;try{return e()}finally{J=t}}function Be(e){return Q===null||(Q.cleanups===null?Q.cleanups=[e]:Q.cleanups.push(e)),e}function It(){if(this.sources&&this.state)if(this.state===we)Re(this);else{const e=ne;ne=null,Ue(()=>lt(this),!1),ne=e}if(J){const e=this.observers?this.observers.length:0;J.sources?(J.sources.push(this),J.sourceSlots.push(e)):(J.sources=[this],J.sourceSlots=[e]),this.observers?(this.observers.push(J),this.observerSlots.push(J.sources.length-1)):(this.observers=[J],this.observerSlots=[J.sources.length-1])}return this.value}function Pt(e,t,l){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&Ue(()=>{for(let s=0;s<e.observers.length;s+=1){const n=e.observers[s],o=at&&at.running;o&&at.disposed.has(n),(o?!n.tState:!n.state)&&(n.pure?ne.push(n):$e.push(n),n.observers&&Mt(n)),o||(n.state=we)}if(ne.length>1e6)throw ne=[],new Error},!1)),t}function Re(e){if(!e.fn)return;Fe(e);const t=it;sl(e,e.value,t)}function sl(e,t,l){let i;const s=Q,n=J;J=Q=e;try{i=e.fn(t)}catch(o){return e.pure&&(e.state=we,e.owned&&e.owned.forEach(Fe),e.owned=null),e.updatedAt=l+1,jt(o)}finally{J=n,Q=s}(!e.updatedAt||e.updatedAt<=l)&&(e.updatedAt!=null&&"observers"in e?Pt(e,i):e.value=i,e.updatedAt=l)}function dt(e,t,l,i=we,s){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Q,context:Q?Q.context:null,pure:l};return Q===null||Q!==qt&&(Q.owned?Q.owned.push(n):Q.owned=[n]),n}function tt(e){if(e.state===0)return;if(e.state===et)return lt(e);if(e.suspense&&Te(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<it);)e.state&&t.push(e);for(let l=t.length-1;l>=0;l--)if(e=t[l],e.state===we)Re(e);else if(e.state===et){const i=ne;ne=null,Ue(()=>lt(e,t[0]),!1),ne=i}}function Ue(e,t){if(ne)return e();let l=!1;t||(ne=[]),$e?l=!0:$e=[],it++;try{const i=e();return al(l),i}catch(i){l||($e=null),ne=null,jt(i)}}function al(e){if(ne&&(Ot(ne),ne=null),e)return;const t=$e;$e=null,t.length&&Ue(()=>Nt(t),!1)}function Ot(e){for(let t=0;t<e.length;t++)tt(e[t])}function ol(e){let t,l=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[l++]=i:tt(i)}for(t=0;t<l;t++)tt(e[t])}function lt(e,t){e.state=0;for(let l=0;l<e.sources.length;l+=1){const i=e.sources[l];if(i.sources){const s=i.state;s===we?i!==t&&(!i.updatedAt||i.updatedAt<it)&&tt(i):s===et&&lt(i,t)}}}function Mt(e){for(let t=0;t<e.observers.length;t+=1){const l=e.observers[t];l.state||(l.state=et,l.pure?ne.push(l):$e.push(l),l.observers&&Mt(l))}}function Fe(e){let t;if(e.sources)for(;e.sources.length;){const l=e.sources.pop(),i=e.sourceSlots.pop(),s=l.observers;if(s&&s.length){const n=s.pop(),o=l.observerSlots.pop();i<s.length&&(n.sourceSlots[o]=i,s[i]=n,l.observerSlots[i]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Fe(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Fe(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function cl(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function jt(e,t=Q){throw cl(e)}const dl=Symbol("fallback");function Et(e){for(let t=0;t<e.length;t++)e[t]()}function ul(e,t,l={}){let i=[],s=[],n=[],o=0,a=t.length>1?[]:null;return Be(()=>Et(n)),()=>{let p=e()||[],u=p.length,h,c;return p[il],Te(()=>{let d,g,L,x,$,v,b,k,S;if(u===0)o!==0&&(Et(n),n=[],i=[],s=[],o=0,a&&(a=[])),l.fallback&&(i=[dl],s[0]=Ye(w=>(n[0]=w,l.fallback())),o=1);else if(o===0){for(s=new Array(u),c=0;c<u;c++)i[c]=p[c],s[c]=Ye(C);o=u}else{for(L=new Array(u),x=new Array(u),a&&($=new Array(u)),v=0,b=Math.min(o,u);v<b&&i[v]===p[v];v++);for(b=o-1,k=u-1;b>=v&&k>=v&&i[b]===p[k];b--,k--)L[k]=s[b],x[k]=n[b],a&&($[k]=a[b]);for(d=new Map,g=new Array(k+1),c=k;c>=v;c--)S=p[c],h=d.get(S),g[c]=h===void 0?-1:h,d.set(S,c);for(h=v;h<=b;h++)S=i[h],c=d.get(S),c!==void 0&&c!==-1?(L[c]=s[h],x[c]=n[h],a&&($[c]=a[h]),c=g[c],d.set(S,c)):n[h]();for(c=v;c<u;c++)c in L?(s[c]=L[c],n[c]=x[c],a&&(a[c]=$[c],a[c](c))):s[c]=Ye(C);s=s.slice(0,o=u),i=p.slice(0)}return s});function C(d){if(n[c]=d,a){const[g,L]=y(c);return a[c]=L,t(p[c],g)}return t(p[c])}}}function _(e,t){return Te(()=>e(t||{}))}const hl=e=>`Stale read from <${e}>.`;function X(e){const t="fallback"in e&&{fallback:()=>e.fallback};return We(ul(()=>e.each,e.children,t||void 0))}function R(e){const t=e.keyed,l=We(()=>e.when,void 0,void 0),i=t?l:We(l,void 0,{equals:(s,n)=>!s==!n});return We(()=>{const s=i();if(s){const n=e.children;return typeof n=="function"&&n.length>0?Te(()=>n(t?s:()=>{if(!Te(i))throw hl("Show");return l()})):n}return e.fallback},void 0,void 0)}const B=e=>We(()=>e());function fl(e,t,l){let i=l.length,s=t.length,n=i,o=0,a=0,p=t[s-1].nextSibling,u=null;for(;o<s||a<n;){if(t[o]===l[a]){o++,a++;continue}for(;t[s-1]===l[n-1];)s--,n--;if(s===o){const h=n<i?a?l[a-1].nextSibling:l[n-a]:p;for(;a<n;)e.insertBefore(l[a++],h)}else if(n===a)for(;o<s;)(!u||!u.has(t[o]))&&t[o].remove(),o++;else if(t[o]===l[n-1]&&l[a]===t[s-1]){const h=t[--s].nextSibling;e.insertBefore(l[a++],t[o++].nextSibling),e.insertBefore(l[--n],h),t[s]=l[n]}else{if(!u){u=new Map;let c=a;for(;c<n;)u.set(l[c],c++)}const h=u.get(t[o]);if(h!=null)if(a<h&&h<n){let c=o,C=1,d;for(;++c<s&&c<n&&!((d=u.get(t[c]))==null||d!==h+C);)C++;if(C>h-a){const g=t[o];for(;a<h;)e.insertBefore(l[a++],g)}else e.replaceChild(l[a++],t[o++])}else o++;else t[o++].remove()}}}const Lt="_$DX_DELEGATE";function Wt(e,t,l,i={}){let s;return Ye(n=>{s=n,t===document?e():r(t,e(),t.firstChild?null:void 0,l)},i.owner),()=>{s(),t.textContent=""}}function f(e,t,l,i){let s;const n=()=>{const a=document.createElement("template");return a.innerHTML=e,a.content.firstChild},o=()=>(s||(s=n())).cloneNode(!0);return o.cloneNode=o,o}function re(e,t=window.document){const l=t[Lt]||(t[Lt]=new Set);for(let i=0,s=e.length;i<s;i++){const n=e[i];l.has(n)||(l.add(n),t.addEventListener(n,$l))}}function de(e,t,l){l==null?e.removeAttribute(t):e.setAttribute(t,l)}function fe(e,t){t==null?e.removeAttribute("class"):e.className=t}function pl(e,t,l){if(!t)return l?de(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof l=="string"&&(i.cssText=l=void 0),l||(l={}),t||(t={});let s,n;for(n in l)t[n]==null&&i.removeProperty(n),delete l[n];for(n in t)s=t[n],s!==l[n]&&(i.setProperty(n,s),l[n]=s);return l}function gl(e,t,l){return Te(()=>e(t,l))}function r(e,t,l,i){if(l!==void 0&&!i&&(i=[]),typeof t!="function")return nt(e,t,i,l);m(s=>nt(e,t(),s,l),i)}function $l(e){let t=e.target;const l=`$$${e.type}`,i=e.target,s=e.currentTarget,n=p=>Object.defineProperty(e,"target",{configurable:!0,value:p}),o=()=>{const p=t[l];if(p&&!t.disabled){const u=t[`${l}Data`];if(u!==void 0?p.call(t,u,e):p.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},a=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const p=e.composedPath();n(p[0]);for(let u=0;u<p.length-2&&(t=p[u],!!o());u++){if(t._$host){t=t._$host,a();break}if(t.parentNode===s)break}}else a();n(i)}function nt(e,t,l,i,s){for(;typeof l=="function";)l=l();if(t===l)return l;const n=typeof t,o=i!==void 0;if(e=o&&l[0]&&l[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===l))return l;if(o){let a=l[0];a&&a.nodeType===3?a.data!==t&&(a.data=t):a=document.createTextNode(t),l=qe(e,l,i,a)}else l!==""&&typeof l=="string"?l=e.firstChild.data=t:l=e.textContent=t}else if(t==null||n==="boolean")l=qe(e,l,i);else{if(n==="function")return m(()=>{let a=t();for(;typeof a=="function";)a=a();l=nt(e,a,l,i)}),()=>l;if(Array.isArray(t)){const a=[],p=l&&Array.isArray(l);if(ct(a,t,l,s))return m(()=>l=nt(e,a,l,i,!0)),()=>l;if(a.length===0){if(l=qe(e,l,i),o)return l}else p?l.length===0?Tt(e,a,i):fl(e,l,a):(l&&qe(e),Tt(e,a));l=a}else if(t.nodeType){if(Array.isArray(l)){if(o)return l=qe(e,l,i,t);qe(e,l,null,t)}else l==null||l===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);l=t}}return l}function ct(e,t,l,i){let s=!1;for(let n=0,o=t.length;n<o;n++){let a=t[n],p=l&&l[e.length],u;if(!(a==null||a===!0||a===!1))if((u=typeof a)=="object"&&a.nodeType)e.push(a);else if(Array.isArray(a))s=ct(e,a,p)||s;else if(u==="function")if(i){for(;typeof a=="function";)a=a();s=ct(e,Array.isArray(a)?a:[a],Array.isArray(p)?p:[p])||s}else e.push(a),s=!0;else{const h=String(a);p&&p.nodeType===3&&p.data===h?e.push(p):e.push(document.createTextNode(h))}}return s}function Tt(e,t,l=null){for(let i=0,s=t.length;i<s;i++)e.insertBefore(t[i],l)}function qe(e,t,l,i){if(l===void 0)return e.textContent="";const s=i||document.createTextNode("");if(t.length){let n=!1;for(let o=t.length-1;o>=0;o--){const a=t[o];if(s!==a){const p=a.parentNode===e;!n&&!o?p?e.replaceChild(s,a):e.insertBefore(s,l):p&&a.remove()}else n=!0}}else e.insertBefore(s,l);return[s]}const[Ft,Bt]=y(window.location.pathname||"/"),[vl,Rt]=y(new URLSearchParams(window.location.search));if(typeof window<"u"){const e=()=>{Bt(window.location.pathname||"/"),Rt(new URLSearchParams(window.location.search))};window.addEventListener("popstate",e),Be(()=>window.removeEventListener("popstate",e))}function Ut(e,t={}){const l=Ft();e!==l&&(t.replace?window.history.replaceState({},"",e):window.history.pushState({},"",e),Bt(e),Rt(new URLSearchParams(window.location.search)),window.scrollTo({top:0,behavior:"smooth"}))}function bl(){return[Ft,Ut,vl]}function ye(e,t){return t==="/"?e==="/":String(e).startsWith(t)}const ut="gogw_jwt";function _l(){return localStorage.getItem(ut)||""}function ht(e={}){const t=_l();return t?{...e,Authorization:`Bearer ${t}`}:e}function ml(e){if(e.status===401)throw localStorage.removeItem(ut),window.location.href="/login",new Error("unauthorized")}async function Ge(e,t={}){const l=await fetch(e,{credentials:"same-origin",headers:ht(t.headers),...t});return ml(l),l}async function Ke(e){if(e.status===204)return null;const t=await e.text();if(!t)return null;try{const l=JSON.parse(t);if(l&&typeof l=="object"&&"success"in l){if(l.success)return l.data??null;const i=l.error||l.message||"request failed";throw new Error(i)}return l}catch{throw new Error("invalid json")}}function xl(e){e&&localStorage.setItem(ut,e)}async function Y(e,t={}){const l=await Ge(e,t);if(!l.ok)throw new Error(`${l.status} ${l.statusText}`);return Ke(l)}async function ae(e,t,l={}){const i=await Ge(e,{method:"POST",headers:ht({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ke(i)}async function He(e,t,l={}){const i=await Ge(e,{method:"PUT",headers:ht({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ke(i)}async function Ie(e){const t=await Ge(e,{method:"DELETE"});if(!t.ok&&t.status!==204)throw new Error(`${t.status} ${t.statusText}`);return t.status===204?null:Ke(t)}async function yl(e,t,l={}){const i=await Ge(e,{method:"POST",body:t,...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ke(i)}var wl=f("<div class=dropdown-menu>"),Sl=f('<nav class=nav><div class="container nav-inner"><div class=nav-brand><svg class=nav-brand-icon viewBox="0 0 48 48"fill=none xmlns=http://www.w3.org/2000/svg><defs><linearGradient id=brandGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#3b82f6></stop><stop offset=100% style=stop-color:#8b5cf6></stop></linearGradient><linearGradient id=chipGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#06b6d4></stop><stop offset=100% style=stop-color:#22d3ee></stop></linearGradient></defs><rect x=4 y=4 width=40 height=40 rx=10 fill=url(#brandGradient) opacity=0.15></rect><rect x=4 y=4 width=40 height=40 rx=10 stroke=url(#brandGradient) stroke-width=2></rect><rect x=14 y=14 width=20 height=20 rx=4 fill=url(#chipGradient) opacity=0.9></rect><circle cx=18 cy=18 r=2 fill=white opacity=0.9></circle><circle cx=18 cy=30 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=18 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=30 r=2 fill=white opacity=0.9></circle><path d="M24 10V14M24 34V38M10 24H14M34 24H38"stroke=url(#brandGradient) stroke-width=2 stroke-linecap=round></path></svg><div class=nav-brand-text><div class=nav-title><span class=brand-hu>Hu</span><span class=brand-shu>Shu</span><span class=brand-gateway>智能网关</span></div><div class=nav-subtitle><span class=subtitle-icon>◆</span>工业物联网网关管理平台</div></div></div><div class=nav-links><div class=dropdown><button><span class=nav-btn-icon>⚙</span>设置<span class=dropdown-arrow>▾</span></button></div><a class="nav-btn nav-btn-danger"href=/logout><span class=nav-btn-icon>⏻</span>退出'),Cl=f("<a><span class=nav-btn-icon>"),kl=f("<a><span class=dropdown-item-icon>");const El=[{to:"/",label:"仪表盘",icon:"◉"},{to:"/alarms",label:"报警",icon:"⚠"},{to:"/realtime",label:"实时",icon:"◈"},{to:"/history",label:"历史",icon:"▤"}],Ll=[{to:"/gateway",label:"网关设置",icon:"⚙"},{to:"/resources",label:"资源",icon:"◐"},{to:"/devices",label:"设备",icon:"◑"},{to:"/drivers",label:"驱动",icon:"▣"},{to:"/northbound",label:"北向",icon:"◉"},{to:"/storage",label:"存储策略",icon:"◫"},{to:"/thresholds",label:"阈值",icon:"◐"}];function Tl(e){const[t,l]=y(!1);let i;const s=a=>{localStorage.removeItem("gogw_jwt")},n=()=>{l(!1)},o=a=>{i&&!i.contains(a.target)&&l(!1)};return(()=>{var a=Sl(),p=a.firstChild,u=p.firstChild,h=u.nextSibling,c=h.firstChild,C=c.firstChild,d=c.nextSibling;h.$$click=o,r(h,()=>El.map(L=>(()=>{var x=Cl(),$=x.firstChild;return x.$$click=v=>{v.preventDefault(),e.onNav(L.to),n()},r($,()=>L.icon),r(x,()=>L.label,null),m(v=>{var b=L.to,k=L.to,S=`nav-btn ${ye(e.path,L.to)?"active":""}`;return b!==v.e&&de(x,"key",v.e=b),k!==v.t&&de(x,"href",v.t=k),S!==v.a&&fe(x,v.a=S),v},{e:void 0,t:void 0,a:void 0}),x})()),c);var g=i;return typeof g=="function"?gl(g,c):i=c,C.$$click=()=>l(!t()),r(c,_(R,{get when(){return t()},get children(){var L=wl();return r(L,()=>Ll.map(x=>(()=>{var $=kl(),v=$.firstChild;return $.$$click=b=>{b.preventDefault(),e.onNav(x.to),n()},r(v,()=>x.icon),r($,()=>x.label,null),m(b=>{var k=x.to,S=x.to,w=`dropdown-item ${ye(e.path,x.to)?"active":""}`;return k!==b.e&&de($,"key",b.e=k),S!==b.t&&de($,"href",b.t=S),w!==b.a&&fe($,b.a=w),b},{e:void 0,t:void 0,a:void 0}),$})())),L}}),null),d.$$click=L=>{L.preventDefault(),s(),e.onNav("/login")},m(()=>fe(C,`nav-btn dropdown-toggle ${ye(e.path,"/resources")||ye(e.path,"/devices")||ye(e.path,"/drivers")||ye(e.path,"/northbound")||ye(e.path,"/storage")||ye(e.path,"/thresholds")?"active":""}`)),a})()}re(["click"]);var Al=f("<div class=card><div class=card-body>"),Dl=f("<div class=card-header>"),Nl=f("<h3 class=card-title>"),ql=f("<div class=card-extra>");function ie(e){return(()=>{var t=Al(),l=t.firstChild;return r(t,(()=>{var i=B(()=>!!(e.title||e.extra));return()=>i()&&(()=>{var s=Dl();return r(s,(()=>{var n=B(()=>!!e.title);return()=>n()&&(()=>{var o=Nl();return r(o,()=>e.title),o})()})(),null),r(s,(()=>{var n=B(()=>!!e.extra);return()=>n()&&(()=>{var o=ql();return r(o,()=>e.extra),o})()})(),null),s})()})(),l),r(l,()=>e.children),m(i=>pl(t,e.style||"",i)),t})()}re(["click"]);function oe(){return{show:(e,t)=>{typeof window<"u"&&window.toast&&window.toast.show(e,t)}}}re(["click"]);var Il=f("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Pl=f("<button class=btn>刷新"),Ol=f("<tr><td></td><td></td><td></td><td>"),Ml=f("<tr><td colspan=4 style=text-align:center;padding:16px;color:var(--text-muted)>暂无数据");function jl(){const e=oe(),[t,l]=y([]),i=()=>{Y("/api/data/points").then(s=>l((s.data||s).slice(0,8))).catch(()=>e.show("error","加载实时数据失败"))};return Z(()=>{i();const s=setInterval(i,4e3);Be(()=>clearInterval(s))}),_(ie,{title:"最新采集",get extra(){return(()=>{var s=Pl();return s.$$click=i,s})()},get children(){var s=Il(),n=s.firstChild,o=n.firstChild,a=o.nextSibling;return r(a,_(X,{get each(){return t()},children:p=>(()=>{var u=Ol(),h=u.firstChild,c=h.nextSibling,C=c.nextSibling,d=C.nextSibling;return r(h,()=>{var g;return((g=p.collected_at)==null?void 0:g.slice(5,19))||p.CollectedAt}),r(c,()=>p.device_name||p.DeviceName),r(C,()=>p.field_name||p.FieldName),r(d,()=>p.value||p.Value),m(()=>de(u,"key",p.id||`${p.device_id}-${p.field_name}-${p.collected_at}`)),u})()}),null),r(a,_(X,{get each(){return t().length===0?[1]:[]},children:()=>Ml()}),null),s}})}re(["click"]);var Wl=f("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th><th>阈值</th><th>级别</th><th></th></tr></thead><tbody>"),Fl=f("<button class=btn>刷新"),Bl=f('<button class="btn btn-primary"style="padding:6px 10px">确认'),Rl=f('<span class="text-muted text-xs">已确认'),Ul=f("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td>"),Gl=f("<tr><td colspan=7 style=text-align:center;padding:16px;color:var(--text-muted)>暂无告警");function Kl(){const e=oe(),[t,l]=y([]),i=()=>{Y("/api/alarms").then(n=>l((n.data||n).slice(0,8))).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const s=n=>{ae(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return _(ie,{title:"最近告警",get extra(){return(()=>{var n=Fl();return n.$$click=i,n})()},get children(){var n=Wl(),o=n.firstChild,a=o.firstChild,p=a.nextSibling;return r(p,_(X,{get each(){return t()},children:u=>(()=>{var h=Ul(),c=h.firstChild,C=c.nextSibling,d=C.nextSibling,g=d.nextSibling,L=g.nextSibling,x=L.nextSibling,$=x.firstChild,v=x.nextSibling;return r(c,()=>{var b;return((b=u.triggered_at)==null?void 0:b.slice(5,19))||u.triggered_at}),r(C,()=>u.device_id),r(d,()=>u.field_name),r(g,()=>u.actual_value),r(L,()=>`${u.operator} ${u.threshold_value}`),r($,()=>u.severity||"warn"),r(v,_(R,{get when(){return u.acknowledged!==1},get children(){var b=Bl();return b.$$click=()=>s(u.id),b}}),null),r(v,_(R,{get when(){return u.acknowledged===1},get children(){return Rl()}}),null),m(()=>fe($,`badge ${u.severity==="critical"?"badge-critical":"badge-running"}`)),h})()}),null),r(p,_(X,{get each(){return t().length===0?[1]:[]},children:()=>Gl()}),null),n}})}re(["click"]);var Hl=f("<div class=flex style=gap:12px;flex-wrap:wrap><button>");function Vl(e){const t=oe(),[l,i]=y(!1),s=()=>{i(!0);const n=e.collectorRunning?"/api/collector/stop":"/api/collector/start";ae(n,{}).then(()=>{var o;t.show("success",e.collectorRunning?"已停止采集":"已启动采集"),(o=e.onRefresh)==null||o.call(e)}).catch(()=>t.show("error","操作失败")).finally(()=>i(!1))};return _(ie,{title:"快捷操作",get children(){var n=Hl(),o=n.firstChild;return o.$$click=s,r(o,()=>e.collectorRunning?"停止采集器":"启动采集器"),m(a=>{var p=`btn ${e.collectorRunning?"btn-danger":"btn-success"}`,u=l();return p!==a.e&&fe(o,a.e=p),u!==a.t&&(o.disabled=a.t=u),a},{e:void 0,t:void 0}),n}})}re(["click"]);var Jl=f('<div><div class=grid style="grid-template-columns:2fr 1fr;gap:24px"><div class=grid style=grid-template-columns:1fr;gap:24px></div><div class=grid style=grid-template-columns:1fr;gap:24px>');function At(){const[e,t]=y(null),[l,i]=y(!0),s=()=>{Y("/api/status").then(n=>t(n.data||n)).catch(()=>{}).finally(()=>i(!1))};return Z(()=>{s();const n=setInterval(s,5e3);Be(()=>clearInterval(n))}),(()=>{var n=Jl(),o=n.firstChild,a=o.firstChild,p=a.nextSibling;return r(n,_(ie,{get data(){return e()},get loading(){return l()}}),o),r(a,_(jl,{}),null),r(a,_(Kl,{}),null),r(p,_(Vl,{get collectorRunning(){var u;return(u=e())==null?void 0:u.collector_running},onRefresh:s})),n})()}var zl=f('<div class=container style=max-width:420px;margin-top:48px><div class=card><div class=card-header><h3 class=card-title>登录</h3></div><form class=form><div class=form-group><label class=form-label>用户名</label><input class=form-input required></div><div class=form-group><label class=form-label>密码</label><input class=form-input type=password required></div><button class="btn btn-primary"type=submit style=width:100%;margin-top:8px>'),Ql=f('<div style="color:var(--accent-red);padding:8px 0">');function Xl(e){const[t,l]=y("admin"),[i,s]=y("123456"),[n,o]=y(""),[a,p]=y(!1),u=h=>{h.preventDefault(),p(!0),o(""),ae("/login",{username:t(),password:i()}).then(c=>{xl(c.token),window.location.replace("/")}).catch(()=>o("用户名或密码错误")).finally(()=>p(!1))};return(()=>{var h=zl(),c=h.firstChild,C=c.firstChild,d=C.nextSibling,g=d.firstChild,L=g.firstChild,x=L.nextSibling,$=g.nextSibling,v=$.firstChild,b=v.nextSibling,k=$.nextSibling;return d.addEventListener("submit",u),x.$$input=S=>l(S.target.value),b.$$input=S=>s(S.target.value),r(d,(()=>{var S=B(()=>!!n());return()=>S()&&(()=>{var w=Ql();return r(w,n),w})()})(),k),r(k,()=>a()?"登录中...":"登录"),m(()=>k.disabled=a()),m(()=>x.value=t()),m(()=>b.value=i()),h})()}re(["input"]);var Yl=f("<div style=text-align:center;padding:40px;color:var(--text-muted)>加载中..."),Zl=f('<div style="color:var(--accent-red);padding:4px 0">'),en=f('<form class=form style=max-width:480px><div class=form-group><label class=form-label>网关名称</label><input class=form-input placeholder=网关名称></div><div class=form-group><label class=form-label>ProductKey <span style=color:var(--text-muted);font-weight:normal>(产品标识)</span></label><input class=form-input placeholder=请输入产品密钥><div class=form-hint>用于北向平台身份认证</div></div><div class=form-group><label class=form-label>DeviceKey <span style=color:var(--text-muted);font-weight:normal>(设备标识)</span></label><input class=form-input placeholder=请输入设备密钥><div class=form-hint>用于北向平台设备认证</div></div><div class=flex style=gap:8px;marginTop:16px><button type=submit class="btn btn-primary">'),tn=f("<div style=color:var(--text-secondary);font-size:0.875rem;line-height:1.8><p><strong>ProductKey</strong>：网关产品的唯一标识符，用于区分不同型号的网关产品。</p><p><strong>DeviceKey</strong>：网关设备的唯一标识符，用于在同一产品下区分不同设备。</p><p>这两个密钥将在数据上报到北向平台时使用，用于设备认证和数据路由。"),ln=f("<div>");function nn(){const e=oe(),[t,l]=y({product_key:"",device_key:"",gateway_name:"HuShu智能网关"}),[i,s]=y(!0),[n,o]=y(!1),[a,p]=y(""),u=()=>{s(!0),Y("/api/gateway/config").then(c=>{l({product_key:c.product_key||"",device_key:c.device_key||"",gateway_name:c.gateway_name||"HuShu智能网关"})}).catch(()=>e.show("error","加载网关配置失败")).finally(()=>s(!1))};Z(()=>{u()});const h=c=>{c.preventDefault(),o(!0),p(""),He("/api/gateway/config",t()).then(()=>{e.show("success","网关配置已保存")}).catch(C=>{p(C.message||"保存失败"),e.show("error","保存失败")}).finally(()=>o(!1))};return(()=>{var c=ln();return r(c,_(ie,{title:"网关设置",get children(){return[_(R,{get when(){return i()},get children(){return Yl()}}),_(R,{get when(){return!i()},get children(){var C=en(),d=C.firstChild,g=d.firstChild,L=g.nextSibling,x=d.nextSibling,$=x.firstChild,v=$.nextSibling,b=x.nextSibling,k=b.firstChild,S=k.nextSibling,w=b.nextSibling,P=w.firstChild;return C.addEventListener("submit",h),L.$$input=D=>l({...t(),gateway_name:D.target.value}),v.$$input=D=>l({...t(),product_key:D.target.value}),S.$$input=D=>l({...t(),device_key:D.target.value}),r(C,_(R,{get when(){return a()},get children(){var D=Zl();return r(D,a),D}}),w),r(P,()=>n()?"保存中...":"保存配置"),m(()=>P.disabled=n()),m(()=>L.value=t().gateway_name),m(()=>v.value=t().product_key),m(()=>S.value=t().device_key),C}})]}}),null),r(c,_(ie,{title:"说明",style:"margin-top:16px;",get children(){return tn()}}),null),c})()}re(["input"]);var rn=f("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无资源"),sn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>路径</th><th>状态</th><th>操作</th></tr></thead><tbody>"),an=f('<input class=form-input placeholder="如 192.168.1.100:502"required>'),on=f('<div style="color:var(--accent-red);padding:4px 0">'),cn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title></h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=serial>串口</option><option value=net>网口 (TCP)</option><option value=di>DI</option><option value=do>DO</option></select></div><div class=form-group><label class=form-label>路径</label></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),dn=f("<div>"),un=f('<button class="btn btn-primary">新增资源'),hn=f('<tr><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除'),fn=f('<input class=form-input placeholder="如 /dev/ttyUSB0"required>');const Qe={name:"",type:"serial",path:"",enabled:1};function pn(){const e=oe(),[t,l]=y([]),[i,s]=y(Qe),[n,o]=y(null),[a,p]=y(!1),[u,h]=y(!1),[c,C]=y(""),d=()=>{Y("/api/resources").then($=>l($.data||$)).catch(()=>e.show("error","加载资源失败"))};Z(()=>{d()}),Z(()=>{if(!a())return;const $=v=>{v.key==="Escape"&&p(!1)};window.addEventListener("keydown",$),Be(()=>window.removeEventListener("keydown",$))});const g=$=>{$.preventDefault(),h(!0),C(""),(n()?He(`/api/resources/${n()}`,i()):ae("/api/resources",i())).then(()=>{e.show("success",n()?"资源已更新":"资源已创建"),s(Qe),o(null),p(!1),d()}).catch(b=>{C(b.message||"保存失败"),e.show("error","保存失败")}).finally(()=>h(!1))},L=$=>{confirm("删除该资源？")&&confirm("删除后关联设备可能需要重新绑定资源，确认继续？")&&Ie(`/api/resources/${$}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))},x=$=>{ae(`/api/resources/${$.id}/toggle`,{}).then(d).catch(()=>e.show("error","切换失败"))};return(()=>{var $=dn();return r($,_(ie,{title:"资源列表",get extra(){return(()=>{var v=un();return v.$$click=()=>{s(Qe),o(null),C(""),p(!0)},v})()},get children(){var v=sn(),b=v.firstChild,k=b.firstChild,S=k.nextSibling;return r(S,_(X,{get each(){return t()},children:w=>(()=>{var P=hn(),D=P.firstChild,M=D.nextSibling,j=M.nextSibling,O=j.nextSibling,U=O.nextSibling,W=U.firstChild,F=U.nextSibling,H=F.firstChild,ee=H.nextSibling,N=ee.nextSibling;return r(D,()=>w.id),r(M,()=>w.name),r(j,()=>w.type),r(O,()=>w.path),r(W,()=>w.enabled===1?"启用":"禁用"),H.$$click=()=>{o(w.id),s({name:w.name,type:w.type,path:w.path,enabled:w.enabled}),C(""),p(!0)},ee.$$click=()=>x(w),r(ee,()=>w.enabled===1?"禁用":"启用"),N.$$click=()=>L(w.id),m(()=>fe(W,`badge ${w.enabled===1?"badge-running":"badge-stopped"}`)),P})()}),null),r(S,_(R,{get when(){return t().length===0},get children(){return rn()}}),null),v}}),null),r($,_(R,{get when(){return a()},get children(){var v=cn(),b=v.firstChild,k=b.firstChild,S=k.firstChild,w=k.nextSibling,P=w.firstChild,D=P.firstChild,M=D.nextSibling,j=P.nextSibling,O=j.firstChild,U=O.nextSibling,W=j.nextSibling;W.firstChild;var F=W.nextSibling,H=F.firstChild,ee=H.nextSibling;return v.$$click=N=>{N.target===N.currentTarget&&p(!1)},r(S,()=>n()?"编辑资源":"新增资源"),w.addEventListener("submit",g),M.$$input=N=>s({...i(),name:N.target.value}),U.addEventListener("change",N=>s({...i(),type:N.target.value})),r(W,_(R,{get when(){return i().type==="net"},get fallback(){return(()=>{var N=fn();return N.$$input=le=>s({...i(),path:le.target.value}),m(()=>N.value=i().path),N})()},get children(){var N=an();return N.$$input=le=>s({...i(),path:le.target.value}),m(()=>N.value=i().path),N}}),null),r(w,_(R,{get when(){return c()},get children(){var N=on();return r(N,c),N}}),F),H.$$click=()=>{p(!1),o(null),s(Qe)},r(ee,(()=>{var N=B(()=>!!u());return()=>N()?"保存中...":n()?"保存":"创建"})()),m(N=>{var le=u(),se=u();return le!==N.e&&(H.disabled=N.e=le),se!==N.t&&(ee.disabled=N.t=se),N},{e:void 0,t:void 0}),m(()=>M.value=i().name),m(()=>U.value=i().type),v}}),null),$})()}re(["click","input"]);var gn=f("<option value disabled>暂无可用驱动"),$n=f("<option value disabled>暂无可用资源"),vn=f('<div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>波特率</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>校验位</label><select class=form-select><option value=N>None</option><option value=E>Even</option><option value=O>Odd</option></select></div><div class=form-group><label class=form-label>数据位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>停止位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>设备地址</label><input class=form-input required>'),bn=f('<div class=grid style="grid-template-columns:repeat(1, 1fr);gap:12px"><div class=form-group><label class=form-label>设备地址</label><input class=form-input required>'),_n=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:720px;max-width:100%><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:0 4px"><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>描述</label><input class=form-input></div><div class=form-group><label class=form-label>ProductKey</label><input class=form-input placeholder="子设备 productKey"></div><div class=form-group><label class=form-label>DeviceKey</label><input class=form-input placeholder="子设备 deviceKey"></div><div class=form-group><label class=form-label>选择驱动 <span style=color:var(--accent-red)>*</span></label><select class=form-select required><option value>请选择驱动</option></select></div><div class=form-group><label class=form-label>绑定资源</label><select class=form-select><option value>请选择资源</option></select></div></div><div class=form-group><label class=form-label>驱动类型</label><select class=form-select><option value=modbus_rtu_wasm>ModbusRtu / Wasm</option><option value=modbus_tcp_wasm>ModbusTcp / Wasm</option><option value=modbus_rtu_excel>ModbusRtu / Excel</option><option value=modbus_tcp_excel>ModbusTcp / Excel</option></select></div><div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>采集周期(ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>超时(ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>状态</label><select class=form-select><option value=1>启用</option><option value=0>禁用</option></select></div></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:16px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),mn=f('<div style="color:var(--accent-red);padding:4px 0">'),xn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1001><div class=card style=width:400px;max-width:90vw><div class=card-header><h3 class=card-title>写入数据 - </h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style=padding:16px><div class=form-group><label class=form-label>字段</label><select class=form-select></select></div><div class=form-group><label class=form-label>值</label><input class=form-input type=number required></div><div class=flex style=gap:8px;marginTop:12px><button type=button class=btn style=flex:1>取消</button><button type=submit class="btn btn-primary"style=flex:1>写入'),yn=f("<div>"),wn=f('<div class="flex gap-3"><input class=form-input placeholder=搜索设备/地址/驱动 style=max-width:240px><button class=btn>刷新</button><button class="btn btn-primary">新增设备'),Sn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Cn=f('<div style="color:var(--accent-red);padding:16px 0">'),kn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>驱动类型</th><th>驱动</th><th>资源</th><th>周期(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),En=f('<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:4px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger"style=padding-left:8px;padding-right:8px>删'),Ln=f('<div><div></div><div class="text-muted text-xs">'),Tn=f("<span style=color:var(--text-muted)>-"),An=f("<tr><td colspan=8 style=text-align:center;padding:24px;color:var(--text-muted)>暂无设备"),Dn=f("<option> (v<!>)"),Nn=f("<option> (<!>) "),qn=f("<option>");const Me={name:"",description:"",product_key:"",device_key:"",driver_id:null,driver_type:"modbus_rtu_wasm",serial_port:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",ip_address:"",port_num:502,device_address:"1",collect_interval:1e3,timeout:1e3,resource_id:null,enabled:1};function In(){const e=oe(),[t,l]=y([]),[i,s]=y([]),[n,o]=y([]),[a,p]=y(!0),[u,h]=y(""),[c,C]=y(""),[d,g]=y(Me),[L,x]=y(null),[$,v]=y(!1),[b,k]=y(!1),[S,w]=y(!1),[P]=y([]),[D,M]=y({field:"",value:""}),[j,O]=y(""),[U]=y(null),W=T=>Array.isArray(T)?T:T&&Array.isArray(T.data)?T.data:[],F=()=>{p(!0),Promise.allSettled([Y("/api/devices"),Y("/api/resources"),Y("/api/drivers")]).then(([T,q,G])=>{if(T.status==="fulfilled"&&l(W(T.value)),q.status==="fulfilled"&&s(W(q.value)),G.status==="fulfilled"){const K=W(G.value);o(K.filter(E=>Number(E.enabled??1)===1))}const I=[T,q,G].some(K=>K.status==="rejected");h(I?"加载设备、资源或驱动失败":"")}).finally(()=>p(!1))};Z(()=>{F()}),Z(()=>{if(!$())return;const T=q=>{q.key==="Escape"&&v(!1)};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)});const H=()=>{const T=c().trim().toLowerCase();return T?t().filter(q=>[q.name,q.device_address,q.driver_type,q.driver_name].filter(Boolean).some(G=>G.toLowerCase().includes(T))):t()},ee=T=>{T.preventDefault(),k(!0),(L()?He(`/api/devices/${L()}`,d()):ae("/api/devices",d())).then(()=>{e.show("success",L()?"设备已更新":"设备已创建"),g(Me),x(null),v(!1),F()}).catch(()=>e.show("error","操作失败")).finally(()=>k(!1))},N=T=>{ae(`/api/devices/${T}/toggle`,{}).then(F).catch(()=>e.show("error","切换失败"))},le=T=>{confirm("确定删除该设备？")&&Ie(`/api/devices/${T}`).then(()=>{e.show("success","已删除"),F()}).catch(()=>e.show("error","删除失败"))},se=T=>{T.preventDefault(),O(""),ae(`/api/devices/${U().id}/write`,D()).then(()=>{e.show("success","写入成功"),w(!1)}).catch(q=>O(q.message||"写入失败"))},ve=()=>{g(Me),x(null),v(!0)},Ae=T=>{x(T.id),g({name:T.name,description:T.description||"",product_key:T.product_key||"",device_key:T.device_key||"",driver_id:T.driver_id,driver_type:T.driver_type||"modbus_rtu_wasm",serial_port:T.serial_port||"",baud_rate:T.baud_rate||9600,data_bits:T.data_bits||8,stop_bits:T.stop_bits||1,parity:T.parity||"N",ip_address:T.ip_address||"",port_num:T.port_num||502,device_address:T.device_address||"1",collect_interval:T.collect_interval||1e3,timeout:T.timeout||1e3,resource_id:T.resource_id,enabled:T.enabled}),v(!0)},be=()=>i().length?i():[];return(()=>{var T=yn();return r(T,_(ie,{title:"设备列表",get extra(){return(()=>{var q=wn(),G=q.firstChild,I=G.nextSibling,K=I.nextSibling;return G.$$input=E=>C(E.target.value),I.$$click=F,K.$$click=ve,m(()=>G.value=c()),q})()},get children(){return B(()=>!!a())()?Sn():B(()=>!!u())()?(()=>{var q=Cn();return r(q,u),q})():(()=>{var q=kn(),G=q.firstChild,I=G.firstChild,K=I.nextSibling;return r(K,_(X,{get each(){return H()},children:E=>(()=>{var z=En(),ue=z.firstChild,Se=ue.nextSibling,_e=Se.nextSibling,me=_e.nextSibling,Ce=me.nextSibling,ke=Ce.nextSibling,xe=ke.nextSibling,Ee=xe.firstChild,te=xe.nextSibling,pe=te.firstChild,De=pe.nextSibling,rt=De.nextSibling;return r(ue,()=>E.id),r(Se,()=>E.name),r(_e,()=>E.driver_type),r(me,()=>E.driver_name||(E.driver_id?`驱动 #${E.driver_id}`:"-")),r(Ce,(()=>{var Ve=B(()=>!!E.resource_name);return()=>Ve()?(()=>{var Pe=Ln(),Je=Pe.firstChild,Le=Je.nextSibling;return r(Je,()=>E.resource_name),r(Le,()=>E.resource_path),Pe})():Tn()})()),r(ke,()=>E.collect_interval),r(Ee,()=>E.enabled===1?"启用":"禁用"),pe.$$click=()=>Ae(E),De.$$click=()=>N(E.id),r(De,()=>E.enabled===1?"禁用":"启用"),rt.$$click=()=>le(E.id),m(()=>fe(Ee,`badge ${E.enabled===1?"badge-running":"badge-stopped"}`)),z})()}),null),r(K,_(X,{get each(){return H().length===0?[1]:[]},children:()=>An()}),null),q})()}}),null),r(T,_(R,{get when(){return $()},get children(){var q=_n(),G=q.firstChild,I=G.firstChild,K=I.firstChild,E=K.nextSibling,z=I.nextSibling,ue=z.firstChild,Se=ue.firstChild,_e=Se.firstChild,me=_e.nextSibling,Ce=Se.nextSibling,ke=Ce.firstChild,xe=ke.nextSibling,Ee=Ce.nextSibling,te=Ee.firstChild,pe=te.nextSibling,De=Ee.nextSibling,rt=De.firstChild,Ve=rt.nextSibling,Pe=De.nextSibling,Je=Pe.firstChild,Le=Je.nextSibling;Le.firstChild;var Gt=Pe.nextSibling,Kt=Gt.firstChild,Oe=Kt.nextSibling;Oe.firstChild;var ft=ue.nextSibling,Ht=ft.firstChild,pt=Ht.nextSibling,ze=ft.nextSibling,gt=ze.firstChild,Vt=gt.firstChild,$t=Vt.nextSibling,vt=gt.nextSibling,Jt=vt.firstChild,bt=Jt.nextSibling,zt=vt.nextSibling,Qt=zt.firstChild,_t=Qt.nextSibling,Xt=ze.nextSibling,st=Xt.firstChild,mt=st.nextSibling;return r(K,()=>L()?"编辑设备":"新增设备"),E.$$click=()=>{v(!1),x(null),g(Me)},z.addEventListener("submit",ee),me.$$input=A=>g({...d(),name:A.target.value}),xe.$$input=A=>g({...d(),description:A.target.value}),pe.$$input=A=>g({...d(),product_key:A.target.value}),Ve.$$input=A=>g({...d(),device_key:A.target.value}),Le.addEventListener("change",A=>g({...d(),driver_id:A.target.value?+A.target.value:null})),r(Le,_(R,{get when(){return!n().length},get children(){return gn()}}),null),r(Le,_(X,{get each(){return n()},children:A=>(()=>{var V=Dn(),ce=V.firstChild,he=ce.nextSibling;return he.nextSibling,r(V,()=>A.name,ce),r(V,()=>A.version||"1.0",he),m(()=>V.value=A.id),V})()}),null),Oe.addEventListener("change",A=>g({...d(),resource_id:A.target.value?+A.target.value:null})),r(Oe,_(R,{get when(){return!be().length},get children(){return $n()}}),null),r(Oe,_(X,{get each(){return be()},children:A=>(()=>{var V=Nn(),ce=V.firstChild,he=ce.nextSibling;return he.nextSibling,r(V,()=>A.name,ce),r(V,()=>A.type,he),r(V,(()=>{var Ne=B(()=>!!A.path);return()=>Ne()?`- ${A.path}`:""})(),null),m(()=>V.value=A.id),V})()}),null),pt.addEventListener("change",A=>g({...d(),driver_type:A.target.value,resource_id:null})),r(z,_(R,{get when(){var A;return(A=d().driver_type)==null?void 0:A.startsWith("modbus_rtu")},get children(){var A=vn(),V=A.firstChild,ce=V.firstChild,he=ce.nextSibling,Ne=V.nextSibling,Yt=Ne.firstChild,xt=Yt.nextSibling,yt=Ne.nextSibling,Zt=yt.firstChild,wt=Zt.nextSibling,St=yt.nextSibling,el=St.firstChild,Ct=el.nextSibling,tl=St.nextSibling,ll=tl.firstChild,kt=ll.nextSibling;return he.$$input=ge=>g({...d(),baud_rate:+ge.target.value}),xt.addEventListener("change",ge=>g({...d(),parity:ge.target.value})),wt.$$input=ge=>g({...d(),data_bits:+ge.target.value}),Ct.$$input=ge=>g({...d(),stop_bits:+ge.target.value}),kt.$$input=ge=>g({...d(),device_address:ge.target.value}),m(()=>he.value=d().baud_rate),m(()=>xt.value=d().parity),m(()=>wt.value=d().data_bits),m(()=>Ct.value=d().stop_bits),m(()=>kt.value=d().device_address),A}}),ze),r(z,_(R,{get when(){var A;return(A=d().driver_type)==null?void 0:A.startsWith("modbus_tcp")},get children(){var A=bn(),V=A.firstChild,ce=V.firstChild,he=ce.nextSibling;return he.$$input=Ne=>g({...d(),device_address:Ne.target.value}),m(()=>he.value=d().device_address),A}}),ze),$t.$$input=A=>g({...d(),collect_interval:+A.target.value}),bt.$$input=A=>g({...d(),timeout:+A.target.value}),_t.addEventListener("change",A=>g({...d(),enabled:+A.target.value})),st.$$click=()=>{v(!1),x(null),g(Me)},r(mt,(()=>{var A=B(()=>!!b());return()=>A()?"保存中...":L()?"保存":"创建"})()),m(A=>{var V=b(),ce=b();return V!==A.e&&(st.disabled=A.e=V),ce!==A.t&&(mt.disabled=A.t=ce),A},{e:void 0,t:void 0}),m(()=>me.value=d().name),m(()=>xe.value=d().description),m(()=>pe.value=d().product_key),m(()=>Ve.value=d().device_key),m(()=>Le.value=d().driver_id??""),m(()=>Oe.value=d().resource_id??""),m(()=>pt.value=d().driver_type),m(()=>$t.value=d().collect_interval),m(()=>bt.value=d().timeout),m(()=>_t.value=d().enabled),q}}),null),r(T,_(R,{get when(){return S()},get children(){var q=xn(),G=q.firstChild,I=G.firstChild,K=I.firstChild;K.firstChild;var E=K.nextSibling,z=I.nextSibling,ue=z.firstChild,Se=ue.firstChild,_e=Se.nextSibling,me=ue.nextSibling,Ce=me.firstChild,ke=Ce.nextSibling,xe=me.nextSibling,Ee=xe.firstChild;return r(K,()=>{var te;return(te=U())==null?void 0:te.name},null),E.$$click=()=>w(!1),z.addEventListener("submit",se),_e.addEventListener("change",te=>M({...D(),field:te.target.value})),r(_e,_(X,{get each(){return P()},children:te=>(()=>{var pe=qn();return r(pe,()=>te.label||te.field),m(()=>pe.value=te.field),pe})()})),ke.$$input=te=>M({...D(),value:te.target.value}),r(z,_(R,{get when(){return j()},get children(){var te=mn();return r(te,j),te}}),xe),Ee.$$click=()=>w(!1),m(()=>_e.value=D().field),m(()=>ke.value=D().value),q}}),null),T})()}re(["click","input"]);function Pn(){return _(In,{})}var On=f('<label class="btn btn-primary"style=cursor:pointer>上传驱动<input type=file accept=.wasm style=display:none>'),Mn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),jn=f('<div style="color:var(--accent-red);padding:16px 0">'),Wn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>文件</th><th>大小</th><th>操作</th></tr></thead><tbody>"),Fn=f('<tr><td></td><td></td><td></td><td></td><td class=flex style=gap:8px><a class=btn>下载</a><button class="btn btn-danger">删除'),Bn=f("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无驱动");function Rn(){const e=oe(),[t,l]=y([]),[i,s]=y(!0),[n,o]=y(""),a=()=>{s(!0),Y("/api/drivers").then(h=>{l(h.data||h),o("")}).catch(()=>o("加载驱动失败")).finally(()=>s(!1))};Z(()=>{a()});const p=(h,c)=>{confirm(`删除驱动 ${c} ？`)&&Ie(`/api/drivers/${h}`).then(()=>{e.show("success","已删除"),a()}).catch(()=>e.show("error","删除失败"))},u=h=>{var d;const c=(d=h.target.files)==null?void 0:d[0];if(!c)return;const C=new FormData;C.append("file",c),yl("/api/drivers/upload",C).then(()=>{e.show("success","上传成功"),a()}).catch(()=>e.show("error","上传失败")).finally(()=>{h.target.value=""})};return _(ie,{title:"驱动管理",get extra(){return(()=>{var h=On(),c=h.firstChild,C=c.nextSibling;return C.addEventListener("change",u),h})()},get children(){return B(()=>!!i())()?Mn():B(()=>!!n())()?(()=>{var h=jn();return r(h,n),h})():(()=>{var h=Wn(),c=h.firstChild,C=c.firstChild,d=C.nextSibling;return r(d,_(X,{get each(){return t()},children:g=>(()=>{var L=Fn(),x=L.firstChild,$=x.nextSibling,v=$.nextSibling,b=v.nextSibling,k=b.nextSibling,S=k.firstChild,w=S.nextSibling;return r(x,()=>g.id),r($,()=>g.name),r(v,()=>g.filename||g.file_path||""),r(b,(()=>{var P=B(()=>!!g.size);return()=>P()?(g.size/1024).toFixed(1)+" KB":"-"})()),w.$$click=()=>p(g.id,g.name),m(()=>de(S,"href",`/api/drivers/${g.id}/download`)),L})()}),null),r(d,_(X,{get each(){return t().length===0?[1]:[]},children:()=>Bn()}),null),h})()}})}re(["click"]);function Un(){return _(Rn,{})}var Gn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:480px;max-width:90vw><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input placeholder=配置名称 required></div><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=http>HTTP</option><option value=mqtt>MQTT</option><option value=xunji>寻迹</option></select></div><div class=form-group><label class=form-label>上传间隔 (ms)</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>配置 (JSON)</label><textarea class=form-input rows=5 placeholder="{ &quot;url&quot;: &quot;http://...&quot;, &quot;method&quot;: &quot;POST&quot; }"style=font-family:monospace;font-size:13px></textarea></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),Kn=f("<div>"),Hn=f('<button class="btn btn-primary">新增配置'),Vn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Jn=f("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置"),zn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>上传间隔(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Qn=f('<tr><td></td><td></td><td><span class="badge badge-info"></span></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const je={name:"",type:"http",upload_interval:5e3,config:"{}",enabled:1};function Xn(){const e=oe(),[t,l]=y([]),[i,s]=y(!0),[n,o]=y(je),[a,p]=y(null),[u,h]=y(!1),[c,C]=y(!1),d=()=>{s(!0),Y("/api/northbound").then(b=>l(b.data||b)).catch(()=>e.show("error","加载北向配置失败")).finally(()=>s(!1))};Z(()=>{d()});const g=b=>{b.preventDefault(),C(!0),(a()?He(`/api/northbound/${a()}`,n()):ae("/api/northbound",n())).then(()=>{e.show("success",a()?"已更新":"已创建"),o(je),p(null),h(!1),d()}).catch(()=>e.show("error","操作失败")).finally(()=>C(!1))},L=(b,k)=>{ae(`/api/northbound/${b}/toggle`,{}).then(d).catch(()=>e.show("error","切换失败"))},x=b=>{confirm("删除该配置？")&&Ie(`/api/northbound/${b}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))},$=()=>{o(je),p(null),h(!0)},v=b=>{p(b.id),o({name:b.name,type:b.type,upload_interval:b.upload_interval,config:b.config,enabled:b.enabled}),h(!0)};return(()=>{var b=Kn();return r(b,_(ie,{title:"北向配置列表",get extra(){return(()=>{var k=Hn();return k.$$click=$,k})()},get children(){return B(()=>!!i())()?Vn():(()=>{var k=zn(),S=k.firstChild,w=S.firstChild,P=w.nextSibling;return r(P,_(X,{get each(){return t()},children:D=>(()=>{var M=Qn(),j=M.firstChild,O=j.nextSibling,U=O.nextSibling,W=U.firstChild,F=U.nextSibling,H=F.nextSibling,ee=H.firstChild,N=H.nextSibling,le=N.firstChild,se=le.nextSibling,ve=se.nextSibling;return r(j,()=>D.id),r(O,()=>D.name),r(W,()=>D.type.toUpperCase()),r(F,()=>D.upload_interval),r(ee,()=>D.enabled===1?"启用":"禁用"),le.$$click=()=>v(D),se.$$click=()=>L(D.id,D.enabled===1),r(se,()=>D.enabled===1?"禁用":"启用"),ve.$$click=()=>x(D.id),m(()=>fe(ee,`badge ${D.enabled===1?"badge-running":"badge-stopped"}`)),M})()}),null),r(P,_(R,{get when(){return t().length===0},get children(){return Jn()}}),null),k})()}}),null),r(b,_(R,{get when(){return u()},get children(){var k=Gn(),S=k.firstChild,w=S.firstChild,P=w.firstChild,D=P.nextSibling,M=w.nextSibling,j=M.firstChild,O=j.firstChild,U=O.nextSibling,W=j.nextSibling,F=W.firstChild,H=F.firstChild,ee=H.nextSibling,N=F.nextSibling,le=N.firstChild,se=le.nextSibling,ve=W.nextSibling,Ae=ve.firstChild,be=Ae.nextSibling,T=ve.nextSibling,q=T.firstChild,G=q.nextSibling;return r(P,()=>a()?"编辑北向配置":"新增北向配置"),D.$$click=()=>{h(!1),p(null),o(je)},M.addEventListener("submit",g),U.$$input=I=>o({...n(),name:I.target.value}),ee.addEventListener("change",I=>o({...n(),type:I.target.value})),se.$$input=I=>o({...n(),upload_interval:+I.target.value}),be.$$input=I=>o({...n(),config:I.target.value}),q.$$click=()=>{h(!1),p(null),o(je)},r(G,(()=>{var I=B(()=>!!c());return()=>I()?"保存中...":a()?"保存":"创建"})()),m(I=>{var K=c(),E=c();return K!==I.e&&(q.disabled=I.e=K),E!==I.t&&(G.disabled=I.t=E),I},{e:void 0,t:void 0}),m(()=>U.value=n().name),m(()=>ee.value=n().type),m(()=>se.value=n().upload_interval),m(()=>be.value=n().config),k}}),null),b})()}re(["click","input"]);function Yn(){return _(Xn,{})}var Zn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>设备</th><th>字段</th><th>条件</th><th>严重性</th><th>状态</th><th>操作</th></tr></thead><tbody>"),ei=f('<div style="color:var(--accent-red);padding:4px 0">'),ti=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:440px;max-width:92vw><div class=card-header><h3 class=card-title>新增阈值</h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>设备</label><select class=form-select required><option value>选择设备</option></select></div><div class=form-group><label class=form-label>字段名</label><input class=form-input required></div><div class=grid style="gridTemplateColumns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>运算符</label><select class=form-select><option value=">">大于 &gt;</option><option value=">=">大于等于 &gt;=</option><option value="<">小于 &lt;</option><option value="<=">小于等于 &lt;=</option><option value="==">等于 ==</option></select></div><div class=form-group><label class=form-label>阈值</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>严重程度</label><select class=form-select><option value=info>info</option><option value=warning>warning</option><option value=error>error</option><option value=critical>critical</option></select></div><div class=form-group><label class=form-label>报警消息</label><input class=form-input></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),li=f("<div>"),ni=f('<button class="btn btn-primary">新增阈值'),ii=f('<tr><td></td><td></td><td></td><td> </td><td></td><td><span></span></td><td><button class="btn btn-danger">删除'),ri=f("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无阈值"),si=f("<option>");const Xe={device_id:"",field_name:"",operator:">",value:0,severity:"warning",message:"",enabled:1};function ai(){const e=oe(),[t,l]=y([]),[i,s]=y([]),[n,o]=y(Xe),[a,p]=y(!1),[u,h]=y(!1),[c,C]=y(""),d=()=>{Y("/api/thresholds").then($=>l($.data||$)).catch(()=>e.show("error","加载阈值失败"))},g=()=>{Y("/api/devices").then($=>s($.data||$)).catch(()=>{})};Z(()=>{d(),g()}),Z(()=>{if(!a())return;const $=v=>{v.key==="Escape"&&p(!1)};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)});const L=$=>{$.preventDefault(),h(!0),C(""),ae("/api/thresholds",n()).then(()=>{e.show("success","阈值已创建"),o(Xe),p(!1),d()}).catch(v=>{C(v.message||"创建失败"),e.show("error","创建失败")}).finally(()=>h(!1))},x=$=>{confirm("删除该阈值？")&&Ie(`/api/thresholds/${$}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))};return(()=>{var $=li();return r($,_(ie,{title:"阈值配置列表",get extra(){return(()=>{var v=ni();return v.$$click=()=>{o(Xe),C(""),p(!0)},v})()},get children(){var v=Zn(),b=v.firstChild,k=b.firstChild,S=k.nextSibling;return r(S,_(X,{get each(){return t()},children:w=>(()=>{var P=ii(),D=P.firstChild,M=D.nextSibling,j=M.nextSibling,O=j.nextSibling,U=O.firstChild,W=O.nextSibling,F=W.nextSibling,H=F.firstChild,ee=F.nextSibling,N=ee.firstChild;return r(D,()=>w.id),r(M,()=>w.device_id),r(j,()=>w.field_name),r(O,()=>w.operator,U),r(O,()=>w.value,null),r(W,()=>w.severity),r(H,()=>w.enabled===1?"启用":"禁用"),N.$$click=()=>x(w.id),m(()=>fe(H,`badge ${w.enabled===1?"badge-running":"badge-stopped"}`)),P})()}),null),r(S,_(X,{get each(){return t().length===0?[1]:[]},children:()=>ri()}),null),v}}),null),r($,_(R,{get when(){return a()},get children(){var v=ti(),b=v.firstChild,k=b.firstChild,S=k.nextSibling,w=S.firstChild,P=w.firstChild,D=P.nextSibling;D.firstChild;var M=w.nextSibling,j=M.firstChild,O=j.nextSibling,U=M.nextSibling,W=U.firstChild,F=W.firstChild,H=F.nextSibling,ee=W.nextSibling,N=ee.firstChild,le=N.nextSibling,se=U.nextSibling,ve=se.firstChild,Ae=ve.nextSibling,be=se.nextSibling,T=be.firstChild,q=T.nextSibling,G=be.nextSibling,I=G.firstChild,K=I.nextSibling;return v.$$click=E=>{E.target===E.currentTarget&&p(!1)},S.addEventListener("submit",L),D.addEventListener("change",E=>o({...n(),device_id:+E.target.value})),r(D,()=>i().map(E=>(()=>{var z=si();return r(z,()=>E.name||E.id),m(()=>de(z,"key",E.id)),m(()=>z.value=E.id),z})()),null),O.$$input=E=>o({...n(),field_name:E.target.value}),H.addEventListener("change",E=>o({...n(),operator:E.target.value})),le.$$input=E=>o({...n(),value:+E.target.value}),Ae.addEventListener("change",E=>o({...n(),severity:E.target.value})),q.$$input=E=>o({...n(),message:E.target.value}),r(S,_(R,{get when(){return c()},get children(){var E=ei();return r(E,c),E}}),G),I.$$click=()=>{p(!1),o(Xe)},r(K,()=>u()?"创建中...":"创建"),m(E=>{var z=u(),ue=u();return z!==E.e&&(I.disabled=E.e=z),ue!==E.t&&(K.disabled=E.t=ue),E},{e:void 0,t:void 0}),m(()=>D.value=n().device_id),m(()=>O.value=n().field_name),m(()=>H.value=n().operator),m(()=>le.value=n().value),m(()=>Ae.value=n().severity),m(()=>q.value=n().message),v}}),null),$})()}re(["click","input"]);function oi(){return _(ai,{})}var ci=f("<div class=table-container style=max-height:600px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备ID</th><th>字段</th><th>实际值</th><th>阈值条件</th><th>级别</th><th>消息</th><th>状态</th><th>操作</th></tr></thead><tbody>"),di=f("<button class=btn>刷新"),ui=f("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td></td><td></td><td>"),hi=f('<span class="text-muted text-xs">已确认'),fi=f("<span class=text-warning>未确认"),pi=f('<button class="btn btn-primary btn-sm">确认'),gi=f("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无告警");function $i(){const e=oe(),[t,l]=y([]),i=()=>{Y("/api/alarms").then(n=>l(n.data||n)).catch(()=>e.show("error","加载告警失败"))};Z(()=>{i()});const s=n=>{ae(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return _(ie,{title:"报警日志",get extra(){return(()=>{var n=di();return n.$$click=i,n})()},get children(){var n=ci(),o=n.firstChild,a=o.firstChild,p=a.nextSibling;return r(p,_(X,{get each(){return t()},children:u=>(()=>{var h=ui(),c=h.firstChild,C=c.nextSibling,d=C.nextSibling,g=d.nextSibling,L=g.nextSibling,x=L.nextSibling,$=x.firstChild,v=x.nextSibling,b=v.nextSibling,k=b.nextSibling;return r(c,()=>{var S;return((S=u.triggered_at)==null?void 0:S.slice(5,19))||u.triggered_at}),r(C,()=>u.device_id),r(d,()=>u.field_name),r(g,()=>u.actual_value),r(L,()=>`${u.operator} ${u.threshold_value}`),r($,()=>u.severity||"warn"),r(v,()=>u.message||"-"),r(b,(()=>{var S=B(()=>u.acknowledged===1);return()=>S()?hi():fi()})()),r(k,(()=>{var S=B(()=>u.acknowledged!==1);return()=>S()&&(()=>{var w=pi();return w.$$click=()=>s(u.id),w})()})()),m(()=>fe($,`badge ${u.severity==="critical"?"badge-critical":"badge-running"}`)),h})()}),null),r(p,_(X,{get each(){return t().length===0?[1]:[]},children:()=>gi()}),null),n}})}re(["click"]);var vi=f("<select class=form-select>"),bi=f("<option>"),_i=f("<div style=padding:24px>加载中..."),mi=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),xi=f("<tr><td></td><td></td><td></td><td>"),yi=f("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无数据");function wi(){const e=oe(),[t,l]=y([]),[i,s]=y(""),[n,o]=y([]),[a,p]=y(!1);return Z(()=>{Y("/api/devices").then(u=>{const h=u.data||u;l(h),h.length&&s(String(h[0].id))}).catch(()=>e.show("error","加载设备失败"))}),Z(()=>{i()&&(p(!0),Y(`/api/data/points/${i()}`).then(u=>o(u.data||u)).catch(()=>e.show("error","加载实时数据失败")).finally(()=>p(!1)))}),_(ie,{title:"实时数据",get extra(){return(()=>{var u=vi();return u.addEventListener("change",h=>s(h.target.value)),r(u,()=>t().map(h=>(()=>{var c=bi();return r(c,()=>h.name||h.id),m(()=>de(c,"key",h.id)),m(()=>c.value=h.id),c})())),m(()=>u.value=i()),u})()},get children(){return B(()=>!!a())()?_i():(()=>{var u=mi(),h=u.firstChild,c=h.firstChild,C=c.nextSibling;return r(C,()=>n().map(d=>(()=>{var g=xi(),L=g.firstChild,x=L.nextSibling,$=x.nextSibling,v=$.nextSibling;return r(L,()=>d.collected_at||d.CollectedAt||""),r(x,()=>d.device_name||""),r($,()=>d.field_name||""),r(v,()=>d.value),m(()=>de(g,"key",d.id||`${d.device_id}-${d.collected_at}-${d.field_name}`)),g})()),null),r(C,(()=>{var d=B(()=>n().length===0);return()=>d()&&yi()})(),null),u})()}})}var Si=f('<div class="flex gap-3"><select class=form-select><option value>全部设备</option></select><button class=btn>刷新'),Ci=f("<option>"),ki=f("<div style=padding:24px>加载中..."),Ei=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Li=f("<tr><td></td><td></td><td></td><td>"),Ti=f("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无历史数据");function Ai(){const e=oe(),[t,l]=y(""),[i,s]=y([]),[n,o]=y(!1),[a,p]=y([]);Z(()=>{Y("/api/devices").then(h=>p(h.data||h)).catch(()=>{})});const u=()=>{o(!0);const h=t()?`/api/data/history?device_id=${t()}`:"/api/data/history";Y(h).then(c=>s(c.data||c)).catch(()=>e.show("error","加载历史数据失败")).finally(()=>o(!1))};return Z(()=>{u()}),_(ie,{title:"历史数据",get extra(){return(()=>{var h=Si(),c=h.firstChild;c.firstChild;var C=c.nextSibling;return c.addEventListener("change",d=>l(d.target.value)),r(c,()=>a().map(d=>(()=>{var g=Ci();return r(g,()=>d.name||d.id),m(()=>de(g,"key",d.id)),m(()=>g.value=d.id),g})()),null),C.$$click=u,m(()=>c.value=t()),h})()},get children(){return B(()=>!!n())()?ki():(()=>{var h=Ei(),c=h.firstChild,C=c.firstChild,d=C.nextSibling;return r(d,()=>i().map(g=>(()=>{var L=Li(),x=L.firstChild,$=x.nextSibling,v=$.nextSibling,b=v.nextSibling;return r(x,()=>{var k;return((k=g.collected_at)==null?void 0:k.slice(0,19))||g.CollectedAt}),r($,()=>g.device_name||g.DeviceName),r(v,()=>g.field_name||g.FieldName),r(b,()=>g.value||g.Value),m(()=>de(L,"key",g.id)),L})()),null),r(d,(()=>{var g=B(()=>i().length===0);return()=>g()&&Ti()})(),null),h})()}})}re(["click"]);var Di=f('<form class=form><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>保留天数</label><input class=form-input type=number required></div><div class=flex style=gap:12px;margin-top:12px><button class="btn btn-primary"type=submit style=flex:1></button><button class=btn type=button style=flex:1>重置'),Ni=f('<div class=grid style="grid-template-columns:3fr 1.4fr;gap:24px">'),qi=f("<button class=btn>立即清理"),Ii=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Pi=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>保留天数</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Oi=f('<tr><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class="btn btn-danger">删除'),Mi=f("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置");const ot={name:"",storage_days:30,enabled:1};function ji(){const e=oe(),[t,l]=y([]),[i,s]=y(!0),[n,o]=y(ot),[a,p]=y(null),[u,h]=y(!1),c=()=>{s(!0),Y("/api/storage").then(x=>l(x.data||x)).catch(()=>e.show("error","加载存储配置失败")).finally(()=>s(!1))};Z(()=>{c()});const C=x=>{x.preventDefault(),h(!0),(a()?He(`/api/storage/${a()}`,n()):ae("/api/storage",n())).then(()=>{e.show("success",a()?"已更新":"已创建"),o(ot),p(null),c()}).catch(()=>e.show("error","操作失败")).finally(()=>h(!1))},d=x=>{confirm("删除该配置？")&&Ie(`/api/storage/${x}`).then(()=>{e.show("success","已删除"),c()}).catch(()=>e.show("error","删除失败"))},g=x=>{p(x.id),o({name:x.name,storage_days:x.storage_days,enabled:x.enabled})},L=()=>{ae("/api/storage/run",{}).then(x=>e.show("success",`清理完成，删除 ${x.deleted_count} 条记录`)).catch(()=>e.show("error","清理失败"))};return(()=>{var x=Ni();return r(x,_(ie,{title:"存储策略列表",get extra(){return(()=>{var $=qi();return $.$$click=L,$})()},get children(){return B(()=>!!i())()?Ii():(()=>{var $=Pi(),v=$.firstChild,b=v.firstChild,k=b.nextSibling;return r(k,_(X,{get each(){return t()},children:S=>(()=>{var w=Oi(),P=w.firstChild,D=P.nextSibling,M=D.nextSibling,j=M.nextSibling,O=j.firstChild,U=j.nextSibling,W=U.firstChild,F=W.nextSibling;return r(P,()=>S.id),r(D,()=>S.name),r(M,()=>S.storage_days),r(O,()=>S.enabled===1?"启用":"禁用"),W.$$click=()=>g(S),F.$$click=()=>d(S.id),m(()=>fe(O,`badge ${S.enabled===1?"badge-running":"badge-stopped"}`)),w})()}),null),r(k,_(X,{get each(){return t().length===0?[1]:[]},children:()=>Mi()}),null),$})()}}),null),r(x,_(ie,{get title(){return a()?"编辑存储策略":"新增存储策略"},get children(){var $=Di(),v=$.firstChild,b=v.firstChild,k=b.nextSibling,S=v.nextSibling,w=S.firstChild,P=w.nextSibling,D=S.nextSibling,M=D.firstChild,j=M.nextSibling;return $.addEventListener("submit",C),k.$$input=O=>o({...n(),name:O.target.value}),P.$$input=O=>o({...n(),storage_days:+O.target.value}),r(M,(()=>{var O=B(()=>!!u());return()=>O()?"保存中...":a()?"保存":"创建"})()),j.$$click=()=>{o(ot),p(null)},m(()=>M.disabled=u()),m(()=>k.value=n().name),m(()=>P.value=n().storage_days),$}}),null),x})()}re(["input","click"]);function Wi(){return _(ji,{})}var Fi=f("<div><main class=container style=padding-top:32px;padding-bottom:32px></main><div id=toast-container class=toast-container>");function Bi(){const[e,t]=bl(),[l,i]=y(!0);Z(()=>{e()!=="/login"&&Y("/api/status").then(()=>i(!0)).catch(()=>{i(!1),Ut("/login")})});const s=()=>{const n=e();switch(!0){case n==="/login":return _(Xl,{onSuccess:()=>t("/")});case n==="/":return _(At,{});case n.startsWith("/gateway"):return _(nn,{});case n.startsWith("/resources"):return _(pn,{});case n.startsWith("/devices"):return _(Pn,{});case n.startsWith("/drivers"):return _(Un,{});case n.startsWith("/northbound"):return _(Yn,{});case n.startsWith("/storage"):return _(Wi,{});case n.startsWith("/thresholds"):return _(oi,{});case n.startsWith("/alarms"):return _($i,{});case n.startsWith("/realtime"):return _(wi,{});case n.startsWith("/history"):return _(Ai,{});default:return _(At,{})}};return(()=>{var n=Fi(),o=n.firstChild;return r(n,_(R,{get when(){return e()!=="/login"},get children(){return _(Tl,{get path(){return e()},onNav:t})}}),o),r(o,s),n})()}const Dt=document.getElementById("app-root");Dt&&Wt(()=>_(Bi,{}),Dt);const Ri={};typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-solid-island]").forEach(e=>{const t=e.getAttribute("data-solid-island"),l=Ri[t];if(!l)return;const i=e.dataset.props?JSON.parse(e.dataset.props):{};Wt(()=>_(l,i),e)})});
