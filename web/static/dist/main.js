const ll=(e,t)=>e===t,nl=Symbol("solid-track"),Ye={equals:ll};let Dt=Pt;const we=1,Ze=2,Nt={owned:null,cleanups:null,context:null,owner:null};var z=null;let st=null,il=null,H=null,ie=null,ve=null,nt=0;function Xe(e,t){const l=H,i=z,s=e.length===0,n=t===void 0?i:t,o=s?Nt:{owned:null,cleanups:null,context:n?n.context:null,owner:n},a=s?e:()=>e(()=>Ee(()=>je(o)));z=o,H=null;try{return Fe(a,!0)}finally{H=l,z=i}}function y(e,t){t=t?Object.assign({},Ye,t):Ye;const l={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=s=>(typeof s=="function"&&(s=s(l.value)),It(l,s));return[qt.bind(l),i]}function m(e,t,l){const i=ct(e,t,!1,we);Re(i)}function Y(e,t,l){Dt=al;const i=ct(e,t,!1,we);i.user=!0,ve?ve.push(i):Re(i)}function Me(e,t,l){l=l?Object.assign({},Ye,l):Ye;const i=ct(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=l.equals||void 0,Re(i),qt.bind(i)}function Ee(e){if(H===null)return e();const t=H;H=null;try{return e()}finally{H=t}}function We(e){return z===null||(z.cleanups===null?z.cleanups=[e]:z.cleanups.push(e)),e}function qt(){if(this.sources&&this.state)if(this.state===we)Re(this);else{const e=ie;ie=null,Fe(()=>tt(this),!1),ie=e}if(H){const e=this.observers?this.observers.length:0;H.sources?(H.sources.push(this),H.sourceSlots.push(e)):(H.sources=[this],H.sourceSlots=[e]),this.observers?(this.observers.push(H),this.observerSlots.push(H.sources.length-1)):(this.observers=[H],this.observerSlots=[H.sources.length-1])}return this.value}function It(e,t,l){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&Fe(()=>{for(let s=0;s<e.observers.length;s+=1){const n=e.observers[s],o=st&&st.running;o&&st.disposed.has(n),(o?!n.tState:!n.state)&&(n.pure?ie.push(n):ve.push(n),n.observers&&Ot(n)),o||(n.state=we)}if(ie.length>1e6)throw ie=[],new Error},!1)),t}function Re(e){if(!e.fn)return;je(e);const t=nt;rl(e,e.value,t)}function rl(e,t,l){let i;const s=z,n=H;H=z=e;try{i=e.fn(t)}catch(o){return e.pure&&(e.state=we,e.owned&&e.owned.forEach(je),e.owned=null),e.updatedAt=l+1,Mt(o)}finally{H=n,z=s}(!e.updatedAt||e.updatedAt<=l)&&(e.updatedAt!=null&&"observers"in e?It(e,i):e.value=i,e.updatedAt=l)}function ct(e,t,l,i=we,s){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:z,context:z?z.context:null,pure:l};return z===null||z!==Nt&&(z.owned?z.owned.push(n):z.owned=[n]),n}function et(e){if(e.state===0)return;if(e.state===Ze)return tt(e);if(e.suspense&&Ee(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<nt);)e.state&&t.push(e);for(let l=t.length-1;l>=0;l--)if(e=t[l],e.state===we)Re(e);else if(e.state===Ze){const i=ie;ie=null,Fe(()=>tt(e,t[0]),!1),ie=i}}function Fe(e,t){if(ie)return e();let l=!1;t||(ie=[]),ve?l=!0:ve=[],nt++;try{const i=e();return sl(l),i}catch(i){l||(ve=null),ie=null,Mt(i)}}function sl(e){if(ie&&(Pt(ie),ie=null),e)return;const t=ve;ve=null,t.length&&Fe(()=>Dt(t),!1)}function Pt(e){for(let t=0;t<e.length;t++)et(e[t])}function al(e){let t,l=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[l++]=i:et(i)}for(t=0;t<l;t++)et(e[t])}function tt(e,t){e.state=0;for(let l=0;l<e.sources.length;l+=1){const i=e.sources[l];if(i.sources){const s=i.state;s===we?i!==t&&(!i.updatedAt||i.updatedAt<nt)&&et(i):s===Ze&&tt(i,t)}}}function Ot(e){for(let t=0;t<e.observers.length;t+=1){const l=e.observers[t];l.state||(l.state=Ze,l.pure?ie.push(l):ve.push(l),l.observers&&Ot(l))}}function je(e){let t;if(e.sources)for(;e.sources.length;){const l=e.sources.pop(),i=e.sourceSlots.pop(),s=l.observers;if(s&&s.length){const n=s.pop(),o=l.observerSlots.pop();i<s.length&&(n.sourceSlots[o]=i,s[i]=n,l.observerSlots[i]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)je(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)je(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function ol(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Mt(e,t=z){throw ol(e)}const cl=Symbol("fallback");function kt(e){for(let t=0;t<e.length;t++)e[t]()}function dl(e,t,l={}){let i=[],s=[],n=[],o=0,a=t.length>1?[]:null;return We(()=>kt(n)),()=>{let p=e()||[],u=p.length,h,c;return p[nl],Ee(()=>{let d,g,E,x,$,v,b,k,S;if(u===0)o!==0&&(kt(n),n=[],i=[],s=[],o=0,a&&(a=[])),l.fallback&&(i=[cl],s[0]=Xe(w=>(n[0]=w,l.fallback())),o=1);else if(o===0){for(s=new Array(u),c=0;c<u;c++)i[c]=p[c],s[c]=Xe(C);o=u}else{for(E=new Array(u),x=new Array(u),a&&($=new Array(u)),v=0,b=Math.min(o,u);v<b&&i[v]===p[v];v++);for(b=o-1,k=u-1;b>=v&&k>=v&&i[b]===p[k];b--,k--)E[k]=s[b],x[k]=n[b],a&&($[k]=a[b]);for(d=new Map,g=new Array(k+1),c=k;c>=v;c--)S=p[c],h=d.get(S),g[c]=h===void 0?-1:h,d.set(S,c);for(h=v;h<=b;h++)S=i[h],c=d.get(S),c!==void 0&&c!==-1?(E[c]=s[h],x[c]=n[h],a&&($[c]=a[h]),c=g[c],d.set(S,c)):n[h]();for(c=v;c<u;c++)c in E?(s[c]=E[c],n[c]=x[c],a&&(a[c]=$[c],a[c](c))):s[c]=Xe(C);s=s.slice(0,o=u),i=p.slice(0)}return s});function C(d){if(n[c]=d,a){const[g,E]=y(c);return a[c]=E,t(p[c],g)}return t(p[c])}}}function _(e,t){return Ee(()=>e(t||{}))}const ul=e=>`Stale read from <${e}>.`;function Q(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Me(dl(()=>e.each,e.children,t||void 0))}function V(e){const t=e.keyed,l=Me(()=>e.when,void 0,void 0),i=t?l:Me(l,void 0,{equals:(s,n)=>!s==!n});return Me(()=>{const s=i();if(s){const n=e.children;return typeof n=="function"&&n.length>0?Ee(()=>n(t?s:()=>{if(!Ee(i))throw ul("Show");return l()})):n}return e.fallback},void 0,void 0)}const B=e=>Me(()=>e());function hl(e,t,l){let i=l.length,s=t.length,n=i,o=0,a=0,p=t[s-1].nextSibling,u=null;for(;o<s||a<n;){if(t[o]===l[a]){o++,a++;continue}for(;t[s-1]===l[n-1];)s--,n--;if(s===o){const h=n<i?a?l[a-1].nextSibling:l[n-a]:p;for(;a<n;)e.insertBefore(l[a++],h)}else if(n===a)for(;o<s;)(!u||!u.has(t[o]))&&t[o].remove(),o++;else if(t[o]===l[n-1]&&l[a]===t[s-1]){const h=t[--s].nextSibling;e.insertBefore(l[a++],t[o++].nextSibling),e.insertBefore(l[--n],h),t[s]=l[n]}else{if(!u){u=new Map;let c=a;for(;c<n;)u.set(l[c],c++)}const h=u.get(t[o]);if(h!=null)if(a<h&&h<n){let c=o,C=1,d;for(;++c<s&&c<n&&!((d=u.get(t[c]))==null||d!==h+C);)C++;if(C>h-a){const g=t[o];for(;a<h;)e.insertBefore(l[a++],g)}else e.replaceChild(l[a++],t[o++])}else o++;else t[o++].remove()}}}const Et="_$DX_DELEGATE";function jt(e,t,l,i={}){let s;return Xe(n=>{s=n,t===document?e():r(t,e(),t.firstChild?null:void 0,l)},i.owner),()=>{s(),t.textContent=""}}function f(e,t,l,i){let s;const n=()=>{const a=document.createElement("template");return a.innerHTML=e,a.content.firstChild},o=()=>(s||(s=n())).cloneNode(!0);return o.cloneNode=o,o}function se(e,t=window.document){const l=t[Et]||(t[Et]=new Set);for(let i=0,s=e.length;i<s;i++){const n=e[i];l.has(n)||(l.add(n),t.addEventListener(n,gl))}}function ue(e,t,l){l==null?e.removeAttribute(t):e.setAttribute(t,l)}function fe(e,t){t==null?e.removeAttribute("class"):e.className=t}function fl(e,t,l){if(!t)return l?ue(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof l=="string"&&(i.cssText=l=void 0),l||(l={}),t||(t={});let s,n;for(n in l)t[n]==null&&i.removeProperty(n),delete l[n];for(n in t)s=t[n],s!==l[n]&&(i.setProperty(n,s),l[n]=s);return l}function pl(e,t,l){return Ee(()=>e(t,l))}function r(e,t,l,i){if(l!==void 0&&!i&&(i=[]),typeof t!="function")return lt(e,t,i,l);m(s=>lt(e,t(),s,l),i)}function gl(e){let t=e.target;const l=`$$${e.type}`,i=e.target,s=e.currentTarget,n=p=>Object.defineProperty(e,"target",{configurable:!0,value:p}),o=()=>{const p=t[l];if(p&&!t.disabled){const u=t[`${l}Data`];if(u!==void 0?p.call(t,u,e):p.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},a=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const p=e.composedPath();n(p[0]);for(let u=0;u<p.length-2&&(t=p[u],!!o());u++){if(t._$host){t=t._$host,a();break}if(t.parentNode===s)break}}else a();n(i)}function lt(e,t,l,i,s){for(;typeof l=="function";)l=l();if(t===l)return l;const n=typeof t,o=i!==void 0;if(e=o&&l[0]&&l[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===l))return l;if(o){let a=l[0];a&&a.nodeType===3?a.data!==t&&(a.data=t):a=document.createTextNode(t),l=Ne(e,l,i,a)}else l!==""&&typeof l=="string"?l=e.firstChild.data=t:l=e.textContent=t}else if(t==null||n==="boolean")l=Ne(e,l,i);else{if(n==="function")return m(()=>{let a=t();for(;typeof a=="function";)a=a();l=lt(e,a,l,i)}),()=>l;if(Array.isArray(t)){const a=[],p=l&&Array.isArray(l);if(ot(a,t,l,s))return m(()=>l=lt(e,a,l,i,!0)),()=>l;if(a.length===0){if(l=Ne(e,l,i),o)return l}else p?l.length===0?Lt(e,a,i):hl(e,l,a):(l&&Ne(e),Lt(e,a));l=a}else if(t.nodeType){if(Array.isArray(l)){if(o)return l=Ne(e,l,i,t);Ne(e,l,null,t)}else l==null||l===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);l=t}}return l}function ot(e,t,l,i){let s=!1;for(let n=0,o=t.length;n<o;n++){let a=t[n],p=l&&l[e.length],u;if(!(a==null||a===!0||a===!1))if((u=typeof a)=="object"&&a.nodeType)e.push(a);else if(Array.isArray(a))s=ot(e,a,p)||s;else if(u==="function")if(i){for(;typeof a=="function";)a=a();s=ot(e,Array.isArray(a)?a:[a],Array.isArray(p)?p:[p])||s}else e.push(a),s=!0;else{const h=String(a);p&&p.nodeType===3&&p.data===h?e.push(p):e.push(document.createTextNode(h))}}return s}function Lt(e,t,l=null){for(let i=0,s=t.length;i<s;i++)e.insertBefore(t[i],l)}function Ne(e,t,l,i){if(l===void 0)return e.textContent="";const s=i||document.createTextNode("");if(t.length){let n=!1;for(let o=t.length-1;o>=0;o--){const a=t[o];if(s!==a){const p=a.parentNode===e;!n&&!o?p?e.replaceChild(s,a):e.insertBefore(s,l):p&&a.remove()}else n=!0}}else e.insertBefore(s,l);return[s]}const[Wt,Rt]=y(window.location.pathname||"/"),[$l,Ft]=y(new URLSearchParams(window.location.search));if(typeof window<"u"){const e=()=>{Rt(window.location.pathname||"/"),Ft(new URLSearchParams(window.location.search))};window.addEventListener("popstate",e),We(()=>window.removeEventListener("popstate",e))}function Bt(e,t={}){const l=Wt();e!==l&&(t.replace?window.history.replaceState({},"",e):window.history.pushState({},"",e),Rt(e),Ft(new URLSearchParams(window.location.search)),window.scrollTo({top:0,behavior:"smooth"}))}function vl(){return[Wt,Bt,$l]}function ye(e,t){return t==="/"?e==="/":String(e).startsWith(t)}const dt="gogw_jwt";function bl(){return localStorage.getItem(dt)||""}function ut(e={}){const t=bl();return t?{...e,Authorization:`Bearer ${t}`}:e}function _l(e){if(e.status===401)throw localStorage.removeItem(dt),window.location.href="/login",new Error("unauthorized")}async function Be(e,t={}){const l=await fetch(e,{credentials:"same-origin",headers:ut(t.headers),...t});return _l(l),l}async function Ue(e){if(e.status===204)return null;const t=await e.text();if(!t)return null;try{const l=JSON.parse(t);if(l&&typeof l=="object"&&"success"in l){if(l.success)return l.data??null;const i=l.error||l.message||"request failed";throw new Error(i)}return l}catch{throw new Error("invalid json")}}function ml(e){e&&localStorage.setItem(dt,e)}async function X(e,t={}){const l=await Be(e,t);if(!l.ok)throw new Error(`${l.status} ${l.statusText}`);return Ue(l)}async function oe(e,t,l={}){const i=await Be(e,{method:"POST",headers:ut({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ue(i)}async function Ge(e,t,l={}){const i=await Be(e,{method:"PUT",headers:ut({"Content-Type":"application/json",...l.headers||{}}),body:JSON.stringify(t),...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ue(i)}async function qe(e){const t=await Be(e,{method:"DELETE"});if(!t.ok&&t.status!==204)throw new Error(`${t.status} ${t.statusText}`);return t.status===204?null:Ue(t)}async function xl(e,t,l={}){const i=await Be(e,{method:"POST",body:t,...l});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);return Ue(i)}var yl=f("<div class=dropdown-menu>"),wl=f('<nav class=nav><div class="container nav-inner"><div class=nav-brand><svg class=nav-brand-icon viewBox="0 0 48 48"fill=none xmlns=http://www.w3.org/2000/svg><defs><linearGradient id=brandGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#3b82f6></stop><stop offset=100% style=stop-color:#8b5cf6></stop></linearGradient><linearGradient id=chipGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#06b6d4></stop><stop offset=100% style=stop-color:#22d3ee></stop></linearGradient></defs><rect x=4 y=4 width=40 height=40 rx=10 fill=url(#brandGradient) opacity=0.15></rect><rect x=4 y=4 width=40 height=40 rx=10 stroke=url(#brandGradient) stroke-width=2></rect><rect x=14 y=14 width=20 height=20 rx=4 fill=url(#chipGradient) opacity=0.9></rect><circle cx=18 cy=18 r=2 fill=white opacity=0.9></circle><circle cx=18 cy=30 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=18 r=2 fill=white opacity=0.6></circle><circle cx=30 cy=30 r=2 fill=white opacity=0.9></circle><path d="M24 10V14M24 34V38M10 24H14M34 24H38"stroke=url(#brandGradient) stroke-width=2 stroke-linecap=round></path></svg><div class=nav-brand-text><div class=nav-title><span class=brand-hu>Hu</span><span class=brand-shu>Shu</span><span class=brand-gateway>智能网关</span></div><div class=nav-subtitle><span class=subtitle-icon>◆</span>工业物联网网关管理平台</div></div></div><div class=nav-links><div class=dropdown><button><span class=nav-btn-icon>⚙</span>设置<span class=dropdown-arrow>▾</span></button></div><a class="nav-btn nav-btn-danger"href=/logout><span class=nav-btn-icon>⏻</span>退出'),Sl=f("<a><span class=nav-btn-icon>"),Cl=f("<a><span class=dropdown-item-icon>");const kl=[{to:"/",label:"仪表盘",icon:"◉"},{to:"/alarms",label:"报警",icon:"⚠"},{to:"/realtime",label:"实时",icon:"◈"},{to:"/history",label:"历史",icon:"▤"}],El=[{to:"/gateway",label:"网关设置",icon:"⚙"},{to:"/resources",label:"资源",icon:"◐"},{to:"/devices",label:"设备",icon:"◑"},{to:"/drivers",label:"驱动",icon:"▣"},{to:"/northbound",label:"北向",icon:"◉"},{to:"/storage",label:"存储策略",icon:"◫"},{to:"/thresholds",label:"阈值",icon:"◐"}];function Ll(e){const[t,l]=y(!1);let i;const s=a=>{localStorage.removeItem("gogw_jwt")},n=()=>{l(!1)},o=a=>{i&&!i.contains(a.target)&&l(!1)};return(()=>{var a=wl(),p=a.firstChild,u=p.firstChild,h=u.nextSibling,c=h.firstChild,C=c.firstChild,d=c.nextSibling;h.$$click=o,r(h,()=>kl.map(E=>(()=>{var x=Sl(),$=x.firstChild;return x.$$click=v=>{v.preventDefault(),e.onNav(E.to),n()},r($,()=>E.icon),r(x,()=>E.label,null),m(v=>{var b=E.to,k=E.to,S=`nav-btn ${ye(e.path,E.to)?"active":""}`;return b!==v.e&&ue(x,"key",v.e=b),k!==v.t&&ue(x,"href",v.t=k),S!==v.a&&fe(x,v.a=S),v},{e:void 0,t:void 0,a:void 0}),x})()),c);var g=i;return typeof g=="function"?pl(g,c):i=c,C.$$click=()=>l(!t()),r(c,_(V,{get when(){return t()},get children(){var E=yl();return r(E,()=>El.map(x=>(()=>{var $=Cl(),v=$.firstChild;return $.$$click=b=>{b.preventDefault(),e.onNav(x.to),n()},r(v,()=>x.icon),r($,()=>x.label,null),m(b=>{var k=x.to,S=x.to,w=`dropdown-item ${ye(e.path,x.to)?"active":""}`;return k!==b.e&&ue($,"key",b.e=k),S!==b.t&&ue($,"href",b.t=S),w!==b.a&&fe($,b.a=w),b},{e:void 0,t:void 0,a:void 0}),$})())),E}}),null),d.$$click=E=>{E.preventDefault(),s(),e.onNav("/login")},m(()=>fe(C,`nav-btn dropdown-toggle ${ye(e.path,"/resources")||ye(e.path,"/devices")||ye(e.path,"/drivers")||ye(e.path,"/northbound")||ye(e.path,"/storage")||ye(e.path,"/thresholds")?"active":""}`)),a})()}se(["click"]);var Tl=f("<div class=card><div class=card-body>"),Al=f("<div class=card-header>"),Dl=f("<h3 class=card-title>"),Nl=f("<div class=card-extra>");function re(e){return(()=>{var t=Tl(),l=t.firstChild;return r(t,(()=>{var i=B(()=>!!(e.title||e.extra));return()=>i()&&(()=>{var s=Al();return r(s,(()=>{var n=B(()=>!!e.title);return()=>n()&&(()=>{var o=Dl();return r(o,()=>e.title),o})()})(),null),r(s,(()=>{var n=B(()=>!!e.extra);return()=>n()&&(()=>{var o=Nl();return r(o,()=>e.extra),o})()})(),null),s})()})(),l),r(l,()=>e.children),m(i=>fl(t,e.style||"",i)),t})()}se(["click"]);function ce(){return{show:(e,t)=>{typeof window<"u"&&window.toast&&window.toast.show(e,t)}}}se(["click"]);var ql=f("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Il=f("<button class=btn>刷新"),Pl=f("<tr><td></td><td></td><td></td><td>"),Ol=f("<tr><td colspan=4 style=text-align:center;padding:16px;color:var(--text-muted)>暂无数据");function Ml(){const e=ce(),[t,l]=y([]),i=()=>{X("/api/data/points").then(s=>l((s.data||s).slice(0,8))).catch(()=>e.show("error","加载实时数据失败"))};return Y(()=>{i();const s=setInterval(i,4e3);We(()=>clearInterval(s))}),_(re,{title:"最新采集",get extra(){return(()=>{var s=Il();return s.$$click=i,s})()},get children(){var s=ql(),n=s.firstChild,o=n.firstChild,a=o.nextSibling;return r(a,_(Q,{get each(){return t()},children:p=>(()=>{var u=Pl(),h=u.firstChild,c=h.nextSibling,C=c.nextSibling,d=C.nextSibling;return r(h,()=>{var g;return((g=p.collected_at)==null?void 0:g.slice(5,19))||p.CollectedAt}),r(c,()=>p.device_name||p.DeviceName),r(C,()=>p.field_name||p.FieldName),r(d,()=>p.value||p.Value),m(()=>ue(u,"key",p.id||`${p.device_id}-${p.field_name}-${p.collected_at}`)),u})()}),null),r(a,_(Q,{get each(){return t().length===0?[1]:[]},children:()=>Ol()}),null),s}})}se(["click"]);var jl=f("<div class=table-container style=max-height:320px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th><th>阈值</th><th>级别</th><th></th></tr></thead><tbody>"),Wl=f("<button class=btn>刷新"),Rl=f('<button class="btn btn-primary"style="padding:6px 10px">确认'),Fl=f('<span class="text-muted text-xs">已确认'),Bl=f("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td>"),Ul=f("<tr><td colspan=7 style=text-align:center;padding:16px;color:var(--text-muted)>暂无告警");function Gl(){const e=ce(),[t,l]=y([]),i=()=>{X("/api/alarms").then(n=>l((n.data||n).slice(0,8))).catch(()=>e.show("error","加载告警失败"))};Y(()=>{i()});const s=n=>{oe(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return _(re,{title:"最近告警",get extra(){return(()=>{var n=Wl();return n.$$click=i,n})()},get children(){var n=jl(),o=n.firstChild,a=o.firstChild,p=a.nextSibling;return r(p,_(Q,{get each(){return t()},children:u=>(()=>{var h=Bl(),c=h.firstChild,C=c.nextSibling,d=C.nextSibling,g=d.nextSibling,E=g.nextSibling,x=E.nextSibling,$=x.firstChild,v=x.nextSibling;return r(c,()=>{var b;return((b=u.triggered_at)==null?void 0:b.slice(5,19))||u.triggered_at}),r(C,()=>u.device_id),r(d,()=>u.field_name),r(g,()=>u.actual_value),r(E,()=>`${u.operator} ${u.threshold_value}`),r($,()=>u.severity||"warn"),r(v,_(V,{get when(){return u.acknowledged!==1},get children(){var b=Rl();return b.$$click=()=>s(u.id),b}}),null),r(v,_(V,{get when(){return u.acknowledged===1},get children(){return Fl()}}),null),m(()=>fe($,`badge ${u.severity==="critical"?"badge-critical":"badge-running"}`)),h})()}),null),r(p,_(Q,{get each(){return t().length===0?[1]:[]},children:()=>Ul()}),null),n}})}se(["click"]);var Kl=f("<div class=flex style=gap:12px;flex-wrap:wrap><button>");function Hl(e){const t=ce(),[l,i]=y(!1),s=()=>{i(!0);const n=e.collectorRunning?"/api/collector/stop":"/api/collector/start";oe(n,{}).then(()=>{var o;t.show("success",e.collectorRunning?"已停止采集":"已启动采集"),(o=e.onRefresh)==null||o.call(e)}).catch(()=>t.show("error","操作失败")).finally(()=>i(!1))};return _(re,{title:"快捷操作",get children(){var n=Kl(),o=n.firstChild;return o.$$click=s,r(o,()=>e.collectorRunning?"停止采集器":"启动采集器"),m(a=>{var p=`btn ${e.collectorRunning?"btn-danger":"btn-success"}`,u=l();return p!==a.e&&fe(o,a.e=p),u!==a.t&&(o.disabled=a.t=u),a},{e:void 0,t:void 0}),n}})}se(["click"]);var Vl=f('<div><div class=grid style="grid-template-columns:2fr 1fr;gap:24px"><div class=grid style=grid-template-columns:1fr;gap:24px></div><div class=grid style=grid-template-columns:1fr;gap:24px>');function Tt(){const[e,t]=y(null),[l,i]=y(!0),s=()=>{X("/api/status").then(n=>t(n.data||n)).catch(()=>{}).finally(()=>i(!1))};return Y(()=>{s();const n=setInterval(s,5e3);We(()=>clearInterval(n))}),(()=>{var n=Vl(),o=n.firstChild,a=o.firstChild,p=a.nextSibling;return r(n,_(re,{get data(){return e()},get loading(){return l()}}),o),r(a,_(Ml,{}),null),r(a,_(Gl,{}),null),r(p,_(Hl,{get collectorRunning(){var u;return(u=e())==null?void 0:u.collector_running},onRefresh:s})),n})()}var Jl=f('<div class=container style=max-width:420px;margin-top:48px><div class=card><div class=card-header><h3 class=card-title>登录</h3></div><form class=form><div class=form-group><label class=form-label>用户名</label><input class=form-input required></div><div class=form-group><label class=form-label>密码</label><input class=form-input type=password required></div><button class="btn btn-primary"type=submit style=width:100%;margin-top:8px>'),zl=f('<div style="color:var(--accent-red);padding:8px 0">');function Ql(e){const[t,l]=y("admin"),[i,s]=y("123456"),[n,o]=y(""),[a,p]=y(!1),u=h=>{h.preventDefault(),p(!0),o(""),oe("/login",{username:t(),password:i()}).then(c=>{ml(c.token),window.location.replace("/")}).catch(()=>o("用户名或密码错误")).finally(()=>p(!1))};return(()=>{var h=Jl(),c=h.firstChild,C=c.firstChild,d=C.nextSibling,g=d.firstChild,E=g.firstChild,x=E.nextSibling,$=g.nextSibling,v=$.firstChild,b=v.nextSibling,k=$.nextSibling;return d.addEventListener("submit",u),x.$$input=S=>l(S.target.value),b.$$input=S=>s(S.target.value),r(d,(()=>{var S=B(()=>!!n());return()=>S()&&(()=>{var w=zl();return r(w,n),w})()})(),k),r(k,()=>a()?"登录中...":"登录"),m(()=>k.disabled=a()),m(()=>x.value=t()),m(()=>b.value=i()),h})()}se(["input"]);var Xl=f("<div style=text-align:center;padding:40px;color:var(--text-muted)>加载中..."),Yl=f('<div style="color:var(--accent-red);padding:4px 0">'),Zl=f('<form class=form style=max-width:480px><div class=form-group><label class=form-label>网关名称</label><input class=form-input placeholder=网关名称></div><div class=form-group><label class=form-label>ProductKey <span style=color:var(--text-muted);font-weight:normal>(产品标识)</span></label><input class=form-input placeholder=请输入产品密钥><div class=form-hint>用于北向平台身份认证</div></div><div class=form-group><label class=form-label>DeviceKey <span style=color:var(--text-muted);font-weight:normal>(设备标识)</span></label><input class=form-input placeholder=请输入设备密钥><div class=form-hint>用于北向平台设备认证</div></div><div class=flex style=gap:8px;marginTop:16px><button type=submit class="btn btn-primary">'),en=f("<div style=color:var(--text-secondary);font-size:0.875rem;line-height:1.8><p><strong>ProductKey</strong>：网关产品的唯一标识符，用于区分不同型号的网关产品。</p><p><strong>DeviceKey</strong>：网关设备的唯一标识符，用于在同一产品下区分不同设备。</p><p>这两个密钥将在数据上报到北向平台时使用，用于设备认证和数据路由。"),tn=f("<div>");function ln(){const e=ce(),[t,l]=y({product_key:"",device_key:"",gateway_name:"HuShu智能网关"}),[i,s]=y(!0),[n,o]=y(!1),[a,p]=y(""),u=()=>{s(!0),X("/api/gateway/config").then(c=>{l({product_key:c.product_key||"",device_key:c.device_key||"",gateway_name:c.gateway_name||"HuShu智能网关"})}).catch(()=>e.show("error","加载网关配置失败")).finally(()=>s(!1))};Y(()=>{u()});const h=c=>{c.preventDefault(),o(!0),p(""),Ge("/api/gateway/config",t()).then(()=>{e.show("success","网关配置已保存")}).catch(C=>{p(C.message||"保存失败"),e.show("error","保存失败")}).finally(()=>o(!1))};return(()=>{var c=tn();return r(c,_(re,{title:"网关设置",get children(){return[_(V,{get when(){return i()},get children(){return Xl()}}),_(V,{get when(){return!i()},get children(){var C=Zl(),d=C.firstChild,g=d.firstChild,E=g.nextSibling,x=d.nextSibling,$=x.firstChild,v=$.nextSibling,b=x.nextSibling,k=b.firstChild,S=k.nextSibling,w=b.nextSibling,P=w.firstChild;return C.addEventListener("submit",h),E.$$input=A=>l({...t(),gateway_name:A.target.value}),v.$$input=A=>l({...t(),product_key:A.target.value}),S.$$input=A=>l({...t(),device_key:A.target.value}),r(C,_(V,{get when(){return a()},get children(){var A=Yl();return r(A,a),A}}),w),r(P,()=>n()?"保存中...":"保存配置"),m(()=>P.disabled=n()),m(()=>E.value=t().gateway_name),m(()=>v.value=t().product_key),m(()=>S.value=t().device_key),C}})]}}),null),r(c,_(re,{title:"说明",style:"margin-top:16px;",get children(){return en()}}),null),c})()}se(["input"]);var nn=f("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无资源"),rn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>路径</th><th>状态</th><th>操作</th></tr></thead><tbody>"),sn=f('<input class=form-input placeholder="如 192.168.1.100:502"required>'),an=f('<div style="color:var(--accent-red);padding:4px 0">'),on=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:420px;max-width:90vw><div class=card-header><h3 class=card-title></h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=serial>串口</option><option value=net>网口 (TCP)</option><option value=di>DI</option><option value=do>DO</option></select></div><div class=form-group><label class=form-label>路径</label></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),cn=f("<div>"),dn=f('<button class="btn btn-primary">新增资源'),un=f('<tr><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除'),hn=f('<input class=form-input placeholder="如 /dev/ttyUSB0"required>');const ze={name:"",type:"serial",path:"",enabled:1};function fn(){const e=ce(),[t,l]=y([]),[i,s]=y(ze),[n,o]=y(null),[a,p]=y(!1),[u,h]=y(!1),[c,C]=y(""),d=()=>{X("/api/resources").then($=>l($.data||$)).catch(()=>e.show("error","加载资源失败"))};Y(()=>{d()}),Y(()=>{if(!a())return;const $=v=>{v.key==="Escape"&&p(!1)};window.addEventListener("keydown",$),We(()=>window.removeEventListener("keydown",$))});const g=$=>{$.preventDefault(),h(!0),C(""),(n()?Ge(`/api/resources/${n()}`,i()):oe("/api/resources",i())).then(()=>{e.show("success",n()?"资源已更新":"资源已创建"),s(ze),o(null),p(!1),d()}).catch(b=>{C(b.message||"保存失败"),e.show("error","保存失败")}).finally(()=>h(!1))},E=$=>{confirm("删除该资源？")&&confirm("删除后关联设备可能需要重新绑定资源，确认继续？")&&qe(`/api/resources/${$}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))},x=$=>{oe(`/api/resources/${$.id}/toggle`,{}).then(d).catch(()=>e.show("error","切换失败"))};return(()=>{var $=cn();return r($,_(re,{title:"资源列表",get extra(){return(()=>{var v=dn();return v.$$click=()=>{s(ze),o(null),C(""),p(!0)},v})()},get children(){var v=rn(),b=v.firstChild,k=b.firstChild,S=k.nextSibling;return r(S,_(Q,{get each(){return t()},children:w=>(()=>{var P=un(),A=P.firstChild,j=A.nextSibling,F=j.nextSibling,O=F.nextSibling,U=O.nextSibling,W=U.firstChild,G=U.nextSibling,J=G.firstChild,Z=J.nextSibling,N=Z.nextSibling;return r(A,()=>w.id),r(j,()=>w.name),r(F,()=>w.type),r(O,()=>w.path),r(W,()=>w.enabled===1?"启用":"禁用"),J.$$click=()=>{o(w.id),s({name:w.name,type:w.type,path:w.path,enabled:w.enabled}),C(""),p(!0)},Z.$$click=()=>x(w),r(Z,()=>w.enabled===1?"禁用":"启用"),N.$$click=()=>E(w.id),m(()=>fe(W,`badge ${w.enabled===1?"badge-running":"badge-stopped"}`)),P})()}),null),r(S,_(V,{get when(){return t().length===0},get children(){return nn()}}),null),v}}),null),r($,_(V,{get when(){return a()},get children(){var v=on(),b=v.firstChild,k=b.firstChild,S=k.firstChild,w=k.nextSibling,P=w.firstChild,A=P.firstChild,j=A.nextSibling,F=P.nextSibling,O=F.firstChild,U=O.nextSibling,W=F.nextSibling;W.firstChild;var G=W.nextSibling,J=G.firstChild,Z=J.nextSibling;return v.$$click=N=>{N.target===N.currentTarget&&p(!1)},r(S,()=>n()?"编辑资源":"新增资源"),w.addEventListener("submit",g),j.$$input=N=>s({...i(),name:N.target.value}),U.addEventListener("change",N=>s({...i(),type:N.target.value})),r(W,_(V,{get when(){return i().type==="net"},get fallback(){return(()=>{var N=hn();return N.$$input=le=>s({...i(),path:le.target.value}),m(()=>N.value=i().path),N})()},get children(){var N=sn();return N.$$input=le=>s({...i(),path:le.target.value}),m(()=>N.value=i().path),N}}),null),r(w,_(V,{get when(){return c()},get children(){var N=an();return r(N,c),N}}),G),J.$$click=()=>{p(!1),o(null),s(ze)},r(Z,(()=>{var N=B(()=>!!u());return()=>N()?"保存中...":n()?"保存":"创建"})()),m(N=>{var le=u(),ae=u();return le!==N.e&&(J.disabled=N.e=le),ae!==N.t&&(Z.disabled=N.t=ae),N},{e:void 0,t:void 0}),m(()=>j.value=i().name),m(()=>U.value=i().type),v}}),null),$})()}se(["click","input"]);var pn=f('<div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>波特率</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>校验位</label><select class=form-select><option value=N>None</option><option value=E>Even</option><option value=O>Odd</option></select></div><div class=form-group><label class=form-label>数据位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>停止位</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>设备地址</label><input class=form-input required>'),gn=f('<div class=grid style="grid-template-columns:repeat(1, 1fr);gap:12px"><div class=form-group><label class=form-label>设备地址</label><input class=form-input required>'),$n=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:auto;padding:24px><div class=card style=width:720px;max-width:100%><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:0 4px"><div class=grid style="grid-template-columns:repeat(2, 1fr);gap:12px"><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>描述</label><input class=form-input></div><div class=form-group><label class=form-label>ProductKey</label><input class=form-input placeholder="子设备 productKey"></div><div class=form-group><label class=form-label>DeviceKey</label><input class=form-input placeholder="子设备 deviceKey"></div><div class=form-group><label class=form-label>选择驱动 <span style=color:var(--accent-red)>*</span></label><select class=form-select required><option value>请选择驱动</option></select></div><div class=form-group><label class=form-label>绑定资源</label><select class=form-select><option value>请选择资源</option></select></div></div><div class=form-group><label class=form-label>驱动类型</label><select class=form-select><option value=modbus_rtu_wasm>ModbusRtu / Wasm</option><option value=modbus_tcp_wasm>ModbusTcp / Wasm</option><option value=modbus_rtu_excel>ModbusRtu / Excel</option><option value=modbus_tcp_excel>ModbusTcp / Excel</option></select></div><div class=grid style="grid-template-columns:repeat(3, 1fr);gap:12px"><div class=form-group><label class=form-label>采集周期(ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>超时(ms)</label><input class=form-input type=number required></div><div class=form-group><label class=form-label>状态</label><select class=form-select><option value=1>启用</option><option value=0>禁用</option></select></div></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:16px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),vn=f('<div style="color:var(--accent-red);padding:4px 0">'),bn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1001><div class=card style=width:400px;max-width:90vw><div class=card-header><h3 class=card-title>写入数据 - </h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style=padding:16px><div class=form-group><label class=form-label>字段</label><select class=form-select></select></div><div class=form-group><label class=form-label>值</label><input class=form-input type=number required></div><div class=flex style=gap:8px;marginTop:12px><button type=button class=btn style=flex:1>取消</button><button type=submit class="btn btn-primary"style=flex:1>写入'),_n=f("<div>"),mn=f('<div class="flex gap-3"><input class=form-input placeholder=搜索设备/地址/驱动 style=max-width:240px><button class=btn>刷新</button><button class="btn btn-primary">新增设备'),xn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),yn=f('<div style="color:var(--accent-red);padding:16px 0">'),wn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>驱动类型</th><th>驱动</th><th>资源</th><th>周期(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Sn=f('<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:4px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger"style=padding-left:8px;padding-right:8px>删'),Cn=f('<div><div></div><div class="text-muted text-xs">'),kn=f("<span style=color:var(--text-muted)>-"),En=f("<tr><td colspan=8 style=text-align:center;padding:24px;color:var(--text-muted)>暂无设备"),Ln=f("<option> (v<!>)"),Tn=f("<option> (<!>) "),An=f("<option>");const Pe={name:"",description:"",product_key:"",device_key:"",driver_id:null,driver_type:"modbus_rtu_wasm",serial_port:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",ip_address:"",port_num:502,device_address:"1",collect_interval:1e3,timeout:1e3,resource_id:null,enabled:1};function Dn(){const e=ce(),[t,l]=y([]),[i,s]=y([]),[n,o]=y([]),[a,p]=y(!0),[u,h]=y(""),[c,C]=y(""),[d,g]=y(Pe),[E,x]=y(null),[$,v]=y(!1),[b,k]=y(!1),[S,w]=y(!1),[P]=y([]),[A,j]=y({field:"",value:""}),[F,O]=y(""),[U]=y(null),W=()=>{p(!0),Promise.all([X("/api/devices"),X("/api/resources"),X("/api/drivers")]).then(([T,q,R])=>{l(T.data||T),s(q.data||q),o((R.data||R).filter(ee=>ee.enabled===1)),h("")}).catch(()=>h("加载设备、资源或驱动失败")).finally(()=>p(!1))};Y(()=>{W()}),Y(()=>{if(!$())return;const T=q=>{q.key==="Escape"&&v(!1)};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)});const G=()=>{const T=c().trim().toLowerCase();return T?t().filter(q=>[q.name,q.device_address,q.driver_type,q.driver_name].filter(Boolean).some(R=>R.toLowerCase().includes(T))):t()},J=T=>{T.preventDefault(),k(!0),(E()?Ge(`/api/devices/${E()}`,d()):oe("/api/devices",d())).then(()=>{e.show("success",E()?"设备已更新":"设备已创建"),g(Pe),x(null),v(!1),W()}).catch(()=>e.show("error","操作失败")).finally(()=>k(!1))},Z=T=>{oe(`/api/devices/${T}/toggle`,{}).then(W).catch(()=>e.show("error","切换失败"))},N=T=>{confirm("确定删除该设备？")&&qe(`/api/devices/${T}`).then(()=>{e.show("success","已删除"),W()}).catch(()=>e.show("error","删除失败"))},le=T=>{T.preventDefault(),O(""),oe(`/api/devices/${U().id}/write`,A()).then(()=>{e.show("success","写入成功"),w(!1)}).catch(q=>O(q.message||"写入失败"))},ae=()=>{g(Pe),x(null),v(!0)},be=T=>{x(T.id),g({name:T.name,description:T.description||"",product_key:T.product_key||"",device_key:T.device_key||"",driver_id:T.driver_id,driver_type:T.driver_type||"modbus_rtu_wasm",serial_port:T.serial_port||"",baud_rate:T.baud_rate||9600,data_bits:T.data_bits||8,stop_bits:T.stop_bits||1,parity:T.parity||"N",ip_address:T.ip_address||"",port_num:T.port_num||502,device_address:T.device_address||"1",collect_interval:T.collect_interval||1e3,timeout:T.timeout||1e3,resource_id:T.resource_id,enabled:T.enabled}),v(!0)},Le=()=>{var T,q;return i().length?(T=d().driver_type)!=null&&T.startsWith("modbus_rtu")?i().filter(R=>R.type==="serial"):(q=d().driver_type)!=null&&q.startsWith("modbus_tcp")?i().filter(R=>R.type==="net"):i():[]};return(()=>{var T=_n();return r(T,_(re,{title:"设备列表",get extra(){return(()=>{var q=mn(),R=q.firstChild,ee=R.nextSibling,I=ee.nextSibling;return R.$$input=M=>C(M.target.value),ee.$$click=W,I.$$click=ae,m(()=>R.value=c()),q})()},get children(){return B(()=>!!a())()?xn():B(()=>!!u())()?(()=>{var q=yn();return r(q,u),q})():(()=>{var q=wn(),R=q.firstChild,ee=R.firstChild,I=ee.nextSibling;return r(I,_(Q,{get each(){return G()},children:M=>(()=>{var D=Sn(),ne=D.firstChild,pe=ne.nextSibling,_e=pe.nextSibling,me=_e.nextSibling,Se=me.nextSibling,Ce=Se.nextSibling,xe=Ce.nextSibling,ke=xe.firstChild,te=xe.nextSibling,ge=te.firstChild,Te=ge.nextSibling,it=Te.nextSibling;return r(ne,()=>M.id),r(pe,()=>M.name),r(_e,()=>M.driver_type),r(me,()=>M.driver_name||(M.driver_id?`驱动 #${M.driver_id}`:"-")),r(Se,(()=>{var Ke=B(()=>!!M.resource_name);return()=>Ke()?(()=>{var Ie=Cn(),He=Ie.firstChild,Ae=He.nextSibling;return r(He,()=>M.resource_name),r(Ae,()=>M.resource_path),Ie})():kn()})()),r(Ce,()=>M.collect_interval),r(ke,()=>M.enabled===1?"启用":"禁用"),ge.$$click=()=>be(M),Te.$$click=()=>Z(M.id),r(Te,()=>M.enabled===1?"禁用":"启用"),it.$$click=()=>N(M.id),m(()=>fe(ke,`badge ${M.enabled===1?"badge-running":"badge-stopped"}`)),D})()}),null),r(I,_(Q,{get each(){return G().length===0?[1]:[]},children:()=>En()}),null),q})()}}),null),r(T,_(V,{get when(){return $()},get children(){var q=$n(),R=q.firstChild,ee=R.firstChild,I=ee.firstChild,M=I.nextSibling,D=ee.nextSibling,ne=D.firstChild,pe=ne.firstChild,_e=pe.firstChild,me=_e.nextSibling,Se=pe.nextSibling,Ce=Se.firstChild,xe=Ce.nextSibling,ke=Se.nextSibling,te=ke.firstChild,ge=te.nextSibling,Te=ke.nextSibling,it=Te.firstChild,Ke=it.nextSibling,Ie=Te.nextSibling,He=Ie.firstChild,Ae=He.nextSibling;Ae.firstChild;var Ut=Ie.nextSibling,Gt=Ut.firstChild,Ve=Gt.nextSibling;Ve.firstChild;var ht=ne.nextSibling,Kt=ht.firstChild,ft=Kt.nextSibling,Je=ht.nextSibling,pt=Je.firstChild,Ht=pt.firstChild,gt=Ht.nextSibling,$t=pt.nextSibling,Vt=$t.firstChild,vt=Vt.nextSibling,Jt=$t.nextSibling,zt=Jt.firstChild,bt=zt.nextSibling,Qt=Je.nextSibling,rt=Qt.firstChild,_t=rt.nextSibling;return r(I,()=>E()?"编辑设备":"新增设备"),M.$$click=()=>{v(!1),x(null),g(Pe)},D.addEventListener("submit",J),me.$$input=L=>g({...d(),name:L.target.value}),xe.$$input=L=>g({...d(),description:L.target.value}),ge.$$input=L=>g({...d(),product_key:L.target.value}),Ke.$$input=L=>g({...d(),device_key:L.target.value}),Ae.addEventListener("change",L=>g({...d(),driver_id:L.target.value?+L.target.value:null})),r(Ae,_(Q,{get each(){return n()},children:L=>(()=>{var K=Ln(),de=K.firstChild,he=de.nextSibling;return he.nextSibling,r(K,()=>L.name,de),r(K,()=>L.version||"1.0",he),m(()=>K.value=L.id),K})()}),null),Ve.addEventListener("change",L=>g({...d(),resource_id:L.target.value?+L.target.value:null})),r(Ve,_(Q,{get each(){return Le()},children:L=>(()=>{var K=Tn(),de=K.firstChild,he=de.nextSibling;return he.nextSibling,r(K,()=>L.name,de),r(K,()=>L.type,he),r(K,(()=>{var De=B(()=>!!L.path);return()=>De()?`- ${L.path}`:""})(),null),m(()=>K.value=L.id),K})()}),null),ft.addEventListener("change",L=>g({...d(),driver_type:L.target.value,resource_id:null})),r(D,_(V,{get when(){var L;return(L=d().driver_type)==null?void 0:L.startsWith("modbus_rtu")},get children(){var L=pn(),K=L.firstChild,de=K.firstChild,he=de.nextSibling,De=K.nextSibling,Xt=De.firstChild,mt=Xt.nextSibling,xt=De.nextSibling,Yt=xt.firstChild,yt=Yt.nextSibling,wt=xt.nextSibling,Zt=wt.firstChild,St=Zt.nextSibling,el=wt.nextSibling,tl=el.firstChild,Ct=tl.nextSibling;return he.$$input=$e=>g({...d(),baud_rate:+$e.target.value}),mt.addEventListener("change",$e=>g({...d(),parity:$e.target.value})),yt.$$input=$e=>g({...d(),data_bits:+$e.target.value}),St.$$input=$e=>g({...d(),stop_bits:+$e.target.value}),Ct.$$input=$e=>g({...d(),device_address:$e.target.value}),m(()=>he.value=d().baud_rate),m(()=>mt.value=d().parity),m(()=>yt.value=d().data_bits),m(()=>St.value=d().stop_bits),m(()=>Ct.value=d().device_address),L}}),Je),r(D,_(V,{get when(){var L;return(L=d().driver_type)==null?void 0:L.startsWith("modbus_tcp")},get children(){var L=gn(),K=L.firstChild,de=K.firstChild,he=de.nextSibling;return he.$$input=De=>g({...d(),device_address:De.target.value}),m(()=>he.value=d().device_address),L}}),Je),gt.$$input=L=>g({...d(),collect_interval:+L.target.value}),vt.$$input=L=>g({...d(),timeout:+L.target.value}),bt.addEventListener("change",L=>g({...d(),enabled:+L.target.value})),rt.$$click=()=>{v(!1),x(null),g(Pe)},r(_t,(()=>{var L=B(()=>!!b());return()=>L()?"保存中...":E()?"保存":"创建"})()),m(L=>{var K=b(),de=b();return K!==L.e&&(rt.disabled=L.e=K),de!==L.t&&(_t.disabled=L.t=de),L},{e:void 0,t:void 0}),m(()=>me.value=d().name),m(()=>xe.value=d().description),m(()=>ge.value=d().product_key),m(()=>Ke.value=d().device_key),m(()=>Ae.value=d().driver_id??""),m(()=>Ve.value=d().resource_id??""),m(()=>ft.value=d().driver_type),m(()=>gt.value=d().collect_interval),m(()=>vt.value=d().timeout),m(()=>bt.value=d().enabled),q}}),null),r(T,_(V,{get when(){return S()},get children(){var q=bn(),R=q.firstChild,ee=R.firstChild,I=ee.firstChild;I.firstChild;var M=I.nextSibling,D=ee.nextSibling,ne=D.firstChild,pe=ne.firstChild,_e=pe.nextSibling,me=ne.nextSibling,Se=me.firstChild,Ce=Se.nextSibling,xe=me.nextSibling,ke=xe.firstChild;return r(I,()=>{var te;return(te=U())==null?void 0:te.name},null),M.$$click=()=>w(!1),D.addEventListener("submit",le),_e.addEventListener("change",te=>j({...A(),field:te.target.value})),r(_e,_(Q,{get each(){return P()},children:te=>(()=>{var ge=An();return r(ge,()=>te.label||te.field),m(()=>ge.value=te.field),ge})()})),Ce.$$input=te=>j({...A(),value:te.target.value}),r(D,_(V,{get when(){return F()},get children(){var te=vn();return r(te,F),te}}),xe),ke.$$click=()=>w(!1),m(()=>_e.value=A().field),m(()=>Ce.value=A().value),q}}),null),T})()}se(["click","input"]);function Nn(){return _(Dn,{})}var qn=f('<label class="btn btn-primary"style=cursor:pointer>上传驱动<input type=file accept=.wasm style=display:none>'),In=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Pn=f('<div style="color:var(--accent-red);padding:16px 0">'),On=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>文件</th><th>大小</th><th>操作</th></tr></thead><tbody>"),Mn=f('<tr><td></td><td></td><td></td><td></td><td class=flex style=gap:8px><a class=btn>下载</a><button class="btn btn-danger">删除'),jn=f("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无驱动");function Wn(){const e=ce(),[t,l]=y([]),[i,s]=y(!0),[n,o]=y(""),a=()=>{s(!0),X("/api/drivers").then(h=>{l(h.data||h),o("")}).catch(()=>o("加载驱动失败")).finally(()=>s(!1))};Y(()=>{a()});const p=(h,c)=>{confirm(`删除驱动 ${c} ？`)&&qe(`/api/drivers/${h}`).then(()=>{e.show("success","已删除"),a()}).catch(()=>e.show("error","删除失败"))},u=h=>{var d;const c=(d=h.target.files)==null?void 0:d[0];if(!c)return;const C=new FormData;C.append("file",c),xl("/api/drivers/upload",C).then(()=>{e.show("success","上传成功"),a()}).catch(()=>e.show("error","上传失败")).finally(()=>{h.target.value=""})};return _(re,{title:"驱动管理",get extra(){return(()=>{var h=qn(),c=h.firstChild,C=c.nextSibling;return C.addEventListener("change",u),h})()},get children(){return B(()=>!!i())()?In():B(()=>!!n())()?(()=>{var h=Pn();return r(h,n),h})():(()=>{var h=On(),c=h.firstChild,C=c.firstChild,d=C.nextSibling;return r(d,_(Q,{get each(){return t()},children:g=>(()=>{var E=Mn(),x=E.firstChild,$=x.nextSibling,v=$.nextSibling,b=v.nextSibling,k=b.nextSibling,S=k.firstChild,w=S.nextSibling;return r(x,()=>g.id),r($,()=>g.name),r(v,()=>g.filename||g.file_path||""),r(b,(()=>{var P=B(()=>!!g.size);return()=>P()?(g.size/1024).toFixed(1)+" KB":"-"})()),w.$$click=()=>p(g.id,g.name),m(()=>ue(S,"href",`/api/drivers/${g.id}/download`)),E})()}),null),r(d,_(Q,{get each(){return t().length===0?[1]:[]},children:()=>jn()}),null),h})()}})}se(["click"]);function Rn(){return _(Wn,{})}var Fn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:480px;max-width:90vw><div class=card-header><h3 class=card-title></h3><button class="btn btn-ghost"style="padding:4px 8px">✕</button></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>名称</label><input class=form-input placeholder=配置名称 required></div><div class=grid style="grid-template-columns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>类型</label><select class=form-select><option value=http>HTTP</option><option value=mqtt>MQTT</option><option value=xunji>寻迹</option></select></div><div class=form-group><label class=form-label>上传间隔 (ms)</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>配置 (JSON)</label><textarea class=form-input rows=5 placeholder="{ &quot;url&quot;: &quot;http://...&quot;, &quot;method&quot;: &quot;POST&quot; }"style=font-family:monospace;font-size:13px></textarea></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),Bn=f("<div>"),Un=f('<button class="btn btn-primary">新增配置'),Gn=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Kn=f("<tr><td colspan=6 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置"),Hn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>类型</th><th>上传间隔(ms)</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Vn=f('<tr><td></td><td></td><td><span class="badge badge-info"></span></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class=btn></button><button class="btn btn-danger">删除');const Oe={name:"",type:"http",upload_interval:5e3,config:"{}",enabled:1};function Jn(){const e=ce(),[t,l]=y([]),[i,s]=y(!0),[n,o]=y(Oe),[a,p]=y(null),[u,h]=y(!1),[c,C]=y(!1),d=()=>{s(!0),X("/api/northbound").then(b=>l(b.data||b)).catch(()=>e.show("error","加载北向配置失败")).finally(()=>s(!1))};Y(()=>{d()});const g=b=>{b.preventDefault(),C(!0),(a()?Ge(`/api/northbound/${a()}`,n()):oe("/api/northbound",n())).then(()=>{e.show("success",a()?"已更新":"已创建"),o(Oe),p(null),h(!1),d()}).catch(()=>e.show("error","操作失败")).finally(()=>C(!1))},E=(b,k)=>{oe(`/api/northbound/${b}/toggle`,{}).then(d).catch(()=>e.show("error","切换失败"))},x=b=>{confirm("删除该配置？")&&qe(`/api/northbound/${b}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))},$=()=>{o(Oe),p(null),h(!0)},v=b=>{p(b.id),o({name:b.name,type:b.type,upload_interval:b.upload_interval,config:b.config,enabled:b.enabled}),h(!0)};return(()=>{var b=Bn();return r(b,_(re,{title:"北向配置列表",get extra(){return(()=>{var k=Un();return k.$$click=$,k})()},get children(){return B(()=>!!i())()?Gn():(()=>{var k=Hn(),S=k.firstChild,w=S.firstChild,P=w.nextSibling;return r(P,_(Q,{get each(){return t()},children:A=>(()=>{var j=Vn(),F=j.firstChild,O=F.nextSibling,U=O.nextSibling,W=U.firstChild,G=U.nextSibling,J=G.nextSibling,Z=J.firstChild,N=J.nextSibling,le=N.firstChild,ae=le.nextSibling,be=ae.nextSibling;return r(F,()=>A.id),r(O,()=>A.name),r(W,()=>A.type.toUpperCase()),r(G,()=>A.upload_interval),r(Z,()=>A.enabled===1?"启用":"禁用"),le.$$click=()=>v(A),ae.$$click=()=>E(A.id,A.enabled===1),r(ae,()=>A.enabled===1?"禁用":"启用"),be.$$click=()=>x(A.id),m(()=>fe(Z,`badge ${A.enabled===1?"badge-running":"badge-stopped"}`)),j})()}),null),r(P,_(V,{get when(){return t().length===0},get children(){return Kn()}}),null),k})()}}),null),r(b,_(V,{get when(){return u()},get children(){var k=Fn(),S=k.firstChild,w=S.firstChild,P=w.firstChild,A=P.nextSibling,j=w.nextSibling,F=j.firstChild,O=F.firstChild,U=O.nextSibling,W=F.nextSibling,G=W.firstChild,J=G.firstChild,Z=J.nextSibling,N=G.nextSibling,le=N.firstChild,ae=le.nextSibling,be=W.nextSibling,Le=be.firstChild,T=Le.nextSibling,q=be.nextSibling,R=q.firstChild,ee=R.nextSibling;return r(P,()=>a()?"编辑北向配置":"新增北向配置"),A.$$click=()=>{h(!1),p(null),o(Oe)},j.addEventListener("submit",g),U.$$input=I=>o({...n(),name:I.target.value}),Z.addEventListener("change",I=>o({...n(),type:I.target.value})),ae.$$input=I=>o({...n(),upload_interval:+I.target.value}),T.$$input=I=>o({...n(),config:I.target.value}),R.$$click=()=>{h(!1),p(null),o(Oe)},r(ee,(()=>{var I=B(()=>!!c());return()=>I()?"保存中...":a()?"保存":"创建"})()),m(I=>{var M=c(),D=c();return M!==I.e&&(R.disabled=I.e=M),D!==I.t&&(ee.disabled=I.t=D),I},{e:void 0,t:void 0}),m(()=>U.value=n().name),m(()=>Z.value=n().type),m(()=>ae.value=n().upload_interval),m(()=>T.value=n().config),k}}),null),b})()}se(["click","input"]);function zn(){return _(Jn,{})}var Qn=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>设备</th><th>字段</th><th>条件</th><th>严重性</th><th>状态</th><th>操作</th></tr></thead><tbody>"),Xn=f('<div style="color:var(--accent-red);padding:4px 0">'),Yn=f('<div class=modal-backdrop style=position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1000><div class=card style=width:440px;max-width:92vw><div class=card-header><h3 class=card-title>新增阈值</h3></div><form class=form style="padding:12px 16px 16px"><div class=form-group><label class=form-label>设备</label><select class=form-select required><option value>选择设备</option></select></div><div class=form-group><label class=form-label>字段名</label><input class=form-input required></div><div class=grid style="gridTemplateColumns:1fr 1fr;gap:12px"><div class=form-group><label class=form-label>运算符</label><select class=form-select><option value=">">大于 &gt;</option><option value=">=">大于等于 &gt;=</option><option value="<">小于 &lt;</option><option value="<=">小于等于 &lt;=</option><option value="==">等于 ==</option></select></div><div class=form-group><label class=form-label>阈值</label><input class=form-input type=number required></div></div><div class=form-group><label class=form-label>严重程度</label><select class=form-select><option value=info>info</option><option value=warning>warning</option><option value=error>error</option><option value=critical>critical</option></select></div><div class=form-group><label class=form-label>报警消息</label><input class=form-input></div><div class=flex style=gap:8px;justifyContent:flex-end;marginTop:8px><button type=button class=btn>取消</button><button type=submit class="btn btn-primary">'),Zn=f("<div>"),ei=f('<button class="btn btn-primary">新增阈值'),ti=f('<tr><td></td><td></td><td></td><td> </td><td></td><td><span></span></td><td><button class="btn btn-danger">删除'),li=f("<tr><td colspan=7 style=text-align:center;padding:24px;color:var(--text-muted)>暂无阈值"),ni=f("<option>");const Qe={device_id:"",field_name:"",operator:">",value:0,severity:"warning",message:"",enabled:1};function ii(){const e=ce(),[t,l]=y([]),[i,s]=y([]),[n,o]=y(Qe),[a,p]=y(!1),[u,h]=y(!1),[c,C]=y(""),d=()=>{X("/api/thresholds").then($=>l($.data||$)).catch(()=>e.show("error","加载阈值失败"))},g=()=>{X("/api/devices").then($=>s($.data||$)).catch(()=>{})};Y(()=>{d(),g()}),Y(()=>{if(!a())return;const $=v=>{v.key==="Escape"&&p(!1)};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)});const E=$=>{$.preventDefault(),h(!0),C(""),oe("/api/thresholds",n()).then(()=>{e.show("success","阈值已创建"),o(Qe),p(!1),d()}).catch(v=>{C(v.message||"创建失败"),e.show("error","创建失败")}).finally(()=>h(!1))},x=$=>{confirm("删除该阈值？")&&qe(`/api/thresholds/${$}`).then(()=>{e.show("success","已删除"),d()}).catch(()=>e.show("error","删除失败"))};return(()=>{var $=Zn();return r($,_(re,{title:"阈值配置列表",get extra(){return(()=>{var v=ei();return v.$$click=()=>{o(Qe),C(""),p(!0)},v})()},get children(){var v=Qn(),b=v.firstChild,k=b.firstChild,S=k.nextSibling;return r(S,_(Q,{get each(){return t()},children:w=>(()=>{var P=ti(),A=P.firstChild,j=A.nextSibling,F=j.nextSibling,O=F.nextSibling,U=O.firstChild,W=O.nextSibling,G=W.nextSibling,J=G.firstChild,Z=G.nextSibling,N=Z.firstChild;return r(A,()=>w.id),r(j,()=>w.device_id),r(F,()=>w.field_name),r(O,()=>w.operator,U),r(O,()=>w.value,null),r(W,()=>w.severity),r(J,()=>w.enabled===1?"启用":"禁用"),N.$$click=()=>x(w.id),m(()=>fe(J,`badge ${w.enabled===1?"badge-running":"badge-stopped"}`)),P})()}),null),r(S,_(Q,{get each(){return t().length===0?[1]:[]},children:()=>li()}),null),v}}),null),r($,_(V,{get when(){return a()},get children(){var v=Yn(),b=v.firstChild,k=b.firstChild,S=k.nextSibling,w=S.firstChild,P=w.firstChild,A=P.nextSibling;A.firstChild;var j=w.nextSibling,F=j.firstChild,O=F.nextSibling,U=j.nextSibling,W=U.firstChild,G=W.firstChild,J=G.nextSibling,Z=W.nextSibling,N=Z.firstChild,le=N.nextSibling,ae=U.nextSibling,be=ae.firstChild,Le=be.nextSibling,T=ae.nextSibling,q=T.firstChild,R=q.nextSibling,ee=T.nextSibling,I=ee.firstChild,M=I.nextSibling;return v.$$click=D=>{D.target===D.currentTarget&&p(!1)},S.addEventListener("submit",E),A.addEventListener("change",D=>o({...n(),device_id:+D.target.value})),r(A,()=>i().map(D=>(()=>{var ne=ni();return r(ne,()=>D.name||D.id),m(()=>ue(ne,"key",D.id)),m(()=>ne.value=D.id),ne})()),null),O.$$input=D=>o({...n(),field_name:D.target.value}),J.addEventListener("change",D=>o({...n(),operator:D.target.value})),le.$$input=D=>o({...n(),value:+D.target.value}),Le.addEventListener("change",D=>o({...n(),severity:D.target.value})),R.$$input=D=>o({...n(),message:D.target.value}),r(S,_(V,{get when(){return c()},get children(){var D=Xn();return r(D,c),D}}),ee),I.$$click=()=>{p(!1),o(Qe)},r(M,()=>u()?"创建中...":"创建"),m(D=>{var ne=u(),pe=u();return ne!==D.e&&(I.disabled=D.e=ne),pe!==D.t&&(M.disabled=D.t=pe),D},{e:void 0,t:void 0}),m(()=>A.value=n().device_id),m(()=>O.value=n().field_name),m(()=>J.value=n().operator),m(()=>le.value=n().value),m(()=>Le.value=n().severity),m(()=>R.value=n().message),v}}),null),$})()}se(["click","input"]);function ri(){return _(ii,{})}var si=f("<div class=table-container style=max-height:600px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备ID</th><th>字段</th><th>实际值</th><th>阈值条件</th><th>级别</th><th>消息</th><th>状态</th><th>操作</th></tr></thead><tbody>"),ai=f("<button class=btn>刷新"),oi=f("<tr><td></td><td></td><td></td><td></td><td></td><td><span></span></td><td></td><td></td><td>"),ci=f('<span class="text-muted text-xs">已确认'),di=f("<span class=text-warning>未确认"),ui=f('<button class="btn btn-primary btn-sm">确认'),hi=f("<tr><td colspan=9 style=text-align:center;padding:24px;color:var(--text-muted)>暂无告警");function fi(){const e=ce(),[t,l]=y([]),i=()=>{X("/api/alarms").then(n=>l(n.data||n)).catch(()=>e.show("error","加载告警失败"))};Y(()=>{i()});const s=n=>{oe(`/api/alarms/${n}/acknowledge`,{}).then(()=>{e.show("success","已确认"),i()}).catch(()=>e.show("error","确认失败"))};return _(re,{title:"报警日志",get extra(){return(()=>{var n=ai();return n.$$click=i,n})()},get children(){var n=si(),o=n.firstChild,a=o.firstChild,p=a.nextSibling;return r(p,_(Q,{get each(){return t()},children:u=>(()=>{var h=oi(),c=h.firstChild,C=c.nextSibling,d=C.nextSibling,g=d.nextSibling,E=g.nextSibling,x=E.nextSibling,$=x.firstChild,v=x.nextSibling,b=v.nextSibling,k=b.nextSibling;return r(c,()=>{var S;return((S=u.triggered_at)==null?void 0:S.slice(5,19))||u.triggered_at}),r(C,()=>u.device_id),r(d,()=>u.field_name),r(g,()=>u.actual_value),r(E,()=>`${u.operator} ${u.threshold_value}`),r($,()=>u.severity||"warn"),r(v,()=>u.message||"-"),r(b,(()=>{var S=B(()=>u.acknowledged===1);return()=>S()?ci():di()})()),r(k,(()=>{var S=B(()=>u.acknowledged!==1);return()=>S()&&(()=>{var w=ui();return w.$$click=()=>s(u.id),w})()})()),m(()=>fe($,`badge ${u.severity==="critical"?"badge-critical":"badge-running"}`)),h})()}),null),r(p,_(Q,{get each(){return t().length===0?[1]:[]},children:()=>hi()}),null),n}})}se(["click"]);var pi=f("<select class=form-select>"),gi=f("<option>"),$i=f("<div style=padding:24px>加载中..."),vi=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),bi=f("<tr><td></td><td></td><td></td><td>"),_i=f("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无数据");function mi(){const e=ce(),[t,l]=y([]),[i,s]=y(""),[n,o]=y([]),[a,p]=y(!1);return Y(()=>{X("/api/devices").then(u=>{const h=u.data||u;l(h),h.length&&s(String(h[0].id))}).catch(()=>e.show("error","加载设备失败"))}),Y(()=>{i()&&(p(!0),X(`/api/data/points/${i()}`).then(u=>o(u.data||u)).catch(()=>e.show("error","加载实时数据失败")).finally(()=>p(!1)))}),_(re,{title:"实时数据",get extra(){return(()=>{var u=pi();return u.addEventListener("change",h=>s(h.target.value)),r(u,()=>t().map(h=>(()=>{var c=gi();return r(c,()=>h.name||h.id),m(()=>ue(c,"key",h.id)),m(()=>c.value=h.id),c})())),m(()=>u.value=i()),u})()},get children(){return B(()=>!!a())()?$i():(()=>{var u=vi(),h=u.firstChild,c=h.firstChild,C=c.nextSibling;return r(C,()=>n().map(d=>(()=>{var g=bi(),E=g.firstChild,x=E.nextSibling,$=x.nextSibling,v=$.nextSibling;return r(E,()=>d.collected_at||d.CollectedAt||""),r(x,()=>d.device_name||""),r($,()=>d.field_name||""),r(v,()=>d.value),m(()=>ue(g,"key",d.id||`${d.device_id}-${d.collected_at}-${d.field_name}`)),g})()),null),r(C,(()=>{var d=B(()=>n().length===0);return()=>d()&&_i()})(),null),u})()}})}var xi=f('<div class="flex gap-3"><select class=form-select><option value>全部设备</option></select><button class=btn>刷新'),yi=f("<option>"),wi=f("<div style=padding:24px>加载中..."),Si=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>时间</th><th>设备</th><th>字段</th><th>值</th></tr></thead><tbody>"),Ci=f("<tr><td></td><td></td><td></td><td>"),ki=f("<tr><td colspan=4 style=text-align:center;padding:24px;color:var(--text-muted)>暂无历史数据");function Ei(){const e=ce(),[t,l]=y(""),[i,s]=y([]),[n,o]=y(!1),[a,p]=y([]);Y(()=>{X("/api/devices").then(h=>p(h.data||h)).catch(()=>{})});const u=()=>{o(!0);const h=t()?`/api/data/history?device_id=${t()}`:"/api/data/history";X(h).then(c=>s(c.data||c)).catch(()=>e.show("error","加载历史数据失败")).finally(()=>o(!1))};return Y(()=>{u()}),_(re,{title:"历史数据",get extra(){return(()=>{var h=xi(),c=h.firstChild;c.firstChild;var C=c.nextSibling;return c.addEventListener("change",d=>l(d.target.value)),r(c,()=>a().map(d=>(()=>{var g=yi();return r(g,()=>d.name||d.id),m(()=>ue(g,"key",d.id)),m(()=>g.value=d.id),g})()),null),C.$$click=u,m(()=>c.value=t()),h})()},get children(){return B(()=>!!n())()?wi():(()=>{var h=Si(),c=h.firstChild,C=c.firstChild,d=C.nextSibling;return r(d,()=>i().map(g=>(()=>{var E=Ci(),x=E.firstChild,$=x.nextSibling,v=$.nextSibling,b=v.nextSibling;return r(x,()=>{var k;return((k=g.collected_at)==null?void 0:k.slice(0,19))||g.CollectedAt}),r($,()=>g.device_name||g.DeviceName),r(v,()=>g.field_name||g.FieldName),r(b,()=>g.value||g.Value),m(()=>ue(E,"key",g.id)),E})()),null),r(d,(()=>{var g=B(()=>i().length===0);return()=>g()&&ki()})(),null),h})()}})}se(["click"]);var Li=f('<form class=form><div class=form-group><label class=form-label>名称</label><input class=form-input required></div><div class=form-group><label class=form-label>保留天数</label><input class=form-input type=number required></div><div class=flex style=gap:12px;margin-top:12px><button class="btn btn-primary"type=submit style=flex:1></button><button class=btn type=button style=flex:1>重置'),Ti=f('<div class=grid style="grid-template-columns:3fr 1.4fr;gap:24px">'),Ai=f("<button class=btn>立即清理"),Di=f('<div class=text-center style=padding:48px;color:var(--text-muted)><div class=loading-spinner style="margin:0 auto 16px"></div><div>加载中...'),Ni=f("<div class=table-container style=max-height:520px;overflow:auto><table class=table><thead><tr><th>ID</th><th>名称</th><th>保留天数</th><th>状态</th><th>操作</th></tr></thead><tbody>"),qi=f('<tr><td></td><td></td><td></td><td><span></span></td><td class=flex style=gap:8px><button class=btn>编辑</button><button class="btn btn-danger">删除'),Ii=f("<tr><td colspan=5 style=text-align:center;padding:24px;color:var(--text-muted)>暂无配置");const at={name:"",storage_days:30,enabled:1};function Pi(){const e=ce(),[t,l]=y([]),[i,s]=y(!0),[n,o]=y(at),[a,p]=y(null),[u,h]=y(!1),c=()=>{s(!0),X("/api/storage").then(x=>l(x.data||x)).catch(()=>e.show("error","加载存储配置失败")).finally(()=>s(!1))};Y(()=>{c()});const C=x=>{x.preventDefault(),h(!0),(a()?Ge(`/api/storage/${a()}`,n()):oe("/api/storage",n())).then(()=>{e.show("success",a()?"已更新":"已创建"),o(at),p(null),c()}).catch(()=>e.show("error","操作失败")).finally(()=>h(!1))},d=x=>{confirm("删除该配置？")&&qe(`/api/storage/${x}`).then(()=>{e.show("success","已删除"),c()}).catch(()=>e.show("error","删除失败"))},g=x=>{p(x.id),o({name:x.name,storage_days:x.storage_days,enabled:x.enabled})},E=()=>{oe("/api/storage/run",{}).then(x=>e.show("success",`清理完成，删除 ${x.deleted_count} 条记录`)).catch(()=>e.show("error","清理失败"))};return(()=>{var x=Ti();return r(x,_(re,{title:"存储策略列表",get extra(){return(()=>{var $=Ai();return $.$$click=E,$})()},get children(){return B(()=>!!i())()?Di():(()=>{var $=Ni(),v=$.firstChild,b=v.firstChild,k=b.nextSibling;return r(k,_(Q,{get each(){return t()},children:S=>(()=>{var w=qi(),P=w.firstChild,A=P.nextSibling,j=A.nextSibling,F=j.nextSibling,O=F.firstChild,U=F.nextSibling,W=U.firstChild,G=W.nextSibling;return r(P,()=>S.id),r(A,()=>S.name),r(j,()=>S.storage_days),r(O,()=>S.enabled===1?"启用":"禁用"),W.$$click=()=>g(S),G.$$click=()=>d(S.id),m(()=>fe(O,`badge ${S.enabled===1?"badge-running":"badge-stopped"}`)),w})()}),null),r(k,_(Q,{get each(){return t().length===0?[1]:[]},children:()=>Ii()}),null),$})()}}),null),r(x,_(re,{get title(){return a()?"编辑存储策略":"新增存储策略"},get children(){var $=Li(),v=$.firstChild,b=v.firstChild,k=b.nextSibling,S=v.nextSibling,w=S.firstChild,P=w.nextSibling,A=S.nextSibling,j=A.firstChild,F=j.nextSibling;return $.addEventListener("submit",C),k.$$input=O=>o({...n(),name:O.target.value}),P.$$input=O=>o({...n(),storage_days:+O.target.value}),r(j,(()=>{var O=B(()=>!!u());return()=>O()?"保存中...":a()?"保存":"创建"})()),F.$$click=()=>{o(at),p(null)},m(()=>j.disabled=u()),m(()=>k.value=n().name),m(()=>P.value=n().storage_days),$}}),null),x})()}se(["input","click"]);function Oi(){return _(Pi,{})}var Mi=f("<div><main class=container style=padding-top:32px;padding-bottom:32px></main><div id=toast-container class=toast-container>");function ji(){const[e,t]=vl(),[l,i]=y(!0);Y(()=>{e()!=="/login"&&X("/api/status").then(()=>i(!0)).catch(()=>{i(!1),Bt("/login")})});const s=()=>{const n=e();switch(!0){case n==="/login":return _(Ql,{onSuccess:()=>t("/")});case n==="/":return _(Tt,{});case n.startsWith("/gateway"):return _(ln,{});case n.startsWith("/resources"):return _(fn,{});case n.startsWith("/devices"):return _(Nn,{});case n.startsWith("/drivers"):return _(Rn,{});case n.startsWith("/northbound"):return _(zn,{});case n.startsWith("/storage"):return _(Oi,{});case n.startsWith("/thresholds"):return _(ri,{});case n.startsWith("/alarms"):return _(fi,{});case n.startsWith("/realtime"):return _(mi,{});case n.startsWith("/history"):return _(Ei,{});default:return _(Tt,{})}};return(()=>{var n=Mi(),o=n.firstChild;return r(n,_(V,{get when(){return e()!=="/login"},get children(){return _(Ll,{get path(){return e()},onNav:t})}}),o),r(o,s),n})()}const At=document.getElementById("app-root");At&&jt(()=>_(ji,{}),At);const Wi={};typeof document<"u"&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-solid-island]").forEach(e=>{const t=e.getAttribute("data-solid-island"),l=Wi[t];if(!l)return;const i=e.dataset.props?JSON.parse(e.dataset.props):{};jt(()=>_(l,i),e)})});
