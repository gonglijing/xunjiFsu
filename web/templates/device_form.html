    <!-- 添加设备表单 -->
    <div id="device-modal" class="hidden">
        <div class="modal-header">
            <h3 class="modal-title">添加设备</h3>
            <button class="modal-close" onclick="closeModal('device-modal')">&times;</button>
        </div>
        <form hx-post="/api/devices" hx-target="#device-modal-result" hx-swap="innerHTML">
            <div id="device-modal-result"></div>
            
            <!-- 基本信息 -->
            <div class="form-group">
                <label class="form-label">设备名称</label>
                <input type="text" name="name" class="form-input" required placeholder="输入设备名称">
            </div>
            <div class="form-group">
                <label class="form-label">驱动类型</label>
                <select name="driver_type" class="form-select" id="device-driver-type" onchange="toggleDriverFields()">
                    <option value="modbus_rtu">ModbusRTU (串口)</option>
                    <option value="modbus_tcp">ModbusTCP (网络)</option>
                </select>
            </div>
            
            <!-- ModbusRTU 配置 -->
            <div id="modbus-rtu-fields" class="driver-fields">
                <div class="form-group">
                    <label class="form-label">串口名称</label>
                    <input type="text" name="serial_port" class="form-input" placeholder="如: /dev/ttyUSB0 或 COM1">
                </div>
                <div class="form-group">
                    <label class="form-label">波特率</label>
                    <select name="baud_rate" class="form-select">
                        <option value="9600">9600</option>
                        <option value="19200">19200</option>
                        <option value="38400">38400</option>
                        <option value="57600">57600</option>
                        <option value="115200">115200</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">数据位</label>
                    <select name="data_bits" class="form-select">
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8" selected>8</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">停止位</label>
                    <select name="stop_bits" class="form-select">
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">校验</label>
                    <select name="parity" class="form-select">
                        <option value="N" selected>无 (None)</option>
                        <option value="O">奇 (Odd)</option>
                        <option value="E">偶 (Even)</option>
                    </select>
                </div>
            </div>
            
            <!-- ModbusTCP 配置 -->
            <div id="modbus-tcp-fields" class="driver-fields hidden">
                <div class="form-group">
                    <label class="form-label">IP地址</label>
                    <input type="text" name="ip_address" class="form-input" placeholder="如: 192.168.1.100">
                </div>
                <div class="form-group">
                    <label class="form-label">端口</label>
                    <input type="number" name="port_num" class="form-input" value="502" placeholder="如: 502">
                </div>
            </div>
            
            <!-- 设备地址 -->
            <div class="form-group">
                <label class="form-label">设备地址 (从站号)</label>
                <input type="text" name="device_address" class="form-input" placeholder="如: 1" required>
            </div>
            
            <!-- 通用设置 -->
            <div class="form-group">
                <label class="form-label">采集周期 (ms)</label>
                <input type="number" name="collect_interval" class="form-input" value="5000" placeholder="如: 5000">
            </div>
            <div class="form-group">
                <label class="form-label">响应超时 (ms)</label>
                <input type="number" name="timeout" class="form-input" value="1000" placeholder="如: 1000">
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" name="enabled" value="1" style="margin-right: 8px;">
                    立即开始采集
                </label>
            </div>
            
            <div class="flex gap-3" style="margin-top: 24px;">
                <button type="button" onclick="closeModal('device-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">取消</button>
                <button type="submit" class="btn btn-primary" style="flex:1;">确认添加</button>
            </div>
        </form>
    </div>
