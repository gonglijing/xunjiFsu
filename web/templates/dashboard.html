{{ define "dashboard-content" }}
        <!-- ç»Ÿè®¡å¡ç‰‡ - HTMX è‡ªåŠ¨åˆ·æ–° -->
        <div hx-get="/api/status" hx-trigger="load, every 5s" hx-target="this">
            <div class="grid grid-cols-4 mb-8">
                <div class="stat-card">
            <div class="stat-card-icon blue">ğŸ“Š</div>
            <div class="stat-card-label">è®¾å¤‡æ€»æ•°</div>
            <div class="stat-card-value" id="total-devices">--</div>
                </div>
                <div class="stat-card">
            <div class="stat-card-icon green">âœ“</div>
            <div class="stat-card-label">åœ¨çº¿è®¾å¤‡</div>
            <div class="stat-card-value" id="online-devices">--</div>
                </div>
                <div class="stat-card">
            <div class="stat-card-icon purple">âš¡</div>
            <div class="stat-card-label">æ•°æ®ç‚¹</div>
            <div class="stat-card-value" id="data-points">--</div>
                </div>
                <div class="stat-card">
            <div class="stat-card-icon orange">âš </div>
            <div class="stat-card-label">æŠ¥è­¦æ•°</div>
            <div class="stat-card-value" id="alarm-count">--</div>
                </div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="card">
    <div class="tabs mb-6">
        <button onclick="switchTab('devices')" id="tab-btn-devices" class="tab-btn active">
            â— è®¾å¤‡ç®¡ç†
        </button>
        <button onclick="switchTab('drivers')" id="tab-btn-drivers" class="tab-btn">
            é©±åŠ¨ç®¡ç†
        </button>
        <button onclick="switchTab('northbound')" id="tab-btn-northbound" class="tab-btn">
            â—‰ åŒ—å‘é…ç½®
        </button>
        <button onclick="switchTab('thresholds')" id="tab-btn-thresholds" class="tab-btn">
            âš¡ é˜ˆå€¼é…ç½®
        </button>
        <button onclick="switchTab('alarms')" id="tab-btn-alarms" class="tab-btn">
            âš  æŠ¥è­¦æ—¥å¿—
        </button>
            </div>
            
    <div>
                <!-- è®¾å¤‡ç®¡ç† -->
                <div id="tab-devices" class="tab-content active">
                    <div class="card-header">
                <h3 class="card-title">è®¾å¤‡åˆ—è¡¨</h3>
                <button onclick="openModal('device-modal')" class="btn btn-primary">
                    + æ·»åŠ è®¾å¤‡
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/devices" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- é©±åŠ¨ç®¡ç† -->
                <div id="tab-drivers" class="tab-content">
                    <div class="card-header">
                <h3 class="modal-title">é©±åŠ¨åˆ—è¡¨</h3>
                <div class="flex gap-3">
                    <button onclick="document.getElementById('driver-upload').click()" class="btn btn-primary">
                        â†‘ ä¸Šä¼ é©±åŠ¨
                    </button>
                            <input type="file" id="driver-upload" name="file" accept=".wasm" onchange="uploadDriver(this)" style="display:none">
                        </div>
                    </div>
                    <div class="table-container" hx-get="/api/drivers" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- åŒ—å‘é…ç½® -->
                <div id="tab-northbound" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">åŒ—å‘é…ç½®åˆ—è¡¨</h3>
                <button onclick="openModal('northbound-modal')" class="btn btn-primary">
                    + æ·»åŠ é…ç½®
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/northbound" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- é˜ˆå€¼é…ç½® -->
                <div id="tab-thresholds" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">é˜ˆå€¼é…ç½®åˆ—è¡¨</h3>
                <button onclick="openModal('threshold-modal')" class="btn btn-primary">
                    + æ·»åŠ é˜ˆå€¼
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/thresholds" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- æŠ¥è­¦æ—¥å¿— -->
                <div id="tab-alarms" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">æŠ¥è­¦æ—¥å¿—</h3>
                <button onclick="htmx.trigger(htmx.find('#alarm-list'), 'load')" class="btn btn-primary">
                    â†» åˆ·æ–°
                </button>
                    </div>
                    <div id="alarm-list" class="table-container" hx-get="/api/alarms" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container" class="modal">
    <div class="modal-backdrop"></div>
        <div class="modal-content">
            <!-- æ·»åŠ è®¾å¤‡è¡¨å• -->
        <div id="device-modal" class="hidden">
            <div class="modal-header">
                <h3 class="modal-title">æ·»åŠ è®¾å¤‡</h3>
                <button class="modal-close" onclick="closeModal('device-modal')">&times;</button>
            </div>
            <form hx-post="/api/devices" hx-target="#device-modal-result" hx-swap="innerHTML">
                <div id="device-modal-result"></div>
                    <div class="form-group">
                        <label class="form-label">è®¾å¤‡åç§°</label>
                    <input type="text" name="name" class="form-input" required placeholder="è¾“å…¥è®¾å¤‡åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label">è®¾å¤‡åœ°å€</label>
                        <input type="text" name="address" class="form-input" placeholder="å¦‚: 1 (Modbusåœ°å€)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">é‡‡é›†å‘¨æœŸ (ms)</label>
                    <input type="number" name="collect_interval" class="form-input" value="1000" min="100">
                    </div>
                <div class="flex gap-3" style="margin-top: 24px;">
                    <button type="button" onclick="closeModal('device-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">
                        ç¡®è®¤æ·»åŠ 
                    </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ è®¾å¤‡è¡¨å• -->
    <div id="device-modal" class="hidden">
        <div class="modal-header">
            <h3 class="modal-title">æ·»åŠ è®¾å¤‡</h3>
            <button class="modal-close" onclick="closeModal('device-modal')">&times;</button>
        </div>
        <form hx-post="/api/devices" hx-target="#device-modal-result" hx-swap="innerHTML">
            <div id="device-modal-result"></div>
            
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="form-group">
                <label class="form-label">è®¾å¤‡åç§°</label>
                <input type="text" name="name" class="form-input" required placeholder="è¾“å…¥è®¾å¤‡åç§°">
            </div>
            <div class="form-group">
                <label class="form-label">é©±åŠ¨ç±»å‹</label>
                <select name="driver_type" class="form-select" id="device-driver-type" onchange="toggleDriverFields()">
                    <option value="modbus_rtu">ModbusRTU (ä¸²å£)</option>
                    <option value="modbus_tcp">ModbusTCP (ç½‘ç»œ)</option>
                </select>
            </div>
            
            <!-- ModbusRTU é…ç½® -->
            <div id="modbus-rtu-fields" class="driver-fields">
                <div class="form-group">
                    <label class="form-label">ä¸²å£åç§°</label>
                    <input type="text" name="serial_port" class="form-input" placeholder="å¦‚: /dev/ttyUSB0 æˆ– COM1">
                </div>
                <div class="form-group">
                    <label class="form-label">æ³¢ç‰¹ç‡</label>
                    <select name="baud_rate" class="form-select">
                        <option value="9600">9600</option>
                        <option value="19200">19200</option>
                        <option value="38400">38400</option>
                        <option value="57600">57600</option>
                        <option value="115200">115200</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ•°æ®ä½</label>
                    <select name="data_bits" class="form-select">
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8" selected>8</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">åœæ­¢ä½</label>
                    <select name="stop_bits" class="form-select">
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ ¡éªŒ</label>
                    <select name="parity" class="form-select">
                        <option value="N" selected>æ—  (None)</option>
                        <option value="O">å¥‡ (Odd)</option>
                        <option value="E">å¶ (Even)</option>
                    </select>
                </div>
            </div>
            
            <!-- ModbusTCP é…ç½® -->
            <div id="modbus-tcp-fields" class="driver-fields hidden">
                <div class="form-group">
                    <label class="form-label">IPåœ°å€</label>
                    <input type="text" name="ip_address" class="form-input" placeholder="å¦‚: 192.168.1.100">
                </div>
                <div class="form-group">
                    <label class="form-label">ç«¯å£</label>
                    <input type="number" name="port_num" class="form-input" value="502" placeholder="å¦‚: 502">
                </div>
            </div>
            
            <!-- è®¾å¤‡åœ°å€ -->
            <div class="form-group">
                <label class="form-label">è®¾å¤‡åœ°å€ (ä»ç«™å·)</label>
                <input type="text" name="device_address" class="form-input" placeholder="å¦‚: 1" required>
            </div>
            
            <!-- é€šç”¨è®¾ç½® -->
            <div class="form-group">
                <label class="form-label">é‡‡é›†å‘¨æœŸ (ms)</label>
                <input type="number" name="collect_interval" class="form-input" value="5000" placeholder="å¦‚: 5000">
            </div>
            <div class="form-group">
                <label class="form-label">å“åº”è¶…æ—¶ (ms)</label>
                <input type="number" name="timeout" class="form-input" value="1000" placeholder="å¦‚: 1000">
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" name="enabled" value="1" style="margin-right: 8px;">
                    ç«‹å³å¼€å§‹é‡‡é›†
                </label>
            </div>
            
            <div class="flex gap-3" style="margin-top: 24px;">
                <button type="button" onclick="closeModal('device-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">å–æ¶ˆ</button>
                <button type="submit" class="btn btn-primary" style="flex:1;">ç¡®è®¤æ·»åŠ </button>
            </div>
        </form>
    </div>

    <!-- åŒ—å‘é…ç½®è¡¨å• -->
    <div id="northbound-modal" class="hidden">
        <div class="modal-header">
            <h3 class="modal-title">æ·»åŠ åŒ—å‘é…ç½®</h3>
            <button class="modal-close" onclick="closeModal('northbound-modal')">&times;</button>
        </div>
        <form hx-post="/api/northbound" hx-target="#northbound-modal-result" hx-swap="innerHTML">
            <div id="northbound-modal-result"></div>
            <div class="form-group">
                <label class="form-label">é…ç½®åç§°</label>
                <input type="text" name="name" class="form-input" required placeholder="è¾“å…¥é…ç½®åç§°">
            </div>
            <div class="form-group">
                <label class="form-label">ç±»å‹</label>
                <select name="type" class="form-select">
                    <option value="http">HTTP</option>
                    <option value="mqtt">MQTT</option>
                    <option value="xunji">å¾ªè¿¹äº‘</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">æœåŠ¡å™¨åœ°å€</label>
                <input type="text" name="config" class="form-input" placeholder="http://example.com/api" required>
            </div>
            <div class="form-group">
                <label class="form-label">ä¸Šä¼ é—´éš” (ms)</label>
                <input type="number" name="upload_interval" class="form-input" value="10000" min="1000">
            </div>
            <div class="flex gap-3" style="margin-top: 24px;">
                <button type="button" onclick="closeModal('northbound-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">å–æ¶ˆ</button>
                <button type="submit" class="btn btn-primary" style="flex:1;">ç¡®è®¤æ·»åŠ </button>
            </div>
        </form>
    </div>

    <!-- é˜ˆå€¼é…ç½®è¡¨å• -->
    <div id="threshold-modal" class="hidden">
        <div class="modal-header">
            <h3 class="modal-title">æ·»åŠ é˜ˆå€¼é…ç½®</h3>
            <button class="modal-close" onclick="closeModal('threshold-modal')">&times;</button>
        </div>
        <form hx-post="/api/thresholds" hx-target="#threshold-modal-result" hx-swap="innerHTML">
            <div id="threshold-modal-result"></div>
            <div class="form-group">
                <label class="form-label">è®¾å¤‡</label>
                <select name="device_id" class="form-select" required>
                    <option value="">-- é€‰æ‹©è®¾å¤‡ --</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">å˜é‡å</label>
                <input type="text" name="field_name" class="form-input" placeholder="å¦‚: temperature" required>
            </div>
            <div class="form-group">
                <label class="form-label">æ¡ä»¶</label>
                <select name="operator" class="form-select">
                    <option value="&gt;">å¤§äº &gt;</option>
                    <option value="&gt;=">å¤§äºç­‰äº &gt;=</option>
                    <option value="&lt;">å°äº &lt;</option>
                    <option value="&lt;=">å°äºç­‰äº &lt;=</option>
                    <option value="==">ç­‰äº ==</option>
                    <option value="!=">ä¸ç­‰äº !=</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">é˜ˆå€¼</label>
                <input type="text" name="value" class="form-input" placeholder="é˜ˆå€¼æ•°å€¼" required>
            </div>
            <div class="form-group">
                <label class="form-label">ä¸¥é‡ç¨‹åº¦</label>
                <select name="severity" class="form-select">
                    <option value="warning">è­¦å‘Š</option>
                    <option value="critical">ä¸¥é‡</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">æŠ¥è­¦æ¶ˆæ¯</label>
                <input type="text" name="message" class="form-input" placeholder="è§¦å‘æ—¶çš„æŠ¥è­¦æ¶ˆæ¯">
            </div>
            <div class="flex gap-3" style="margin-top: 24px;">
                <button type="button" onclick="closeModal('threshold-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">å–æ¶ˆ</button>
                <button type="submit" class="btn btn-primary" style="flex:1;">ç¡®è®¤æ·»åŠ </button>
            </div>
        </form>
    </div>

    <script>
// Toast notification system
function showToast(type, title, message, duration = 5000) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const icons = {
        success: 'âœ“',
        error: 'âœ•',
        warning: 'âš ',
        info: 'â„¹'
    };
    
    toast.innerHTML = `
        <div class="toast-icon">${icons[type] || icons.info}</div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            ${message ? `<div class="toast-message">${message}</div>` : ''}
        </div>
        <button class="modal-close" onclick="this.parentElement.remove()" style="font-size:16px;">&times;</button>
    `;
    
    container.appendChild(toast);
    
    if (duration > 0) {
        setTimeout(() => {
            toast.style.animation = 'toastSlideIn 0.3s ease-out reverse';
            setTimeout(() => toast.remove(), 300);
        }, duration);
    }
}

// HTMX response handling
document.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.successful && evt.detail.xhr.status === 200) {
        const response = evt.detail.xhr.responseText;
        if (response.includes('"status":"success"') || response.includes('åˆ›å»ºæˆåŠŸ') || response.includes('æ·»åŠ æˆåŠŸ')) {
            showToast('success', 'æ“ä½œæˆåŠŸ', 'æ•°æ®å·²æ›´æ–°');
        }
    }
});

document.addEventListener('htmx:responseError', function(evt) {
    showToast('error', 'è¯·æ±‚å¤±è´¥', 'è¯·ç¨åé‡è¯•');
});

// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (navToggle && navLinks) {
        navToggle.addEventListener('click', function() {
            navLinks.classList.toggle('active');
        });
    }
});
    </script>
{{ end }}
