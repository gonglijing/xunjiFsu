{{ define "content" }}
        <!-- ç»Ÿè®¡å¡ç‰‡ - HTMX è‡ªåŠ¨åˆ·æ–° -->
        <div hx-get="/api/status" hx-trigger="load, every 5s" hx-target="this">
            <div class="grid grid-cols-4 mb-8">
                <div class="stat-card">
            <div class="stat-card-icon blue">ğŸ“Š</div>
            <div class="stat-card-label">è®¾å¤‡æ€»æ•°</div>
            <div class="stat-card-value" id="total-devices">--</div>
                </div>
                <div class="stat-card">
            <div class="stat-card-icon green">âœ“</div>
            <div class="stat-card-label">åœ¨çº¿è®¾å¤‡</div>
            <div class="stat-card-value" id="online-devices">--</div>
                </div>
                <div class="stat-card">
            <div class="stat-card-icon purple">âš¡</div>
            <div class="stat-card-label">æ•°æ®ç‚¹</div>
            <div class="stat-card-value" id="data-points">--</div>
                </div>
                <div class="stat-card">
            <div class="stat-card-icon orange">âš </div>
            <div class="stat-card-label">æŠ¥è­¦æ•°</div>
            <div class="stat-card-value" id="alarm-count">--</div>
                </div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="card">
    <div class="tabs mb-6">
        <button onclick="switchTab('resources')" id="tab-btn-resources" class="tab-btn active">
            â— èµ„æºç®¡ç†
        </button>
        <button onclick="switchTab('devices')" id="tab-btn-devices" class="tab-btn">
            â— è®¾å¤‡ç®¡ç†
        </button>
        <button onclick="switchTab('drivers')" id="tab-btn-drivers" class="tab-btn">
            é©±åŠ¨ç®¡ç†
        </button>
        <button onclick="switchTab('northbound')" id="tab-btn-northbound" class="tab-btn">
            â—‰ åŒ—å‘é…ç½®
        </button>
        <button onclick="switchTab('thresholds')" id="tab-btn-thresholds" class="tab-btn">
            âš¡ é˜ˆå€¼é…ç½®
        </button>
        <button onclick="switchTab('alarms')" id="tab-btn-alarms" class="tab-btn">
            âš  æŠ¥è­¦æ—¥å¿—
        </button>
            </div>
            
    <div>
                <!-- èµ„æºç®¡ç† -->
                <div id="tab-resources" class="tab-content active">
                    <div class="card-header">
                <h3 class="card-title">èµ„æºåˆ—è¡¨</h3>
                <button onclick="openModal('resource-modal')" class="btn btn-primary">
                    + æ·»åŠ èµ„æº
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/resources" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- è®¾å¤‡ç®¡ç† -->
                <div id="tab-devices" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">è®¾å¤‡åˆ—è¡¨</h3>
                <button onclick="openModal('device-modal')" class="btn btn-primary">
                    + æ·»åŠ è®¾å¤‡
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/devices" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- é©±åŠ¨ç®¡ç† -->
                <div id="tab-drivers" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">é©±åŠ¨åˆ—è¡¨</h3>
                <div class="flex gap-3">
                    <button onclick="document.getElementById('driver-upload').click()" class="btn btn-primary">
                        â†‘ ä¸Šä¼ é©±åŠ¨
                    </button>
                            <input type="file" id="driver-upload" accept=".wasm" hx-post="/api/drivers/upload" hx-target="this" style="display:none">
                    <button onclick="openModal('driver-modal')" class="btn btn-primary">
                        + æ·»åŠ é©±åŠ¨
                    </button>
                        </div>
                    </div>
                    <div class="table-container" hx-get="/api/drivers" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- åŒ—å‘é…ç½® -->
                <div id="tab-northbound" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">åŒ—å‘é…ç½®åˆ—è¡¨</h3>
                <button onclick="openModal('northbound-modal')" class="btn btn-primary">
                    + æ·»åŠ é…ç½®
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/northbound" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- é˜ˆå€¼é…ç½® -->
                <div id="tab-thresholds" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">é˜ˆå€¼é…ç½®åˆ—è¡¨</h3>
                <button onclick="openModal('threshold-modal')" class="btn btn-primary">
                    + æ·»åŠ é˜ˆå€¼
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/thresholds" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
                </div>
                
                <!-- æŠ¥è­¦æ—¥å¿— -->
                <div id="tab-alarms" class="tab-content">
                    <div class="card-header">
                <h3 class="card-title">æŠ¥è­¦æ—¥å¿—</h3>
                <button hx-get="/api/alarms" hx-trigger="click" class="btn btn-primary">
                    â†» åˆ·æ–°
                </button>
                    </div>
                    <div class="table-container" hx-get="/api/alarms" hx-trigger="load" hx-target="this">
                <div class="text-center" style="padding: 48px; color: var(--text-muted);">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container" class="modal">
    <div class="modal-backdrop" onclick="closeAllModals()"></div>
        <div class="modal-content">
            <!-- æ·»åŠ èµ„æºè¡¨å• -->
        <div id="resource-modal" class="hidden">
            <div class="modal-header">
                <h3 class="modal-title">æ·»åŠ èµ„æº</h3>
                <button class="modal-close" onclick="closeModal('resource-modal')">&times;</button>
            </div>
            <form hx-post="/api/resources" hx-target="#resource-modal-result" hx-swap="innerHTML">
                <div id="resource-modal-result"></div>
                    <div class="form-group">
                        <label class="form-label">èµ„æºåç§°</label>
                    <input type="text" name="name" class="form-input" required placeholder="è¾“å…¥èµ„æºåç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label">èµ„æºç±»å‹</label>
                    <select name="type" class="form-select">
                            <option value="serial">ä¸²å£ (Serial)</option>
                            <option value="tcp">TCPè¿æ¥</option>
                            <option value="udp">UDPè¿æ¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">è¿æ¥é…ç½®</label>
                        <input type="text" name="config" class="form-input" placeholder="ä¸²å£: /dev/ttyUSB0,9600..." required>
                    </div>
                <div class="flex gap-3" style="margin-top: 24px;">
                    <button type="button" onclick="closeModal('resource-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">
                        ç¡®è®¤æ·»åŠ 
                    </button>
                    </div>
                </form>
            </div>
            
            <!-- æ·»åŠ è®¾å¤‡è¡¨å• -->
        <div id="device-modal" class="hidden">
            <div class="modal-header">
                <h3 class="modal-title">æ·»åŠ è®¾å¤‡</h3>
                <button class="modal-close" onclick="closeModal('device-modal')">&times;</button>
            </div>
            <form hx-post="/api/devices" hx-target="#device-modal-result" hx-swap="innerHTML">
                <div id="device-modal-result"></div>
                    <div class="form-group">
                        <label class="form-label">è®¾å¤‡åç§°</label>
                    <input type="text" name="name" class="form-input" required placeholder="è¾“å…¥è®¾å¤‡åç§°">
                    </div>
                    <div class="form-group">
                        <label class="form-label">è®¾å¤‡åœ°å€</label>
                        <input type="text" name="address" class="form-input" placeholder="å¦‚: 1 (Modbusåœ°å€)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">é‡‡é›†å‘¨æœŸ (ms)</label>
                    <input type="number" name="collect_interval" class="form-input" value="1000" min="100">
                    </div>
                <div class="flex gap-3" style="margin-top: 24px;">
                    <button type="button" onclick="closeModal('device-modal')" class="btn" style="flex:1; background:rgba(107,114,128,0.2); border-color:rgba(107,114,128,0.4); color:var(--text-secondary);">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">
                        ç¡®è®¤æ·»åŠ 
                    </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
// Toast notification system
function showToast(type, title, message, duration = 5000) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const icons = {
        success: 'âœ“',
        error: 'âœ•',
        warning: 'âš ',
        info: 'â„¹'
    };
    
    toast.innerHTML = `
        <div class="toast-icon">${icons[type] || icons.info}</div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            ${message ? `<div class="toast-message">${message}</div>` : ''}
        </div>
        <button class="modal-close" onclick="this.parentElement.remove()" style="font-size:16px;">&times;</button>
    `;
    
    container.appendChild(toast);
    
    if (duration > 0) {
        setTimeout(() => {
            toast.style.animation = 'toastSlideIn 0.3s ease-out reverse';
            setTimeout(() => toast.remove(), 300);
        }, duration);
    }
}

// HTMX response handling
document.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.successful && evt.detail.xhr.status === 200) {
        const response = evt.detail.xhr.responseText;
        if (response.includes('"status":"success"') || response.includes('åˆ›å»ºæˆåŠŸ') || response.includes('æ·»åŠ æˆåŠŸ')) {
            showToast('success', 'æ“ä½œæˆåŠŸ', 'æ•°æ®å·²æ›´æ–°');
        }
    }
});

document.addEventListener('htmx:responseError', function(evt) {
    showToast('error', 'è¯·æ±‚å¤±è´¥', 'è¯·ç¨åé‡è¯•');
});

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

function closeAllModals() {
    document.querySelectorAll('.modal-content > div').forEach(el => {
        el.classList.add('hidden');
    });
    document.getElementById('modal-container').classList.remove('active');
        }
        
        function openModal(modalId) {
    document.querySelectorAll('.modal-content > div').forEach(el => {
        el.classList.add('hidden');
    });
    document.getElementById(modalId).classList.remove('hidden');
            document.getElementById('modal-container').classList.add('active');
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(function(el) {
                el.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(function(el) {
                el.classList.remove('active');
            });
            document.getElementById('tab-' + tabName).classList.add('active');
            document.getElementById('tab-btn-' + tabName).classList.add('active');
        }

// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (navToggle && navLinks) {
        navToggle.addEventListener('click', function() {
            navLinks.classList.toggle('active');
        });
    }
});
    </script>
{{ end }}
